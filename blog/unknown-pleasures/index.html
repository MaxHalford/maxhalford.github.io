<!doctype html><html lang=en><head><script async defer data-website-id=6023252a-3a97-470f-b4ee-5082d242bb9a src=https://umami.pourtan.eu/umami.js></script><meta charset=utf-8><meta name=generator content="Hugo 0.108.0"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Max Halford"><meta property="og:url" content="https://maxhalford.github.io/blog/unknown-pleasures/"><link rel=canonical href=https://maxhalford.github.io/blog/unknown-pleasures/><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¦”</text></svg>"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/maxhalford.github.io\/"},"articleSection":"blog","name":"Unknown pleasures with JavaScript","headline":"Unknown pleasures with JavaScript","description":"No this blog post is not about how nice JavaScript can be, instead it\u0026rsquo;s just another one of my attempts at reproducing modern art with procedural generation and the HTML5 \u0026lt;canvas\u0026gt; element. This time I randomly generated images resembling the cover of the album by Joy Division called \u0026ldquo;Unknown Pleasures\u0026rdquo;.\nAccording to Wikipedia, this somewhat iconic album cover is based on radio waves. I saw a poster of it in a bar not long ago and decided to reproduce the next time I had some time to kill.","inLanguage":"en-US","author":"Max Halford","creator":"Max Halford","publisher":"Max Halford","accountablePerson":"Max Halford","copyrightHolder":"Max Halford","copyrightYear":"2017","datePublished":"2017-07-24 00:00:00 \u002b0000 UTC","dateModified":"2017-07-24 00:00:00 \u002b0000 UTC","url":"https:\/\/maxhalford.github.io\/blog\/unknown-pleasures\/","keywords":["generative-art"]}</script><title>Unknown pleasures with JavaScript â€¢ Max Halford</title><meta property="og:title" content="Unknown pleasures with JavaScript â€¢ Max Halford"><meta property="og:type" content="article"><meta name=description content="No this blog post is not about how nice JavaScript can be, instead it&rsquo;s just another one of my attempts at reproducing modern art with procedural generation and the HTML5 <canvas> element. This time I randomly generated images resembling the cover of the album by Joy Division called &ldquo;Unknown Pleasures&rdquo;.
According to Wikipedia, this somewhat iconic album cover is based on radio waves. I saw a poster of it in a bar not long ago and decided to reproduce the next time I had some time to kill."><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.css><link rel=stylesheet href=/css/github-markdown.min.css><link rel=stylesheet href=/css/highlight/github.css><link rel=stylesheet href=/css/index.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&family=Permanent+Marker&display=swap" rel=stylesheet><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0,tags:"ams"},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body><article class=post id=article><div class="row center-xs" style=text-align:left><div class="col-xs-12 col-sm-10 col-md-7 col-lg-5"><div class=header><header class=header-parts><div class="signatures site-title"><a href=/>Max Halford ðŸ¦”</a></div><div class=header-links><a class=header-link href=/>Blog</a>
<a class=header-link href=/links/>Links</a>
<a class=header-link href=/bio/>Bio</a></div></header></div><header class=post-header><h1 class=post-title>Unknown pleasures with JavaScript</h1><div class="row post-desc"><div class="col-xs-12 post-desc-items"><time class=post-date datetime="2017-07-24 00:00:00 UTC">2017-07-24</time>
<span class=posts-line-tag>generative-art</span></div></div></header><div class="post-content markdown-body"><p>No this blog post is not about how nice JavaScript can be, instead it&rsquo;s just another one of my attempts at reproducing modern art with <a href=https://www.wikiwand.com/en/Procedural_generation>procedural generation</a> and the <a href=https://www.w3schools.com/html/html5_canvas.asp>HTML5 <code>&lt;canvas></code> element</a>. This time I randomly generated images resembling the cover of the album by Joy Division called &ldquo;Unknown Pleasures&rdquo;.</p><p><img src=/img/blog/unknown-pleasures/album.png alt=album></p><p><a href=https://www.wikiwand.com/en/Unknown_Pleasures#/Artwork_and_packaging>According to Wikipedia</a>, this somewhat iconic album cover is based on radio waves. I saw a poster of it in a bar not long ago and decided to reproduce the next time I had some time to kill.</p><p>First of all let&rsquo;s set up a black canvas - I used the same dimensions as the image above.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>canvas</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;doodle&#34;</span> <span class=na>width</span><span class=o>=</span><span class=s>&#34;625&#34;</span> <span class=na>height</span><span class=o>=</span><span class=s>&#34;593&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>canvas</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>canvas</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;doodle&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>ctx</span> <span class=o>=</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>getContext</span><span class=p>(</span><span class=s1>&#39;2d&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>ctx</span><span class=p>.</span><span class=nx>fillStyle</span> <span class=o>=</span> <span class=s1>&#39;black&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>ctx</span><span class=p>.</span><span class=nx>fillRect</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>width</span><span class=p>,</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>height</span><span class=p>)</span>
</span></span></code></pre></div><p>Next I manually guessed some margins.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>xMin</span> <span class=o>=</span> <span class=mi>140</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>xMax</span> <span class=o>=</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>width</span> <span class=o>-</span> <span class=nx>xMin</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>yMin</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>yMax</span> <span class=o>=</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>height</span> <span class=o>-</span> <span class=nx>yMin</span>
</span></span></code></pre></div><p>I squinted my eyes to count the number of lines on the album cover and I believe there are 80 of them. Based on the height $h$ and the number of lines $l$ the distance between each line is simply $dy = \frac{h}{l}$. The same goes for the width and desired number of points on each line.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>nLines</span> <span class=o>=</span> <span class=mi>80</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>nPoints</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>dx</span> <span class=o>=</span> <span class=p>(</span><span class=nx>xMax</span> <span class=o>-</span> <span class=nx>xMin</span><span class=p>)</span> <span class=o>/</span> <span class=nx>nPoints</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>dy</span> <span class=o>=</span> <span class=p>(</span><span class=nx>yMax</span> <span class=o>-</span> <span class=nx>yMin</span><span class=p>)</span> <span class=o>/</span> <span class=nx>nLines</span>
</span></span></code></pre></div><p>My &ldquo;strategy&rdquo; is to use two nested loops to iterate each line one by one. For example the following snippets draws <code>nLines</code> lines evenly spaced by <code>dy</code> each consisting of <code>nPoints</code> points which are themselves evenly spaced by <code>dx</code>. Essentially this just requires updating the $x$ and $y$ coordinates respectively by <code>dx</code> and <code>dy</code>. When a line ends the <code>x</code> variable resets to <code>xMin</code> in order to start a new line.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>x</span> <span class=o>=</span> <span class=nx>xMin</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>y</span> <span class=o>=</span> <span class=nx>yMin</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>nLines</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&lt;</span> <span class=nx>nPoints</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>x</span> <span class=o>=</span> <span class=nx>x</span> <span class=o>+</span> <span class=nx>dx</span>
</span></span><span class=line><span class=cl>    <span class=nx>ctx</span><span class=p>.</span><span class=nx>lineTo</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>x</span> <span class=o>=</span> <span class=nx>xMin</span>
</span></span><span class=line><span class=cl>  <span class=nx>y</span> <span class=o>=</span> <span class=nx>y</span> <span class=o>+</span> <span class=nx>dy</span>
</span></span><span class=line><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>moveTo</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>ctx</span><span class=p>.</span><span class=nx>lineWidth</span> <span class=o>=</span> <span class=mf>1.2</span>
</span></span><span class=line><span class=cl><span class=nx>ctx</span><span class=p>.</span><span class=nx>strokeStyle</span> <span class=o>=</span> <span class=s1>&#39;white&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>ctx</span><span class=p>.</span><span class=nx>stroke</span><span class=p>()</span>
</span></span></code></pre></div><p><img src=/img/blog/unknown-pleasures/result1.png alt=result1></p><p>The randomness in the album cover comes from the $y$ coordinate. For example by adding values obtained from a uniform distribution in $[0, 1]$ - this is easily done by replacing <code>ctx.lineTo(x, y)</code> by <code>ctx.lineTo(x, y + Math.random())</code> - the lines start to jitter around.</p><p><img src=/img/blog/unknown-pleasures/result2.png alt=result2></p><p>Of course the noise in the album cover is not uniform at all, in fact each line has multiple &ldquo;peaks&rdquo; which points the way towards <a href=https://www.wikiwand.com/en/Multimodal_distribution>multimodal distributions</a>. It seems that each line has one or more peaks, moreover some of the peaks are skewed towards the left or the right. Although the distributions don&rsquo;t seem to be normal, using a <a href=https://www.wikiwand.com/en/Mixture_distribution>mixture distribution</a> composed of multiple normal distributions seems to be a reasonably good start.</p><p>To obtain values for $y$ we have to use the <a href=https://www.wikiwand.com/en/Probability_density_function>probability density function</a> &ndash; in short PDF &ndash; of each normal distribution. Basically for each $x_i$ the PDF will tell us the associated value $y_i$. To make the process different per line we can sample a mean $\mu$ and a standard deviation $\sigma$ from two normal distributions &ndash; one for each parameter &ndash; that we can then inside another normal distribution whose PDF will be used to generate values for $y$.</p><p>Sadly the JavaScript standard library doesn&rsquo;t provide a function to sample from a normal distribution. I didn&rsquo;t want to use an external library so I decided to implement my own. Although there exist fancy techniques with even fancier names &ndash; I&rsquo;m looking at you <a href=https://www.wikiwand.com/en/Ziggurat_algorithm>Ziggurat algorithm</a> &ndash; a simple way of going is simply to compute the average of values sampled from a uniform distribution.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>rand</span> <span class=p>(</span><span class=nx>min</span><span class=p>,</span> <span class=nx>max</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=p>(</span><span class=nx>max</span> <span class=o>-</span> <span class=nx>min</span><span class=p>)</span> <span class=o>+</span> <span class=nx>min</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>randNormal</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>sum</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>6</span><span class=p>;</span> <span class=nx>i</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>sum</span> <span class=o>+=</span> <span class=nx>rand</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>sum</span> <span class=o>/</span> <span class=mi>6</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The <code>randNormal</code> function will generate values centered around 0 with a standard deviation of 1. The reason why this technique is not popular is because the values it produces will necessarily be in range $[-6, 6]$ &ndash; because of the sum. The 6 is arbitrary and any value higher would increase the precision of the method while any lower value is not recommended. Because we are procedural generation we don&rsquo;t really care about the precision of our methods, in fact noise and imprecision is welcome!</p><p><code>randNormal</code> can be extended to sample from a normal distribution with mean <code>mu</code> and standard deviation <code>sigma</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>randNormal</span> <span class=p>(</span><span class=nx>mu</span><span class=p>,</span> <span class=nx>sigma</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>sum</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>6</span><span class=p>;</span> <span class=nx>i</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>sum</span> <span class=o>+=</span> <span class=nx>rand</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>norm</span> <span class=o>=</span> <span class=nx>sum</span> <span class=o>/</span> <span class=mi>6</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>mu</span> <span class=o>+</span> <span class=nx>sigma</span> <span class=o>*</span> <span class=nx>norm</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Finally the PDF of a normal distribution is $f(x) = \frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{(x-\mu)^2}{2\sigma^2}}$, which translates to the following JavaScript code.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>normalPDF</span> <span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>mu</span><span class=p>,</span> <span class=nx>sigma</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>sigma2</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>pow</span><span class=p>(</span><span class=nx>sigma</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>numerator</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>exp</span><span class=p>(</span><span class=o>-</span><span class=nb>Math</span><span class=p>.</span><span class=nx>pow</span><span class=p>((</span><span class=nx>x</span> <span class=o>-</span> <span class=nx>mu</span><span class=p>),</span> <span class=mi>2</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=nx>sigma2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>denominator</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>sqrt</span><span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>PI</span> <span class=o>*</span> <span class=nx>sigma2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>numerator</span> <span class=o>/</span> <span class=nx>denominator</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Now we can generate a normal distribution with random parameters for each line and obtain each $y_i$ thanks to the PDF of the generated normal distributions.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>mx</span> <span class=o>=</span> <span class=p>(</span><span class=nx>xMin</span> <span class=o>+</span> <span class=nx>xMax</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>nLines</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Generate random parameters for the line&#39;s normal distribution
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>mu</span> <span class=o>=</span> <span class=nx>randNormal</span><span class=p>(</span><span class=nx>mx</span><span class=p>,</span> <span class=mi>50</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>sigma</span> <span class=o>=</span> <span class=nx>randNormal</span><span class=p>(</span><span class=mi>30</span><span class=p>,</span> <span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&lt;</span> <span class=nx>nPoints</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>x</span> <span class=o>=</span> <span class=nx>x</span> <span class=o>+</span> <span class=nx>dx</span>
</span></span><span class=line><span class=cl>    <span class=nx>ctx</span><span class=p>.</span><span class=nx>lineTo</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span> <span class=o>-</span> <span class=mi>1000</span> <span class=o>*</span> <span class=nx>normalPDF</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>mu</span><span class=p>,</span> <span class=nx>sigma</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>x</span> <span class=o>=</span> <span class=nx>xMin</span>
</span></span><span class=line><span class=cl>  <span class=nx>y</span> <span class=o>=</span> <span class=nx>y</span> <span class=o>+</span> <span class=nx>dy</span>
</span></span><span class=line><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>moveTo</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>mu</code> and <code>sigma</code> are sampled from normal distributions with manually chosen parameters. <code>mx</code> is half the length of each line. The 1000 is also arbitrary and is simply there to rescale the values returned by the PDF so that they are meaningful, again this is done manually.</p><p><img src=/img/blog/unknown-pleasures/result3.png alt=result3></p><p>We&rsquo;re getting somewhere! However one issue that has nothing to do with randomness is that the lines sometimes overlap whereas they do not in the album cover. One way to solve this is to draw black pixels under each line to &ldquo;cover up&rdquo; the previous lines. This is quite easy to do with the <code>fill</code> method. At the end of each line we fill in all the area under the current line in black, then we paint the current line in white before finally moving to the next line.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>ctx</span><span class=p>.</span><span class=nx>fillStyle</span> <span class=o>=</span> <span class=s1>&#39;black&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>ctx</span><span class=p>.</span><span class=nx>strokeStyle</span> <span class=o>=</span> <span class=s1>&#39;white&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>nLines</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>beginPath</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Generate random parameters for the line&#39;s normal distribution
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>mu</span> <span class=o>=</span> <span class=nx>randNormal</span><span class=p>(</span><span class=nx>mx</span><span class=p>,</span> <span class=mi>50</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>sigma</span> <span class=o>=</span> <span class=nx>randNormal</span><span class=p>(</span><span class=mi>30</span><span class=p>,</span> <span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&lt;</span> <span class=nx>nPoints</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>x</span> <span class=o>=</span> <span class=nx>x</span> <span class=o>+</span> <span class=nx>dx</span>
</span></span><span class=line><span class=cl>    <span class=nx>ctx</span><span class=p>.</span><span class=nx>lineTo</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span> <span class=o>-</span> <span class=mi>1000</span> <span class=o>*</span> <span class=nx>normalPDF</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>mu</span><span class=p>,</span> <span class=nx>sigma</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Cover the previous lines
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>fill</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Draw the current line
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>stroke</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Go to the next line
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>x</span> <span class=o>=</span> <span class=nx>xMin</span>
</span></span><span class=line><span class=cl>  <span class=nx>y</span> <span class=o>=</span> <span class=nx>y</span> <span class=o>+</span> <span class=nx>dy</span>
</span></span><span class=line><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>moveTo</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This procedure gives a satisfying 3D feel to the image.</p><p><img src=/img/blog/unknown-pleasures/result4.png alt=result4></p><p>Now all we have to do is generate more resembling lines. As I mentioned the lines have multiple peaks and using a multimodal distribution <em>could</em> do well. To generate an arbitrary multimodal distribution one may use a mixture distribution, which is nothing more than sum over two or more distributions. For example the following figure &ndash; obtained from <a href=https://www.wikiwand.com/en/Mixture_distribution>the Wikipedia page</a> on mixture distributions &ndash; shows how summing three normal distributions results in a new distributions with three modes.</p><p>Producing a mixture distribution is not too complex code-wise. For each line we want to generate a multimodal distribution with a random number of modes, thus we can first of all assign a random integer to a variable called <code>nModes</code> to indicate how many modes we want. Then we can generate <code>nModes</code> values for $\mu$ and for $\sigma$ just as we did previously. Then we can sum returned by the PDF of each distribution and use the sum as a value for $y$.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>randInt</span> <span class=p>(</span><span class=nx>min</span><span class=p>,</span> <span class=nx>max</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=p>(</span><span class=nx>max</span> <span class=o>-</span> <span class=nx>min</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span> <span class=o>+</span> <span class=nx>min</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>nLines</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>beginPath</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>nModes</span> <span class=o>=</span> <span class=nx>randInt</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Generate random parameters for the line&#39;s normal distribution
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>mus</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>sigmas</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&lt;</span> <span class=nx>nModes</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>mus</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span> <span class=o>=</span> <span class=nx>randNormal</span><span class=p>(</span><span class=nx>mx</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>sigmas</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span> <span class=o>=</span> <span class=nx>randNormal</span><span class=p>(</span><span class=mi>24</span><span class=p>,</span> <span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>k</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>k</span> <span class=o>&lt;</span> <span class=nx>nPoints</span><span class=p>;</span> <span class=nx>k</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>x</span> <span class=o>=</span> <span class=nx>x</span> <span class=o>+</span> <span class=nx>dx</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>noise</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>l</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>l</span> <span class=o>&lt;</span> <span class=nx>nModes</span><span class=p>;</span> <span class=nx>l</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>noise</span> <span class=o>+=</span> <span class=nx>normalPDF</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>mus</span><span class=p>[</span><span class=nx>l</span><span class=p>],</span> <span class=nx>sigmas</span><span class=p>[</span><span class=nx>l</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>ctx</span><span class=p>.</span><span class=nx>lineTo</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span> <span class=o>-</span> <span class=mi>1000</span> <span class=o>*</span> <span class=nx>noise</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>fill</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>stroke</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>x</span> <span class=o>=</span> <span class=nx>xMin</span>
</span></span><span class=line><span class=cl>  <span class=nx>y</span> <span class=o>=</span> <span class=nx>y</span> <span class=o>+</span> <span class=nx>dy</span>
</span></span><span class=line><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>moveTo</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><img src=/img/blog/unknown-pleasures/result5.png alt=result5></p><p>Again we are getting closer. Now probably should work on some noise. Instead of adding some random as we did previously we could make the noise be proportionate to $y$. After some tinkering I found that the following worked quite well.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>yy</span> <span class=o>=</span> <span class=nx>y</span> <span class=o>-</span> <span class=p>(</span><span class=mi>500</span> <span class=o>+</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=mi>200</span><span class=p>)</span> <span class=o>*</span> <span class=nx>noise</span> <span class=o>+</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>ctx</span><span class=p>.</span><span class=nx>lineTo</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>yy</span><span class=p>)</span>
</span></span></code></pre></div><p><img src=/img/blog/unknown-pleasures/result6.png alt=result6></p><p>At this moment I was quite happy with the result. However, after looking at a few runs I had a feeling that the lines oscillated too much and that they should be a bit smoother. The thing is that for each value of $x$ we produce a value for $y$ that does not take account the preceding value. I decided to use a basic smoothing function so each value $y_i$ would take into account the previous value $y_{i-1}$. In the end I settled on doing $y_i = 0.7 \times f(x) - 0.3 \times y_{i-1}$. Implementing this rolling mean only requires the last value of $y$ at each iteration; I settled on the following code which does just so.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>nLines</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>beginPath</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>nModes</span> <span class=o>=</span> <span class=nx>randInt</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>mus</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>sigmas</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&lt;</span> <span class=nx>nModes</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>mus</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span> <span class=o>=</span> <span class=nx>rand</span><span class=p>(</span><span class=nx>mx</span> <span class=o>-</span> <span class=mi>50</span><span class=p>,</span> <span class=nx>mx</span> <span class=o>+</span> <span class=mi>50</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>sigmas</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span> <span class=o>=</span> <span class=nx>randNormal</span><span class=p>(</span><span class=mi>24</span><span class=p>,</span> <span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>w</span> <span class=o>=</span> <span class=nx>y</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>k</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>k</span> <span class=o>&lt;</span> <span class=nx>nPoints</span><span class=p>;</span> <span class=nx>k</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>x</span> <span class=o>=</span> <span class=nx>x</span> <span class=o>+</span> <span class=nx>dx</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>noise</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>l</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>l</span> <span class=o>&lt;</span> <span class=nx>nModes</span><span class=p>;</span> <span class=nx>l</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>noise</span> <span class=o>+=</span> <span class=nx>normalPDF</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>mus</span><span class=p>[</span><span class=nx>l</span><span class=p>],</span> <span class=nx>sigmas</span><span class=p>[</span><span class=nx>l</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>yy</span> <span class=o>=</span> <span class=mf>0.3</span> <span class=o>*</span> <span class=nx>w</span> <span class=o>+</span> <span class=mf>0.7</span> <span class=o>*</span> <span class=p>(</span><span class=nx>y</span> <span class=o>-</span> <span class=mi>600</span> <span class=o>*</span> <span class=nx>noise</span> <span class=o>+</span> <span class=nx>noise</span> <span class=o>*</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=mi>200</span> <span class=o>+</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=nx>ctx</span><span class=p>.</span><span class=nx>lineTo</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>yy</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>w</span> <span class=o>=</span> <span class=nx>yy</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>fill</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>stroke</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>x</span> <span class=o>=</span> <span class=nx>xMin</span>
</span></span><span class=line><span class=cl>  <span class=nx>y</span> <span class=o>=</span> <span class=nx>y</span> <span class=o>+</span> <span class=nx>dy</span>
</span></span><span class=line><span class=cl>  <span class=nx>ctx</span><span class=p>.</span><span class=nx>moveTo</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><img src=/img/blog/unknown-pleasures/result7.png alt=result7></p><p>And that wraps it for this post, I hope you enjoyed it! As usual the final is <a href=https://github.com/MaxHalford/procedural-art/blob/master/3_unknown_pleasures.html>available on GitHub</a> with the rest of procedural generation I did.</p><p>On a side note I discovered the <a href=https://www.reddit.com/r/proceduralgeneration/>r/proceduralgeneration</a> subreddit which I recommend if you&rsquo;re interested in procedural generation &ndash; albeit more advanced than what I do.</p></div><script type=text/javascript>var s=document.createElement("script");s.setAttribute("src","https://utteranc.es/client.js"),s.setAttribute("repo","MaxHalford/maxhalford.github.io"),s.setAttribute("issue-term","pathname"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",null),s.setAttribute("theme","github-light"),document.body.appendChild(s)</script><div class=footer><div class=do-the-thing><div class=elevator><svg class="sweet-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" enable-background="new 0 0 100 100" height="100" width="100"><path d="M70 47.5H30c-1.4.0-2.5 1.1-2.5 2.5v40c0 1.4 1.1 2.5 2.5 2.5h40c1.4.0 2.5-1.1 2.5-2.5V50C72.5 48.6 71.4 47.5 70 47.5zm-22.5 40h-5v-25h5v25zm10 0h-5v-25h5v25zm10 0h-5V60c0-1.4-1.1-2.5-2.5-2.5H40c-1.4.0-2.5 1.1-2.5 2.5v27.5h-5v-35h35v35z"/><path d="M50 42.5c1.4.0 2.5-1.1 2.5-2.5V16l5.7 5.7c.5.5 1.1.7 1.8.7s1.3-.2 1.8-.7c1-1 1-2.6.0-3.5l-10-10c-1-1-2.6-1-3.5.0l-10 10c-1 1-1 2.6.0 3.5 1 1 2.6 1 3.5.0l5.7-5.7v24c0 1.4 1.1 2.5 2.5 2.5z"/></svg>Back to the top</div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/elevator.js/1.0.1/elevator.min.js></script>
<script>var elementButton=document.querySelector(".elevator"),elevator=new Elevator({element:elementButton,mainAudio:"/music/elevator.mp3",endAudio:"/music/ding.mp3"})</script><style>.down-arrow{font-size:120px;margin-top:90px;margin-bottom:90px;text-shadow:0 -20px #0c1f31,0 0 #c33329;color:transparent;-webkit-transform:scaleY(.8);-moz-transform:scaleY(.8);transform:scaleY(.8)}.elevator{text-align:center;cursor:pointer;width:140px;margin:auto;margin-bottom:20px}.elevator:hover{opacity:.7}.elevator svg{width:40px;height:40px;display:block;margin:auto;margin-bottom:5px}</style><div class=related-content><h3 style=margin-top:10px!important;margin-bottom:10px!important>Related posts</h3><ul style=margin-top:0><li><a href=/blog/recursive-polygons/>Recursive polygons with JavaScript</a></li><li><a href=/blog/mondrian/>Grid paintings Ã  la Mondrian with JavaScript</a></li></ul></div></div></div></article><script></script></body></html>