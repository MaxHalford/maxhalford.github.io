<!doctype html><html lang=en><head><script defer src=https://unpkg.com/@tinybirdco/flock.js data-host=https://api.tinybird.co data-token=p.eyJ1IjogImMwMjJhMjg1LWJmY2YtNDc0OC1hYzczLTJhMDQ1Njk3NTI0YyIsICJpZCI6ICIzNjc3NjQ3Ny04MTE2LTRmYWQtYjcwMy1iZmM3YjMwZGJjMjMifQ.A0vHm-VWbXG6uBFZiwuspN_AyfSYNrdZE3IgwgWSt4g></script><meta charset=utf-8><meta name=generator content="Hugo 0.110.0"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Max Halford"><meta property="og:url" content="https://maxhalford.github.io/blog/online-active-learning-river-databutton/"><link rel=canonical href=https://maxhalford.github.io/blog/online-active-learning-river-databutton/><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🦔</text></svg>"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/maxhalford.github.io\/"},"articleSection":"blog","name":"Online active learning in 80 lines of Python","headline":"Online active learning in 80 lines of Python","description":"Active learning is a way to get humans to label data efficiently. A good active learning strategy minimizes the number of necessary labels, while maximizing a model\u0026rsquo;s performance. This usually works by focusing on samples where the model is unsure of its prediction.\nIn a batch setting, the model is periodically retrained to learn from the freshly labeled samples. However, the training time is usually too prohibitive for this to happen each time a new label is provided.","inLanguage":"en-US","author":"Max Halford","creator":"Max Halford","publisher":"Max Halford","accountablePerson":"Max Halford","copyrightHolder":"Max Halford","copyrightYear":"2023","datePublished":"2023-01-22 00:00:00 \u002b0000 UTC","dateModified":"2023-01-22 00:00:00 \u002b0000 UTC","url":"https:\/\/maxhalford.github.io\/blog\/online-active-learning-river-databutton\/","keywords":["online-machine-learning"]}</script><title>Online active learning in 80 lines of Python • Max Halford</title><meta property="og:title" content="Online active learning in 80 lines of Python • Max Halford"><meta property="og:type" content="article"><meta name=description content="Active learning is a way to get humans to label data efficiently. A good active learning strategy minimizes the number of necessary labels, while maximizing a model&rsquo;s performance. This usually works by focusing on samples where the model is unsure of its prediction.
In a batch setting, the model is periodically retrained to learn from the freshly labeled samples. However, the training time is usually too prohibitive for this to happen each time a new label is provided."><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.css><link rel=stylesheet href=/css/github-markdown.min.css><link rel=stylesheet href=/css/highlight/github.css><link rel=stylesheet href=/css/index.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&family=Permanent+Marker&display=swap" rel=stylesheet><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0,tags:"ams"},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body><article class=post id=article><div class="row center-xs" style=text-align:left><div class="col-xs-12 col-sm-10 col-md-7 col-lg-5"><div class=header><header class=header-parts><div class="signatures site-title"><a href=/>Max Halford 🦔</a></div><div class=header-links><a class=header-link href=/>Blog</a>
<a class=header-link href=/links/>Links</a>
<a class=header-link href=/bio/>Bio</a></div></header></div><header class=post-header><h1 class=post-title>Online active learning in 80 lines of Python</h1><div class="row post-desc"><div class="col-xs-12 post-desc-items"><time class=post-date datetime="2023-01-22 00:00:00 UTC">2023-01-22</time>
<span class=posts-line-tag>online-machine-learning</span></div></div></header><div class="post-content markdown-body"><p><a href=https://www.wikiwand.com/en/Active_learning_(machine_learning)>Active learning</a> is a way to get humans to label data efficiently. A good active learning strategy minimizes the number of necessary labels, while maximizing a model&rsquo;s performance. This usually works by focusing on samples where the model is unsure of its prediction.</p><p>In a batch setting, the model is periodically retrained to learn from the freshly labeled samples. However, the training time is usually too prohibitive for this to happen each time a new label is provided. This isn&rsquo;t the case with online models, because they are able to learn one sample at a time. Active and online learning naturally fit together.</p><p>In an online setting, active learning can also be used to accelerate training. The idea of <a href=http://people.csail.mit.edu/cmontel/mk_olc_cvpr07.pdf>online active learning</a> is to loop through every sample in a dataset, make a prediction, and then decide whether the model should be updated or not. Therefore, given a labeled dataset, online active learning provides a way to trade between model accuracy and training speed.</p><p>I recently implemented a basic version of online active learning in <a href=https://riverml.xyz>River</a> &ndash; see the <a href=https://github.com/online-ml/river/pull/1162>pull request</a>. I decided to build a quick spam classifier demo with <a href=https://streamlit.io/>Streamlit</a> to showcase this. The demo should be available at <a href=https://next.databutton.com/v/13lkg6b6>this</a> link.</p><div align=center><figure style=width:90%;margin:0><img src=/img/blog/online-active-learning-streamlit/screenshot.png><figcaption>Live demo available <a href=https://next.databutton.com/v/13lkg6b6>here</a></figcaption></figure></div></br><p>I&rsquo;m actually using <a href=https://www.databutton.io/>Databutton</a> to host the demo. It&rsquo;s basically a tool for building and deploying Streamlit apps. It also includes some convincing features, such as storage. This allows maintaining state in between sessions. If you like Streamlit, you&rsquo;re going to love Databutton.</p><p>Here is the underlying code:</p><details><summary>Click to see the code</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>itertools</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pickle</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>databutton</span> <span class=k>as</span> <span class=nn>db</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>streamlit</span> <span class=k>as</span> <span class=nn>st</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>river</span> <span class=kn>import</span> <span class=n>active</span><span class=p>,</span> <span class=n>datasets</span><span class=p>,</span> <span class=n>feature_extraction</span><span class=p>,</span> <span class=n>linear_model</span><span class=p>,</span> <span class=n>metrics</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>st</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&#34;Ham or spam?&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>state</span> <span class=o>=</span> <span class=n>st</span><span class=o>.</span><span class=n>session_state</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>active</span><span class=o>.</span><span class=n>EntropySampler</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>classifier</span><span class=o>=</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>feature_extraction</span><span class=o>.</span><span class=n>BagOfWords</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=o>|</span> <span class=n>linear_model</span><span class=o>.</span><span class=n>LogisticRegression</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>discount_factor</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=s2>&#34;model&#34;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>state</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Load state from storage</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span><span class=p>[</span><span class=s2>&#34;model&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pickle</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>binary</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;model.pkl&#34;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=k>lambda</span><span class=p>:</span> <span class=n>pickle</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>model</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span><span class=p>[</span><span class=s2>&#34;metric&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pickle</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>binary</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;metric.pkl&#34;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=k>lambda</span><span class=p>:</span> <span class=n>pickle</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>metrics</span><span class=o>.</span><span class=n>Accuracy</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span><span class=p>[</span><span class=s2>&#34;predictions&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>json</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;predictions&#34;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=k>lambda</span><span class=p>:</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span><span class=p>[</span><span class=s2>&#34;labels&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>json</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;labels&#34;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=k>lambda</span><span class=p>:</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span><span class=p>[</span><span class=s2>&#34;dataset&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>),</span> <span class=n>x</span><span class=p>[</span><span class=s2>&#34;body&#34;</span><span class=p>],</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>datasets</span><span class=o>.</span><span class=n>SMSSpam</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>state</span><span class=p>[</span><span class=s2>&#34;predictions&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Warm-start the first time</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>state</span><span class=p>[</span><span class=s2>&#34;predictions&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=ow>in</span> <span class=n>itertools</span><span class=o>.</span><span class=n>islice</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=s2>&#34;dataset&#34;</span><span class=p>],</span> <span class=mi>1000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>y_pred</span><span class=p>,</span> <span class=n>ask</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=s2>&#34;model&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>predict_one</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=s2>&#34;metric&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>y_pred</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=s2>&#34;predictions&#34;</span><span class=p>][</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>y_pred</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>ask</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>state</span><span class=p>[</span><span class=s2>&#34;model&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>learn_one</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>state</span><span class=p>[</span><span class=s2>&#34;labels&#34;</span><span class=p>][</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>y</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=s2>&#34;model&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>metric</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=s2>&#34;metric&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>labels</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=s2>&#34;labels&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>predictions</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=s2>&#34;predictions&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>dataset</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=s2>&#34;dataset&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=ow>in</span> <span class=n>dataset</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>y_pred</span><span class=p>,</span> <span class=n>ask</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>predict_one</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>ask</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>metric</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>y_pred</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>predictions</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>y_pred</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>st</span><span class=o>.</span><span class=n>markdown</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>choices</span> <span class=o>=</span> <span class=n>st</span><span class=o>.</span><span class=n>columns</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>st</span><span class=o>.</span><span class=n>button</span><span class=p>(</span><span class=s2>&#34;Ham ✅&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>model</span><span class=o>.</span><span class=n>learn_one</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>labels</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=n>predictions</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>y_pred</span>
</span></span><span class=line><span class=cl>        <span class=n>metric</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>y_pred</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>choices</span><span class=p>[</span><span class=mi>1</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>st</span><span class=o>.</span><span class=n>button</span><span class=p>(</span><span class=s2>&#34;Spam ❌&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>model</span><span class=o>.</span><span class=n>learn_one</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>labels</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=n>predictions</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>y_pred</span>
</span></span><span class=line><span class=cl>        <span class=n>metric</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>y_pred</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>st</span><span class=o>.</span><span class=n>markdown</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;*Prediction: </span><span class=si>{</span><span class=s1>&#39;ham ✅&#39;</span> <span class=k>if</span> <span class=n>y_pred</span> <span class=k>else</span> <span class=s1>&#39;spam ❌&#39;</span><span class=si>}</span><span class=s2>*&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>st</span><span class=o>.</span><span class=n>markdown</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;*Truth: </span><span class=si>{</span><span class=s1>&#39;ham ✅&#39;</span> <span class=k>if</span> <span class=n>y</span> <span class=k>else</span> <span class=s1>&#39;spam ❌&#39;</span><span class=si>}</span><span class=s2>*&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>st</span><span class=o>.</span><span class=n>markdown</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;---&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>columns</span> <span class=o>=</span> <span class=n>st</span><span class=o>.</span><span class=n>columns</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>columns</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>metric</span><span class=p>(</span><span class=s2>&#34;Predictions made&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>predictions</span><span class=p>)</span><span class=si>:</span><span class=s2>,d</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>columns</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>metric</span><span class=p>(</span><span class=s2>&#34;Labels provided&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>labels</span><span class=p>)</span><span class=si>:</span><span class=s2>,d</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>columns</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>metric</span><span class=p>(</span><span class=s2>&#34;Model accuracy&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>metric</span><span class=o>.</span><span class=n>get</span><span class=p>()</span><span class=si>:</span><span class=s2>.2%</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>st</span><span class=o>.</span><span class=n>markdown</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;---&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>st</span><span class=o>.</span><span class=n>button</span><span class=p>(</span><span class=s2>&#34;Save state 💾&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>binary</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;model.pkl&#34;</span><span class=p>,</span> <span class=n>pickle</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>model</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>binary</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;metric.pkl&#34;</span><span class=p>,</span> <span class=n>pickle</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>metric</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>json</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;predictions&#34;</span><span class=p>,</span> <span class=n>predictions</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>json</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;labels&#34;</span><span class=p>,</span> <span class=n>labels</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>st</span><span class=o>.</span><span class=n>button</span><span class=p>(</span><span class=s2>&#34;Reset state 🧹&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>binary</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;model.pkl&#34;</span><span class=p>,</span> <span class=n>pickle</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>clone</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>binary</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;metric.pkl&#34;</span><span class=p>,</span> <span class=n>pickle</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>metric</span><span class=o>.</span><span class=n>clone</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>json</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;predictions&#34;</span><span class=p>,</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>json</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;labels&#34;</span><span class=p>,</span> <span class=p>{})</span>
</span></span></code></pre></div></details><p>The code should be straightforward to follow, but it might be confusing because some UI shenanigans are mixed with the core logic. I&rsquo;ll break it down.</p><p><strong>Managing state</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>state</span> <span class=o>=</span> <span class=n>st</span><span class=o>.</span><span class=n>session_state</span>
</span></span></code></pre></div><p>I made heavy use of Streamlit&rsquo;s <a href=https://docs.streamlit.io/library/api-reference/session-state>Session State</a>. Usually, taking an action in a Streamlit reruns the app from the app. Session State is a way to store state between successive reruns. Note that this is different from Streamlit&rsquo;s <a href=https://docs.streamlit.io/library/api-reference/performance/st.cache>cache annotation</a>.</p><hr><p><strong>Defining an active learning strategy</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>active</span><span class=o>.</span><span class=n>EntropySampler</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>classifier</span><span class=o>=</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>feature_extraction</span><span class=o>.</span><span class=n>BagOfWords</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=o>|</span> <span class=n>linear_model</span><span class=o>.</span><span class=n>LogisticRegression</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>discount_factor</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>This is the first active learning strategy I recently added to River. It&rsquo;s based on entropy: the idea is to ask for labels when the output probability distribution is somewhat uniform. It seems to be working reasonably well, but I&rsquo;m sure we&rsquo;ll implement better strategies over the coming months.</p><hr><p><strong>Loading state from storage</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>state</span><span class=p>[</span><span class=s2>&#34;model&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pickle</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>binary</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;model.pkl&#34;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=k>lambda</span><span class=p>:</span> <span class=n>pickle</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>model</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>state</span><span class=p>[</span><span class=s2>&#34;metric&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pickle</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>binary</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;metric.pkl&#34;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=k>lambda</span><span class=p>:</span> <span class=n>pickle</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>metrics</span><span class=o>.</span><span class=n>Accuracy</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>state</span><span class=p>[</span><span class=s2>&#34;predictions&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>json</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;predictions&#34;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=k>lambda</span><span class=p>:</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl><span class=n>state</span><span class=p>[</span><span class=s2>&#34;labels&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>json</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;labels&#34;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=k>lambda</span><span class=p>:</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl><span class=n>state</span><span class=p>[</span><span class=s2>&#34;dataset&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>),</span> <span class=n>x</span><span class=p>[</span><span class=s2>&#34;body&#34;</span><span class=p>],</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>datasets</span><span class=o>.</span><span class=n>SMSSpam</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>state</span><span class=p>[</span><span class=s2>&#34;predictions&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>Databutton provides a storage API. Here I&rsquo;m using this feature to load the current state of the app. The model and the metric are both Python class instances, and so I&rsquo;m <a href=https://docs.python.org/3/library/pickle.html>pickling</a> them. The predictions and labels are simply stored in dictionaries, and are thus saved as JSON files.</p><p>I load the dataset from River. I skip the samples for which a prediction has already been made. This is what allows the app to not start from scratch each time it is rerun or reloaded.</p><hr><p><strong>Warming-up</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=ow>in</span> <span class=n>itertools</span><span class=o>.</span><span class=n>islice</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=s2>&#34;dataset&#34;</span><span class=p>],</span> <span class=mi>1000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>y_pred</span><span class=p>,</span> <span class=n>ask</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=s2>&#34;model&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>predict_one</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span><span class=p>[</span><span class=s2>&#34;metric&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>y_pred</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span><span class=p>[</span><span class=s2>&#34;predictions&#34;</span><span class=p>][</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>y_pred</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>ask</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=s2>&#34;model&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>learn_one</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=s2>&#34;labels&#34;</span><span class=p>][</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>y</span>
</span></span></code></pre></div><p>Active learning starts paying off once the model has seen a decent number of samples. At first, active learning usually always asks for samples to be labelled. This is a bit boring for a demo, so I warmed-up the model on the first 1000 samples.</p><hr><p><strong>Asking for a label</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=ow>in</span> <span class=n>dataset</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>y_pred</span><span class=p>,</span> <span class=n>ask</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>predict_one</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>ask</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>metric</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>y_pred</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>predictions</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>y_pred</span>
</span></span></code></pre></div><p>Classifiers in River simply produce a prediction when <code>predict_one</code> or <code>predict_proba_one</code> is called. The way active learning works in River works, is that an additional <code>ask</code> boolean is returned, indicating whether a label is required or not. What I do is that I break the inference loop whenever a label is required.</p><p>Note: what happens after the <code>else</code> is a bit cryptic. Basically, in case <code>ask</code> is <code>True</code>, I&rsquo;ll update the metric and store the prediction once the sample has been labelled. This is just a UX detail.</p><hr><p><strong>Displaying the sample</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>st</span><span class=o>.</span><span class=n>markdown</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span></code></pre></div><p>Here we&rsquo;re classifying spams in text messages, so we just need to display the content of the text in order for a human to label it.</p><hr><p><strong>Labelling the sample</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>choices</span> <span class=o>=</span> <span class=n>st</span><span class=o>.</span><span class=n>columns</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>st</span><span class=o>.</span><span class=n>button</span><span class=p>(</span><span class=s2>&#34;Ham ✅&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>model</span><span class=o>.</span><span class=n>learn_one</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>labels</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=n>predictions</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>y_pred</span>
</span></span><span class=line><span class=cl>        <span class=n>metric</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>y_pred</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>choices</span><span class=p>[</span><span class=mi>1</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>st</span><span class=o>.</span><span class=n>button</span><span class=p>(</span><span class=s2>&#34;Spam ❌&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>model</span><span class=o>.</span><span class=n>learn_one</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>labels</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=n>predictions</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>y_pred</span>
</span></span><span class=line><span class=cl>        <span class=n>metric</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>y_pred</span><span class=p>)</span>
</span></span></code></pre></div><p>We&rsquo;re doing binary classification, so I simply displayed two buttons. Clicking on a button will update the model with the according label.</p><p>As I mentioned above, I handle the prediction here because I don&rsquo;t want the prediction to be accounted for if no label is picked and the page is reloaded. Again, this is just a UX thing to do with managing the state of the application.</p><hr><p><strong>Performance report</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>columns</span> <span class=o>=</span> <span class=n>st</span><span class=o>.</span><span class=n>columns</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>columns</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>metric</span><span class=p>(</span><span class=s2>&#34;Predictions made&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>predictions</span><span class=p>)</span><span class=si>:</span><span class=s2>,d</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>columns</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>metric</span><span class=p>(</span><span class=s2>&#34;Labels provided&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>labels</span><span class=p>)</span><span class=si>:</span><span class=s2>,d</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>columns</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>metric</span><span class=p>(</span><span class=s2>&#34;Model accuracy&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>metric</span><span class=o>.</span><span class=n>get</span><span class=p>()</span><span class=si>:</span><span class=s2>.2%</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>I&rsquo;m counting the number of predictions made by the model, along with the number of labels it has been fed. The larger the difference between these two quantities, the better the active learning strategy. Usually, this is also quite correlated with how well the model is performing.</p><hr><p><strong>Saving and resetting state</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>if</span> <span class=n>st</span><span class=o>.</span><span class=n>button</span><span class=p>(</span><span class=s2>&#34;Save state 💾&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>binary</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;model.pkl&#34;</span><span class=p>,</span> <span class=n>pickle</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>model</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>binary</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;metric.pkl&#34;</span><span class=p>,</span> <span class=n>pickle</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>metric</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>json</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;predictions&#34;</span><span class=p>,</span> <span class=n>predictions</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>json</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;labels&#34;</span><span class=p>,</span> <span class=n>labels</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>st</span><span class=o>.</span><span class=n>button</span><span class=p>(</span><span class=s2>&#34;Reset state 🧹&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>binary</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;model.pkl&#34;</span><span class=p>,</span> <span class=n>pickle</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>clone</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>binary</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;metric.pkl&#34;</span><span class=p>,</span> <span class=n>pickle</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>metric</span><span class=o>.</span><span class=n>clone</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>json</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;predictions&#34;</span><span class=p>,</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=o>.</span><span class=n>storage</span><span class=o>.</span><span class=n>json</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s2>&#34;labels&#34;</span><span class=p>,</span> <span class=p>{})</span>
</span></span></code></pre></div><p>What I like about this app is that the state is preserved if I reload the page. This is all thanks to Databutton. Having storage available on top of Streamlit is a sweet combo.</p><hr><p>That&rsquo;s all for now! If you&rsquo;re interested in online active learning, please do reach out. We&rsquo;ve barely started adding it to River, and would love to include state-of-the-art methods.</p></div><script type=text/javascript>var s=document.createElement("script");s.setAttribute("src","https://utteranc.es/client.js"),s.setAttribute("repo","MaxHalford/maxhalford.github.io"),s.setAttribute("issue-term","pathname"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",null),s.setAttribute("theme","github-light"),document.body.appendChild(s)</script><div class=footer><div class=do-the-thing><div class=elevator><svg class="sweet-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" enable-background="new 0 0 100 100" height="100" width="100"><path d="M70 47.5H30c-1.4.0-2.5 1.1-2.5 2.5v40c0 1.4 1.1 2.5 2.5 2.5h40c1.4.0 2.5-1.1 2.5-2.5V50C72.5 48.6 71.4 47.5 70 47.5zm-22.5 40h-5v-25h5v25zm10 0h-5v-25h5v25zm10 0h-5V60c0-1.4-1.1-2.5-2.5-2.5H40c-1.4.0-2.5 1.1-2.5 2.5v27.5h-5v-35h35v35z"/><path d="M50 42.5c1.4.0 2.5-1.1 2.5-2.5V16l5.7 5.7c.5.5 1.1.7 1.8.7s1.3-.2 1.8-.7c1-1 1-2.6.0-3.5l-10-10c-1-1-2.6-1-3.5.0l-10 10c-1 1-1 2.6.0 3.5 1 1 2.6 1 3.5.0l5.7-5.7v24c0 1.4 1.1 2.5 2.5 2.5z"/></svg>Back to the top</div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/elevator.js/1.0.1/elevator.min.js></script>
<script>var elementButton=document.querySelector(".elevator"),elevator=new Elevator({element:elementButton,mainAudio:"/music/elevator.mp3",endAudio:"/music/ding.mp3"})</script><style>.down-arrow{font-size:120px;margin-top:90px;margin-bottom:90px;text-shadow:0 -20px #0c1f31,0 0 #c33329;color:transparent;-webkit-transform:scaleY(.8);-moz-transform:scaleY(.8);transform:scaleY(.8)}.elevator{text-align:center;cursor:pointer;width:140px;margin:auto;margin-bottom:30px}.elevator:hover{opacity:.7}.elevator svg{width:40px;height:40px;display:block;margin:auto;margin-bottom:5px}</style><div class=related-content><h3 style=margin-top:10px!important;margin-bottom:10px!important>Related posts</h3><ul style=margin-top:0><li><a href=/blog/matrix-inverse-mini-batch/>Matrix inverse mini-batch updates</a></li><li><a href=/blog/medium-creme/>Machine learning for streaming data with creme</a></li><li><a href=/blog/pandas-streaming-groupby/>Streaming groupbys in pandas for big datasets</a></li></ul></div></div></div></article><script></script></body></html>