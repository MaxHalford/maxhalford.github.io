<!doctype html><html lang=en><head><script defer src=https://unpkg.com/@tinybirdco/flock.js data-host=https://api.tinybird.co data-token=p.eyJ1IjogImMwMjJhMjg1LWJmY2YtNDc0OC1hYzczLTJhMDQ1Njk3NTI0YyIsICJpZCI6ICIzNjc3NjQ3Ny04MTE2LTRmYWQtYjcwMy1iZmM3YjMwZGJjMjMifQ.A0vHm-VWbXG6uBFZiwuspN_AyfSYNrdZE3IgwgWSt4g></script><meta charset=utf-8><meta name=generator content="Hugo 0.123.6"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Max Halford"><meta property="og:url" content="https://maxhalford.github.io/blog/fairness-competition/"><link rel=canonical href=https://maxhalford.github.io/blog/fairness-competition/><meta property="og:title" content="Organising a Kaggle InClass competition with a fairness metric"><meta property="og:description" content="Some context I co-organised a data science competition during the second half of 2020. This was in fact the 5th edition of the &ldquo;Défi IA&rdquo;, which is a recurring event that happens on a yearly basis. It is essentially a supervised machine learning competition for students from French speaking universities and engineering schools. This year was the first time that Kaggle was used to host the competition. Before that we used a custom platform that I wrote during my student years."><meta property="og:type" content="article"><meta property="og:url" content="https://maxhalford.github.io/blog/fairness-competition/"><meta property="og:image" content="https://maxhalford.github.io/img/belle-ile.jpg"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-01-21T00:00:00+00:00"><meta property="article:modified_time" content="2021-01-21T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://maxhalford.github.io/img/belle-ile.jpg"><meta name=twitter:title content="Organising a Kaggle InClass competition with a fairness metric"><meta name=twitter:description content="Some context I co-organised a data science competition during the second half of 2020. This was in fact the 5th edition of the &ldquo;Défi IA&rdquo;, which is a recurring event that happens on a yearly basis. It is essentially a supervised machine learning competition for students from French speaking universities and engineering schools. This year was the first time that Kaggle was used to host the competition. Before that we used a custom platform that I wrote during my student years."><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🦆</text></svg>"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/maxhalford.github.io\/"},"articleSection":"blog","name":"Organising a Kaggle InClass competition with a fairness metric","headline":"Organising a Kaggle InClass competition with a fairness metric","description":"Some context I co-organised a data science competition during the second half of 2020. This was in fact the 5th edition of the \u0026ldquo;Défi IA\u0026rdquo;, which is a recurring event that happens on a yearly basis. It is essentially a supervised machine learning competition for students from French speaking universities and engineering schools. This year was the first time that Kaggle was used to host the competition. Before that we used a custom platform that I wrote during my student years.","inLanguage":"en-US","author":"Max Halford","creator":"Max Halford","publisher":"Max Halford","accountablePerson":"Max Halford","copyrightHolder":"Max Halford","copyrightYear":"2021","datePublished":"2021-01-21 00:00:00 \u002b0000 UTC","dateModified":"2021-01-21 00:00:00 \u002b0000 UTC","url":"https:\/\/maxhalford.github.io\/blog\/fairness-competition\/","keywords":["kaggle"]}</script><title>Organising a Kaggle InClass competition with a fairness metric • Max Halford</title>
<meta property="og:title" content="Organising a Kaggle InClass competition with a fairness metric • Max Halford"><meta property="og:type" content="article"><meta name=description content="Some context I co-organised a data science competition during the second half of 2020. This was in fact the 5th edition of the &ldquo;Défi IA&rdquo;, which is a recurring event that happens on a yearly basis. It is essentially a supervised machine learning competition for students from French speaking universities and engineering schools. This year was the first time that Kaggle was used to host the competition. Before that we used a custom platform that I wrote during my student years."><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.css><link rel=stylesheet href=/css/github-markdown.min.css><link rel=stylesheet href=/css/highlight/github.css><link rel=stylesheet href=/css/index.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&family=Permanent+Marker&display=swap" rel=stylesheet><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0,tags:"ams"},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body><article class=post id=article><div class="row center-xs" style=text-align:left><div class="col-xs-12 col-sm-10 col-md-7 col-lg-5"><div class=header><header class=header-parts><div class="signatures site-title"><a href=/>Max Halford 🦆</a></div><div class=header-links><a class=header-link href=/>Blog</a>
<a class=header-link href=/links/>Links</a>
<a class=header-link href=/bio/>Bio</a></div></header></div><header class=post-header><h1 class=post-title>Organising a Kaggle InClass competition with a fairness metric</h1><div class="row post-desc"><div class="col-xs-12 post-desc-items"><time class=post-date datetime="2021-01-21 00:00:00 UTC">2021-01-21
</time><span class=posts-line-tag>kaggle</span></div></div></header><div class="post-content markdown-body"><h2 id=toc>Table of contents</h2><nav id=TableOfContents><ul><li><a href=#some-context>Some context</a></li><li><a href=#the-fairness-metric>The fairness metric</a></li><li><a href=#what-people-did>What people did</a></li><li><a href=#rankings>Rankings</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav><h2 id=some-context>Some context</h2><p>I co-organised a data science competition during the second half of 2020. This was in fact the 5th edition of the &ldquo;Défi IA&rdquo;, which is a recurring event that happens on a yearly basis. It is essentially a supervised machine learning competition for students from French speaking universities and engineering schools. This year was the first time that Kaggle was used to host the competition. Before that we used a custom platform that I wrote during my student years. You can read more about this <a href=/blog/openbikes-challenge>here</a>.</p><p>I&rsquo;m not going to go into a lot of depth with regards to the competition details, simply because everything is <a href=https://www.kaggle.com/c/defi-ia-insa-toulouse/overview>already explained on Kaggle</a>. In a nutshell, the goal of the competition is to predict a person&rsquo;s job from their bio. A bio is a short description of said person. For instance, the following job description corresponds to a professor:</p><blockquote><p>She is also a Ronald D. Asmus Policy Entrepreneur Fellow with the German Marshall Fund and is a Visiting Fellow at the Centre for International Studies (CIS) at the University of Oxford. This commentary first appeared at Sada, an online journal published by the Carnegie Endowment for International Peace.</p></blockquote><p>Along with the bio and the job title, we also know each person&rsquo;s gender. For the sake of simplicity we only considered cisgender people, and not LGBTQIA+ people. We also only included 20 different jobs. Note that we obtained our data following the opensource code provided with the 2019 Microsoft paper entitled <a href=https://www.microsoft.com/en-us/research/publication/bias-in-bios-a-case-study-of-semantic-representation-bias-in-a-high-stakes-setting/><em>Bias in Bios: A Case Study of Semantic Representation Bias in a High-Stakes Setting</em></a>.</p><p>In the above example, it&rsquo;s quite easy to guess that the bio corresponds to a professor. Words such as &ldquo;university&rdquo; and &ldquo;published&rdquo; are highly indicative of a professor. In my perception of reality, a university professor isn&rsquo;t necessarily associated with any gender in particular. This gut feeling is verified if we look at the competition data:</p><table><thead><tr><th style=text-align:left>category</th><th style=text-align:left>part</th><th style=text-align:left>female</th><th style=text-align:left>male</th></tr></thead><tbody><tr><td style=text-align:left>accountant</td><td style=text-align:left>test</td><td style=text-align:left>40.69%</td><td style=text-align:left>59.31%</td></tr><tr><td style=text-align:left>accountant</td><td style=text-align:left>train</td><td style=text-align:left>36.17%</td><td style=text-align:left>63.83%</td></tr><tr><td style=text-align:left>architect</td><td style=text-align:left>test</td><td style=text-align:left>24.21%</td><td style=text-align:left>75.79%</td></tr><tr><td style=text-align:left>architect</td><td style=text-align:left>train</td><td style=text-align:left>22.50%</td><td style=text-align:left>77.50%</td></tr><tr><td style=text-align:left>attorney</td><td style=text-align:left>test</td><td style=text-align:left>37.77%</td><td style=text-align:left>62.23%</td></tr><tr><td style=text-align:left>attorney</td><td style=text-align:left>train</td><td style=text-align:left>37.76%</td><td style=text-align:left>62.24%</td></tr><tr><td style=text-align:left>chiropractor</td><td style=text-align:left>test</td><td style=text-align:left>28.92%</td><td style=text-align:left>71.08%</td></tr><tr><td style=text-align:left>chiropractor</td><td style=text-align:left>train</td><td style=text-align:left>27.81%</td><td style=text-align:left>72.19%</td></tr><tr><td style=text-align:left>comedian</td><td style=text-align:left>test</td><td style=text-align:left>21.91%</td><td style=text-align:left>78.09%</td></tr><tr><td style=text-align:left>comedian</td><td style=text-align:left>train</td><td style=text-align:left>21.05%</td><td style=text-align:left>78.95%</td></tr><tr><td style=text-align:left>composer</td><td style=text-align:left>test</td><td style=text-align:left>16.57%</td><td style=text-align:left>83.43%</td></tr><tr><td style=text-align:left>composer</td><td style=text-align:left>train</td><td style=text-align:left>16.29%</td><td style=text-align:left>83.71%</td></tr><tr><td style=text-align:left>dentist</td><td style=text-align:left>test</td><td style=text-align:left>34.85%</td><td style=text-align:left>65.15%</td></tr><tr><td style=text-align:left>dentist</td><td style=text-align:left>train</td><td style=text-align:left>34.77%</td><td style=text-align:left>65.23%</td></tr><tr><td style=text-align:left>dietitian</td><td style=text-align:left>test</td><td style=text-align:left>92.74%</td><td style=text-align:left>7.26%</td></tr><tr><td style=text-align:left>dietitian</td><td style=text-align:left>train</td><td style=text-align:left>92.66%</td><td style=text-align:left>7.34%</td></tr><tr><td style=text-align:left>dj</td><td style=text-align:left>test</td><td style=text-align:left>14.80%</td><td style=text-align:left>85.20%</td></tr><tr><td style=text-align:left>dj</td><td style=text-align:left>train</td><td style=text-align:left>15.04%</td><td style=text-align:left>84.96%</td></tr><tr><td style=text-align:left>filmmaker</td><td style=text-align:left>test</td><td style=text-align:left>30.63%</td><td style=text-align:left>69.37%</td></tr><tr><td style=text-align:left>filmmaker</td><td style=text-align:left>train</td><td style=text-align:left>33.80%</td><td style=text-align:left>66.20%</td></tr><tr><td style=text-align:left>interior_designer</td><td style=text-align:left>test</td><td style=text-align:left>78.04%</td><td style=text-align:left>21.96%</td></tr><tr><td style=text-align:left>interior_designer</td><td style=text-align:left>train</td><td style=text-align:left>80.89%</td><td style=text-align:left>19.11%</td></tr><tr><td style=text-align:left>journalist</td><td style=text-align:left>test</td><td style=text-align:left>48.60%</td><td style=text-align:left>51.40%</td></tr><tr><td style=text-align:left>journalist</td><td style=text-align:left>train</td><td style=text-align:left>49.80%</td><td style=text-align:left>50.20%</td></tr><tr><td style=text-align:left>model</td><td style=text-align:left>test</td><td style=text-align:left>77.81%</td><td style=text-align:left>22.19%</td></tr><tr><td style=text-align:left>model</td><td style=text-align:left>train</td><td style=text-align:left>82.58%</td><td style=text-align:left>17.42%</td></tr><tr><td style=text-align:left>nurse</td><td style=text-align:left>test</td><td style=text-align:left>91.03%</td><td style=text-align:left>8.97%</td></tr><tr><td style=text-align:left>nurse</td><td style=text-align:left>train</td><td style=text-align:left>91.06%</td><td style=text-align:left>8.94%</td></tr><tr><td style=text-align:left>painter</td><td style=text-align:left>test</td><td style=text-align:left>45.45%</td><td style=text-align:left>54.55%</td></tr><tr><td style=text-align:left>painter</td><td style=text-align:left>train</td><td style=text-align:left>46.12%</td><td style=text-align:left>53.88%</td></tr><tr><td style=text-align:left>paralegal</td><td style=text-align:left>test</td><td style=text-align:left>86.46%</td><td style=text-align:left>13.54%</td></tr><tr><td style=text-align:left>paralegal</td><td style=text-align:left>train</td><td style=text-align:left>84.18%</td><td style=text-align:left>15.82%</td></tr><tr><td style=text-align:left>pastor</td><td style=text-align:left>test</td><td style=text-align:left>24.10%</td><td style=text-align:left>75.90%</td></tr><tr><td style=text-align:left>pastor</td><td style=text-align:left>train</td><td style=text-align:left>24.05%</td><td style=text-align:left>75.95%</td></tr><tr><td style=text-align:left>personal_trainer</td><td style=text-align:left>test</td><td style=text-align:left>42.72%</td><td style=text-align:left>57.28%</td></tr><tr><td style=text-align:left>personal_trainer</td><td style=text-align:left>train</td><td style=text-align:left>45.11%</td><td style=text-align:left>54.89%</td></tr><tr><td style=text-align:left>photographer</td><td style=text-align:left>test</td><td style=text-align:left>35.18%</td><td style=text-align:left>64.82%</td></tr><tr><td style=text-align:left>photographer</td><td style=text-align:left>train</td><td style=text-align:left>35.02%</td><td style=text-align:left>64.98%</td></tr><tr><td style=text-align:left>physician</td><td style=text-align:left>test</td><td style=text-align:left>40.45%</td><td style=text-align:left>59.55%</td></tr><tr><td style=text-align:left>physician</td><td style=text-align:left>train</td><td style=text-align:left>39.47%</td><td style=text-align:left>60.53%</td></tr><tr><td style=text-align:left>poet</td><td style=text-align:left>test</td><td style=text-align:left>47.77%</td><td style=text-align:left>52.23%</td></tr><tr><td style=text-align:left>poet</td><td style=text-align:left>train</td><td style=text-align:left>50.16%</td><td style=text-align:left>49.84%</td></tr><tr><td style=text-align:left>professor</td><td style=text-align:left>test</td><td style=text-align:left>45.50%</td><td style=text-align:left>54.50%</td></tr><tr><td style=text-align:left>professor</td><td style=text-align:left>train</td><td style=text-align:left>44.88%</td><td style=text-align:left>55.12%</td></tr><tr><td style=text-align:left>psychologist</td><td style=text-align:left>test</td><td style=text-align:left>61.96%</td><td style=text-align:left>38.04%</td></tr><tr><td style=text-align:left>psychologist</td><td style=text-align:left>train</td><td style=text-align:left>61.76%</td><td style=text-align:left>38.24%</td></tr><tr><td style=text-align:left>rapper</td><td style=text-align:left>test</td><td style=text-align:left>12.25%</td><td style=text-align:left>87.75%</td></tr><tr><td style=text-align:left>rapper</td><td style=text-align:left>train</td><td style=text-align:left>8.17%</td><td style=text-align:left>91.83%</td></tr><tr><td style=text-align:left>software_engineer</td><td style=text-align:left>test</td><td style=text-align:left>16.06%</td><td style=text-align:left>83.94%</td></tr><tr><td style=text-align:left>software_engineer</td><td style=text-align:left>train</td><td style=text-align:left>15.10%</td><td style=text-align:left>84.90%</td></tr><tr><td style=text-align:left>surgeon</td><td style=text-align:left>test</td><td style=text-align:left>14.16%</td><td style=text-align:left>85.84%</td></tr><tr><td style=text-align:left>surgeon</td><td style=text-align:left>train</td><td style=text-align:left>13.45%</td><td style=text-align:left>86.55%</td></tr><tr><td style=text-align:left>teacher</td><td style=text-align:left>test</td><td style=text-align:left>58.43%</td><td style=text-align:left>41.57%</td></tr><tr><td style=text-align:left>teacher</td><td style=text-align:left>train</td><td style=text-align:left>59.27%</td><td style=text-align:left>40.73%</td></tr><tr><td style=text-align:left>yoga_teacher</td><td style=text-align:left>test</td><td style=text-align:left>80.57%</td><td style=text-align:left>19.43%</td></tr><tr><td style=text-align:left>yoga_teacher</td><td style=text-align:left>train</td><td style=text-align:left>85.06%</td><td style=text-align:left>14.94%</td></tr></tbody></table><p>Other jobs are more polarised. For instance, rappers are mostly men and yoga teachers are typically women. This is just the way things are in modern western societies. I am in no position to say if this state of things is good or bad. What I do know is that machine learning models replicate the bias that can be found in data in their predictions. Machine learning models are meant to be accurate, and therefore would rely on gendered words such as &ldquo;she&rdquo; and &ldquo;his&rdquo; to make their predictions. Machine learning is very pragmatic that way.</p><p>For whatever reason, we might want to build models that don&rsquo;t exploit gender to make a prediction. We might want to do this because as a society we believe that each gender should be equally represented in each job &ndash; note that I&rsquo;m not expressing an opinion. To do so we may want to break the negative reinforcement loop that automated decisions would entail. Concretely, we could prefer to have a decision process that is less accurate while being fairer. There is a whole area of research called <a href=https://www.wikiwand.com/en/Fairness_(machine_learning)>fair learning</a> that tackles these questions.</p><p>Fair learning is very exciting, and we thought it would be worthwhile to include fairness as a competition metric. The main goal being to encourage students to discover fair learning by themselves, as it not necessarily a topic that is being taught in their curriculums.</p><h2 id=the-fairness-metric>The fairness metric</h2><p>What is fair? It&rsquo;s a very vague concept when you think about it for a bit. I&rsquo;m not going to into a lot of detail as many things have already been written on the topic. For instance, see <a href=https://blog.acolyer.org/2020/02/03/measure-mismeasure-fairness/>this light article</a> by Adrian Colyer (aka the morning paper).</p><p><img src=/img/blog/fairness-competition/def.jpg width=80%></p><p>We went with the notion of <a href=https://www.wikiwand.com/en/Disparate_impact>disparate impact</a>. Essentially, our motivation was for the students to make predictions that are not biased towards one gender in particular. For instance, if we tallied up all the &ldquo;rapper&rdquo; predictions, well we would consider a model to be fair if 50% of those predictions are for women and 50% are for men. We compute the disparate impact for each job and average them in order to obtain a so-called &ldquo;macro disparate impact&rdquo;:</p><p>$$
\frac{1}{jobs} \sum_{job \in jobs} \frac{max(P(male \mid job), P(female \mid job))}{min(P(male \mid job), P(female \mid job))}
$$</p><p>This metric is very straighforward to compute. Say you have a <code>people</code> dataframe that associates job predictions with genders:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>people</span><span class=o>.</span><span class=n>head</span><span class=p>()</span>
</span></span><span class=line><span class=cl>           <span class=n>job</span> <span class=n>gender</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>    <span class=n>professor</span>      <span class=n>F</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=n>accountant</span>      <span class=n>M</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>    <span class=n>professor</span>      <span class=n>M</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=n>architect</span>      <span class=n>M</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>    <span class=n>architect</span>      <span class=n>M</span>
</span></span></code></pre></div><p>The <code>job</code> column corresponds to the predictions made by a model. The <code>gender</code> column is a ground-truth. We simply have to build the pivot table I showed above and count the number of times each gender appears for each job.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>def</span> <span class=nf>macro_disparate_impact</span><span class=p>(</span><span class=n>people</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>counts</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>people</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>groupby</span><span class=p>([</span><span class=s1>&#39;job&#39;</span><span class=p>,</span> <span class=s1>&#39;gender&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>size</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>unstack</span><span class=p>(</span><span class=s1>&#39;gender&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>disparate_impacts</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>counts</span><span class=p>[[</span><span class=s1>&#39;M&#39;</span><span class=p>,</span> <span class=s1>&#39;F&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=s1>&#39;columns&#39;</span><span class=p>)</span> <span class=o>/</span>
</span></span><span class=line><span class=cl>        <span class=n>counts</span><span class=p>[[</span><span class=s1>&#39;M&#39;</span><span class=p>,</span> <span class=s1>&#39;F&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>min</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=s1>&#39;columns&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>disparate_impacts</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span></code></pre></div><p>Note that the Kaggle leaderboard ranking used the macro F1 score proposed on the platform. Kaggle effectively locks you in and doesn&rsquo;t allow you to provide a custom metric. Therefore, once the competition was over, I downloaded the best private submission from each team and ran this metric myself on each submission. Thankfully, Kaggle&rsquo;s admin interface for managing submissions is quite good.</p><p>I picked this metric because it makes sense to me. It encourages a model to be discriminative in a good
way. To minimise the metric, a model has to restrain itself from assigning the most likely job to a person. In other words, the model <em>necessarily</em> has to be less accurate. But it&rsquo;s a tradeoff! I think this pretty cool, and as far as I know this hasn&rsquo;t been done on Kaggle before.</p><p>In the case of this competition, we assume that the goal is to reach a perfect balance of men and women for each job. However, we could perfectly well imagine a more nuanced goal. For instance, we could say that we would like 30% of rappers to be women and 70% to be men. This would still be &ldquo;better&rdquo; than a 10%/90% split &ndash; which is the reality &ndash; but might also be more realistic.</p><p>One thing to notice is that a perfect macro disparate impact of 1 is only achievable if the genders are balanced. I only realised this after starting the competition thanks a remark from Philippe Besse. It was kindly suggested to me to normalise by the size of each gender pool in order to account for gender imbalance. In the end it didn&rsquo;t matter that much because there are only slightly more men than women in the dataset. Moreover, the point of this metric is simply to rank the competitors, and this imbalance equally affects each competitor.</p><h2 id=what-people-did>What people did</h2><p>Once the competition was over, the students were instructed to send me their code. This was mostly to verify they hadn&rsquo;t cheated in any way. It also allowed me to inspect what they had done. Moreover, teams that didn&rsquo;t send their code were not eligible to the final ranking. Out of the 78 teams, only 30 sent me their code. Here are some statistics:</p><ul><li>Everyone used Python. That&rsquo;s somewhat interesting because during the past years there were still some teams that used R.</li><li>Apart from one team, everyone sent me one or more <a href=https://jupyter.org/>Jupyter Notebooks</a>. I wonder if they know about Jupyter Lab 😉</li><li>14 used some flavor of <a href=https://www.wikiwand.com/en/BERT_(language_model)>BERT</a>.</li><li>14 preprocessed the text in some way (lowercasing, stemming, stop words, etc.)</li><li>Absolutely no team did any effort to make their model fairer with respect to both genders 😩</li><li>2 did <a href=https://www.wikiwand.com/en/Cross-validation_(statistics)>cross-validation</a>. The rest did a simple train/test split, if that.</li><li>8 used a <a href=https://www.wikiwand.com/en/Tf%E2%80%93idf>TF-IDF</a> approach.</li><li>16 really used <a href=https://scikit-learn.org/stable/>scikit-learn</a>. Other teams used scikit-learn only for metrics and train/test splitting.</li><li>My estimate is that 17 teams made a real effort. From what I can tell, the 12 others just mindlessly imported libraries, figured out the API, and <a href=https://tenor.com/view/and-thats-it-guys-its-awrap-finished-lets-call-it-aday-happy-gif-14375900>called it a day</a>.</li><li>10 used Hugging Face&rsquo;s <a href=https://huggingface.co/transformers/>transformers</a> library.</li><li>4 did data augmentation.</li><li>8 did exploratory data analysis (EDA), although others might have done but didn&rsquo;t include it in what they showed me.</li><li>12 used <a href=https://www.nltk.org/>NLTK</a>, which I find pretty cool considering how old it is.</li><li>2 attempted to <a href=https://github.com/scikit-learn-contrib/imbalanced-learn>rebalance</a> the dataset.</li><li>2 built their own model in <a href=https://pytorch.org/>PyTorch</a>.</li><li>8 built their own odel with <a href=https://keras.io/>Keras</a>.</li><li>3 built an <a href=https://www.wikiwand.com/en/Recurrent_neural_network>RNN</a>.</li><li>2 did <a href=https://www.wikiwand.com/en/Ensemble_learning>model ensembling</a>.</li><li>7 used the <a href=https://github.com/ThilinaRajapakse/simpletransformers>simpletransformers</a> library, which I find to be frightfully high level.</li><li>2 used <a href=https://spacy.io/>spaCy</a></li><li>2 used <a href=https://radimrehurek.com/gensim/>Gensim</a></li></ul><p>Overall, I found the code quality to be quite poor. Most notebooks were very bloated with dozens of imports, many commented lines, long uncommented blocks of obscure logic. Another striking observation is that there were few similarities between different notebooks in terms of code structure. The fit/predict paradigm remains, but there seems to be little convention as to the rest of the machine learning lifecycle. Each team invented its own little paradigms and didn&rsquo;t necessarily take the time to organise and rethink its approach. A positive note is that I can see that most teams made a good effort and spent time exploring the library ecosystem.</p><h2 id=rankings>Rankings</h2><p>The <a href=https://www.kaggle.com/c/defi-ia-insa-toulouse/leaderboard>Kaggle leaderboard</a> measured the macro F1 score of the job predictions. In other words, the goal was simply to be as accurate as possible. I then took the 10 highest performers on the private leaderboard and measured their macro disparate impact to establish the fairness rankings. I did this to highlight the tradeoff that had to be made between accuracy and fairness. For instance, a very accurate solution is cool but it won&rsquo;t get to be used in a real-world application if we know it&rsquo;s not fair. Likewise, it&rsquo;s very easy to provide a perfectly solution by simply flipping a coin, but there&rsquo;s no point in doing so if the predictions are not accurate as well.</p><p><img src=/img/blog/fairness-competition/scores.svg width=80%></p><p>I mentionned above that a perfect macro disparate impact is equal to 1. The macro disparate impact in the data is 3.62. That is, if we use the ground truth labels as predictions and compute the macro disparate impact, then we obtain 3.62. The point of this competition is to do better than this, and not just focus on the predictive performance of the model.</p><p>Sadly, it seems that no teams managed to really remove any bias whatsoever from their model. I&rsquo;ll be honest: I&rsquo;m very disappointed with the way this turned out. The best performing teams seem to have made no effort whatsoever. Fair learning is a relatively sophisticated topic, so I wouldn&rsquo;t be surprised that students had some difficulties. With the whole COVID 19 situation, the relationship between teachers and students might have been affected, and teachers might not have had the opportunity to discuss a topic that is not part of the official curriculum with their students.</p><p>And yet, my gut feeling is that many teams have had the wrong focus. Having looked at each team&rsquo;s code, most people used very sophisticated neural networks based on transformer architectures. That&rsquo;s great, because I know for a fact that the latter are not part of the official curriculum in French schools as well, so it shows some form of motivation. However, I&rsquo;m worried that students used a &ldquo;toolbox&rdquo; approach whereby they imported and trained a fancy model because it&rsquo;s the <em>goût du jour</em>.</p><p>In my opinion, if a student is able to understand BERT and transformers, then surely she is capable of understanding fair learning. The problem is that I believe that they don&rsquo;t understand these notions very well. Instead, they only manage to figure out the API provided by a library they found on GitHub and imported in their notebook. I fear that they simply didn&rsquo;t do any fair learning because the toolboxes they used didn&rsquo;t provide any fair learning capability. That&rsquo;s very worrying. It might also hint at a blindspot in the library ecosystem. I would love to be wrong about all this.</p><p>Here is the ranking with respect to fairness for the top 10 competitors on the Kaggle private leaderboard:</p><table><thead><tr><th style=text-align:left>Country</th><th style=text-align:left>School</th><th style=text-align:left>Team name</th><th style=text-align:left>Macro F1</th><th style=text-align:left>Disparate impact</th><th style=text-align:center>Sent code</th></tr></thead><tbody><tr><td style=text-align:left>France</td><td style=text-align:left>UPS</td><td style=text-align:left>Test</td><td style=text-align:left>0.81971</td><td style=text-align:left>3.49578</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left>France</td><td style=text-align:left>ENSEEIHT</td><td style=text-align:left>Pyramids</td><td style=text-align:left>0.82685</td><td style=text-align:left>3.74924</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left>France</td><td style=text-align:left>UPS</td><td style=text-align:left>FairleNessSROnly</td><td style=text-align:left>0.81443</td><td style=text-align:left>3.94925</td><td style=text-align:center>❌</td></tr><tr><td style=text-align:left>France</td><td style=text-align:left>INSA</td><td style=text-align:left>Salle104</td><td style=text-align:left>0.82598</td><td style=text-align:left>3.95849</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left>France</td><td style=text-align:left>UR2</td><td style=text-align:left>WeTried</td><td style=text-align:left>0.84247</td><td style=text-align:left>4.00975</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left>Cameroun</td><td style=text-align:left>ENSPY</td><td style=text-align:left>Fred</td><td style=text-align:left>0.82733</td><td style=text-align:left>4.03571</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left>France</td><td style=text-align:left>Université de Bordeaux</td><td style=text-align:left>CMI ISI datadax</td><td style=text-align:left>0.81639</td><td style=text-align:left>4.10829</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left>Cameroun</td><td style=text-align:left>ENSPY</td><td style=text-align:left>GI</td><td style=text-align:left>0.82446</td><td style=text-align:left>4.13195</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left>France</td><td style=text-align:left>Université Jean Monnet</td><td style=text-align:left>Minions</td><td style=text-align:left>0.82354</td><td style=text-align:left>4.23495</td><td style=text-align:center>✅</td></tr><tr><td style=text-align:left>France</td><td style=text-align:left>UJM</td><td style=text-align:left>BravoNils</td><td style=text-align:left>0.82932</td><td style=text-align:left>4.26414</td><td style=text-align:center>✅</td></tr></tbody></table><p><em>Note: I removed Olivier Chotin from the ranking because he&rsquo;s not a student.</em></p><p>Again, I&rsquo;m quite disappointed with these standings from an effort point of view. While writing this blog post, I took 10 minutes to see the effect of replacing &ldquo;he&rdquo; by &ldquo;she&rdquo; and &ldquo;his&rdquo; by &ldquo;her&rdquo; on a plain and simple logistic regression. In my cross-validation, the macro disparate impact went from 5.11 and 3.85 and the macro F1 score remained simple. It would have been nice to see at least a couple of teams that produced some decent fairness results. Alas, I&rsquo;m sorry to say, these models wouldn&rsquo;t be used. Regardless of their accuracy, the main objective of this competition was to reduce the disparate impact.</p><p>With regards to the macro F1 score that was used to establish the Kaggle leaderboard, here is a summary of the best solution with a breakdown by job:</p><pre tabindex=0><code>                   precision    recall  f1-score   support

       accountant       0.78      0.88      0.83       694
        architect       0.75      0.84      0.79      1371
         attorney       0.94      0.91      0.92      4832
     chiropractor       0.69      0.81      0.75       284
         comedian       0.86      0.88      0.87       386
         composer       0.94      0.89      0.91       897
          dentist       0.96      0.95      0.96      1463
        dietitian       0.87      0.88      0.87       545
               dj       0.83      0.88      0.86       211
        filmmaker       0.88      0.88      0.88      1012
interior_designer       0.78      0.83      0.80       201
       journalist       0.85      0.82      0.83      3068
            model       0.85      0.89      0.87       978
            nurse       0.87      0.91      0.89      2977
          painter       0.87      0.85      0.86      1128
        paralegal       0.69      0.91      0.78       174
           pastor       0.78      0.72      0.75       393
 personal_trainer       0.79      0.84      0.81       194
     photographer       0.92      0.90      0.91      3731
        physician       0.77      0.81      0.79      2715
             poet       0.84      0.84      0.84      1107
        professor       0.95      0.92      0.93     18266
     psychologist       0.81      0.85      0.83      2514
           rapper       0.90      0.86      0.88       212
software_engineer       0.83      0.79      0.81      1013
          surgeon       0.80      0.86      0.83      1516
          teacher       0.69      0.72      0.71      2147
     yoga_teacher       0.81      0.74      0.78       271

         accuracy                           0.88     54300
        macro avg       0.83      0.85      0.84     54300
     weighted avg       0.88      0.88      0.88     54300
</code></pre><p>It seems that the F1 scores are lower for jobs that are less biased towards either gender. For instance, the model performs worse for physicians and teachers than for rappers and nurses. This could be indicative that the model uses gendered words to help it make its predictions, which is worrying. Then again, the model performs very well for teachers, but that could also be because teachers are easy to identify. I didn&rsquo;t go very deep into any kind of analysis, but I&rsquo;m confident it would yield interesting results.</p><p>It turns out that 1,927 out of the 54,300 test documents were incorrectly classified by each of the 78 teams. Here are some of these documents:</p><details><summary>14023 - everyone said yoga teacher</summary><p style='margin:0 11px'>She offers a free and creative approach to Yoga. Reni's classes are designed intelligently to achieve specific goals and energetic effects. Her teaching is based on the method of Therapeutic Yoga in order to promote wellbeing and health in people's life. Find out more...</p><details style='margin:9px 11px'><summary>Ground truth label</summary><p style='margin:0 11px'>teacher</p></details></details><details><summary>15386 - everyone said professor</summary><p style='margin:0 11px'>He is working on a project tentatively titled "Slaves and Soldiers in the Red and Black Atlantic: A Transnational and Revolutionary History of the American Civil War." He earned his Ph.D. from the University of California, San Diego in 1998 and has published numerous books including "Cotton Booms, Cotton Busts, and the Civil War in West Africa," "Primitive Art, Primitive Accumulation, and the Origin of the Work of Art in German New Guinea," and "Three Logics of Race: Theory and Exception in the Transnational History of Empire.</p><details style='margin:9px 11px'><summary>Ground truth label</summary><p style='margin:0 11px'>teacher</p></details></details><details><summary>37968 - everyone said professor</summary><p style='margin:0 11px'>Broadly her research focuses on behavioral and social responses to maternal and child wellness. For her dissertation, she received a NRSA pre-doctoral fellowship from NIMH to conduct an RCT using a theory-based approach to promote exclusive breastfeeding among women living with HIV in South Africa. Dr. Tuthill is particularly interested in developing sustainable solutions for perinatal women that address the dynamic intersections of mental health, food insecurity, infant feeding and overall health (including disease risk and status) for mothers and their infants, both domestically and globally.</p><details style='margin:9px 11px'><summary>Ground truth label</summary><p style='margin:0 11px'>nurse</p></details></details><details><summary>1517 - 46 said photographer, 32 said painter</summary><p style='margin:0 11px'>He recently returned from performing at the Montreal Just For Laugh's Festival and is part of the Top 30 YouTube comedy channel “KeepTheHeat”. Their sketches and parodies have more than 260,000,000 views. As far as comedy style is concerned, Dominic takes pride in being a joke-teller and not a story-teller.</p><details style='margin:9px 11px'><summary>Ground truth label</summary><p style='margin:0 11px'>comedian</p></details></details><details><summary>5775 - everyone said professor</summary><p style='margin:0 11px'>Her research interests are in blended learning and the use of information technology in education. Previously, she has published several papers on student motivation, satisfaction, achievement, and critical thinking and problem-solving skills in tertiary education.</p><details style='margin:9px 11px'><summary>Ground truth label</summary><p style='margin:0 11px'>teacher</p></details></details><details><summary>2750 - 36 said teacher, 18 said teacher, 14 said journalist</summary><p style='margin:0 11px'>He was a contributor for OP’s issue No. 2, “Paris Existrans 2009,” which was an exclusive man-on-the-street spread highlighting Paris Trans March. Most recently, Elliot contributed to the OP blog with Buck Angel: Swedish Exclusive.</p><details style='margin:9px 11px'><summary>Ground truth label</summary><p style='margin:0 11px'>photographer</p></details></details><details><summary>38146 - most people said journalist, some said professor</summary><p style='margin:0 11px'>Contact him at: snorre_lindquist@hotmail.com. Lasse Wilhelmson is a commentator on the situation in the Middle East, and has been a member of a local government in Sweden for 23 years, four of which in an executive position. Contact him at: lassewilhelmson@bredband.net. Read other articles by Snorre Lindquist and Lasse Wilhelmson.</p><details style='margin:9px 11px'><summary>Ground truth label</summary><p style='margin:0 11px'>architect</p></details></details><p>The above examples explain why the model performances are not closer to 100%. Some labels are very similar in meaning (professor ≃ teacher). Some observations seem to be mislabeled, such as the last one, which is clearly not an architect. Welcome to the real world of dirty data!</p><p>Here are some a couple examples where roughly half of the teams were correct and the rest were not:</p><details><summary>937 - 36 said professor, 42 said psychologist</summary><p style='margin:0 11px'>His experience includes working for Microsoft, HSBC Bank Argentina in Human Resources and several mental health facilities performing clinical work . In 2008 he was recruited in Argentina by the Devereux Foundation, the biggest mental health care provider in the USA as a residential counselor and then subsequently changed positions into coordinating and managing some of the foundation's programs. Check out his site http://fernandotarnogol.com/.</p><details style='margin:9px 11px'><summary>Ground truth label</summary><p style='margin:0 11px'>psychologist</p></details></details><details><summary>1037 - 37 said professor, 40 said physician, 1 said surgeon</summary><p style='margin:0 11px'>His specializes in neuro-ophthalmology, with special interest in the treatment of thyroid eye disease, disorders that cause double vision in adults and orbital and skull base tumors. His clinical practice includes patients with all types of disorders of the optic nerve and orbit. Dr. Subramanian is the principal investigator in clinical trials on treatments for thyroid eye disease and idiopathic intracranial hypertension and is conducting research on how to treat vision problems in patients with traumatic brain injury.</p><details style='margin:9px 11px'><summary>Ground truth label</summary><p style='margin:0 11px'>professor</p></details></details><p>Regarding tidyness, there are three teams that stood out to me in the following order:</p><ol><li>&ldquo;ANALYTICS&rdquo; from Yamoussoukro&rsquo;s INPHB.</li><li>&ldquo;Fred&rdquo; from Yaounde&rsquo;s ENSPY.</li><li>&ldquo;ISI datadax&rdquo; from the University of Bordeaux.</li></ol><p>They did a good job at organising their code. They also explained what they were doing, and demonstrated that they made a real effort to understand what they were doing. There was some confusion along the way in certain cases, but overall it was decent.</p><h2 id=conclusion>Conclusion</h2><p>I would like to thank the professors that contributed to organising this competition. Hopefully this competition helped to shed some light on the need to teach the basics of fair machine learning to data science students.</p><p>On a personal level, I&rsquo;m mildly disappointed with the turn out. Until now, the competition kept growing in size. I actually thought that COVID 19 would increase the turnout because this was a completely virtual event. I&rsquo;m not a student anymore so I&rsquo;m not sure what is the state of things though. In any case, this edition wasn&rsquo;t very rewarding for me. I do this <em>pro bono</em> so it helps when people are actively participating. I also got a lot of emails ranting about the fairness metric without proposing any alternative. Many students asked me questions that I had clearly instructed the teachers to provide to said students. Nobody used the forum and instead sent me personal emails, which I find sad. The whole point of these competitions is to create a sense of togetherness and allow students from differents schools/countries to meet each other.</p><p>Nonetheless, I got some positive feedback from a significant number of students. Hopefully, this competition will have provided them with a decent setting to explore the ever-changing world of NLP. Even though it seems the students didn&rsquo;t put a lot of effort into the fair learning aspect, hopefully they&rsquo;re now aware of the concept and will it in mind during their professional career.</p><p>For the participants, here are the <a href=/files/fairness_competition/test_labels.csv>test labels</a> as well as the <a href=/files/fairness_competition/standings.csv>final standings</a>.</p><p>Feel free to reach out and/or comment if you have any questions!</p><p>Edit: after having presented this blog post to the students on Zoom, I realised that some teams had in fact tackled the fairness problem. I sincerely apologise for being so brash in saying that no team made any effort. I believe I mostly missed this because the fairness scores of the teams that sent me their solution didn&rsquo;t do that well in terms of fairness.</p></div><script type=text/javascript>var s=document.createElement("script");s.setAttribute("src","https://utteranc.es/client.js"),s.setAttribute("repo","MaxHalford/maxhalford.github.io"),s.setAttribute("issue-term","pathname"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",null),s.setAttribute("theme","github-light"),document.body.appendChild(s)</script><div style=display:flex;flex-direction:row;justify-content:center;align-items:center;gap:20px;margin-bottom:30px><div class=do-the-thing><div class=elevator><svg class="sweet-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" enable-background="new 0 0 100 100" height="100" width="100"><path d="M70 47.5H30c-1.4.0-2.5 1.1-2.5 2.5v40c0 1.4 1.1 2.5 2.5 2.5h40c1.4.0 2.5-1.1 2.5-2.5V50C72.5 48.6 71.4 47.5 70 47.5zm-22.5 40h-5v-25h5v25zm10 0h-5v-25h5v25zm10 0h-5V60c0-1.4-1.1-2.5-2.5-2.5H40c-1.4.0-2.5 1.1-2.5 2.5v27.5h-5v-35h35v35z"/><path d="M50 42.5c1.4.0 2.5-1.1 2.5-2.5V16l5.7 5.7c.5.5 1.1.7 1.8.7s1.3-.2 1.8-.7c1-1 1-2.6.0-3.5l-10-10c-1-1-2.6-1-3.5.0l-10 10c-1 1-1 2.6.0 3.5 1 1 2.6 1 3.5.0l5.7-5.7v24c0 1.4 1.1 2.5 2.5 2.5z"/></svg>
Back to the top</div></div><iframe src=https://github.com/sponsors/MaxHalford/button title="Sponsor MaxHalford" height=32 width=114 style=border:0;border-radius:6px></iframe></div><script src=https://cdnjs.cloudflare.com/ajax/libs/elevator.js/1.0.1/elevator.min.js></script><script>var elementButton=document.querySelector(".elevator"),elevator=new Elevator({element:elementButton,mainAudio:"/music/elevator.mp3",endAudio:"/music/ding.mp3"})</script><style>.down-arrow{font-size:120px;margin-top:90px;margin-bottom:90px;text-shadow:0 -20px #0c1f31,0 0 #c33329;color:transparent;-webkit-transform:scaleY(.8);-moz-transform:scaleY(.8);transform:scaleY(.8)}.elevator{text-align:center;cursor:pointer;width:140px;margin:auto}.elevator:hover{opacity:.7}.elevator svg{width:40px;height:40px;display:block;margin:auto;margin-bottom:5px}</style><div class=related-content><h3 style=margin-top:10px!important;margin-bottom:10px!important>Related posts</h3><ul style=margin-top:0><li><a href=/blog/openbikes-challenge/>A short introduction and conclusion to the OpenBikes 2016 Challenge</a></li></ul></div></div></div></article></body></html>