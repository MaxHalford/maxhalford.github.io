<!doctype html><html lang=en><head><script defer src=https://unpkg.com/@tinybirdco/flock.js data-host=https://api.tinybird.co data-token=p.eyJ1IjogImMwMjJhMjg1LWJmY2YtNDc0OC1hYzczLTJhMDQ1Njk3NTI0YyIsICJpZCI6ICIzNjc3NjQ3Ny04MTE2LTRmYWQtYjcwMy1iZmM3YjMwZGJjMjMifQ.A0vHm-VWbXG6uBFZiwuspN_AyfSYNrdZE3IgwgWSt4g></script><meta charset=utf-8><meta name=generator content="Hugo 0.116.0"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Max Halford"><meta property="og:url" content="https://maxhalford.github.io/blog/textract-table-to-pandas/"><link rel=canonical href=https://maxhalford.github.io/blog/textract-table-to-pandas/><meta property="og:title" content="Converting Amazon Textract tables to pandas DataFrames"><meta property="og:description" content="I&rsquo;m currently doing a lot of document processing at work. One of my tasks is to extract tables from PDF files. I evaluated Amazon Textract&rsquo;s table extraction capability as part of this task. It&rsquo;s very well documented, as is the rest of Textract. I was slightly disappointed by the examples, but nothing serious.
I wanted to write this short blog post to share a piece of code I use to convert tables extracted through Amazon Textract to pandas."><meta property="og:type" content="article"><meta property="og:url" content="https://maxhalford.github.io/blog/textract-table-to-pandas/"><meta property="og:image" content="https://maxhalford.github.io/img/beach.jpg"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-01-14T00:00:00+00:00"><meta property="article:modified_time" content="2021-01-14T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://maxhalford.github.io/img/beach.jpg"><meta name=twitter:title content="Converting Amazon Textract tables to pandas DataFrames"><meta name=twitter:description content="I&rsquo;m currently doing a lot of document processing at work. One of my tasks is to extract tables from PDF files. I evaluated Amazon Textract&rsquo;s table extraction capability as part of this task. It&rsquo;s very well documented, as is the rest of Textract. I was slightly disappointed by the examples, but nothing serious.
I wanted to write this short blog post to share a piece of code I use to convert tables extracted through Amazon Textract to pandas."><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü¶î</text></svg>"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/maxhalford.github.io\/"},"articleSection":"blog","name":"Converting Amazon Textract tables to pandas DataFrames","headline":"Converting Amazon Textract tables to pandas DataFrames","description":"I\u0026rsquo;m currently doing a lot of document processing at work. One of my tasks is to extract tables from PDF files. I evaluated Amazon Textract\u0026rsquo;s table extraction capability as part of this task. It\u0026rsquo;s very well documented, as is the rest of Textract. I was slightly disappointed by the examples, but nothing serious.\nI wanted to write this short blog post to share a piece of code I use to convert tables extracted through Amazon Textract to pandas.","inLanguage":"en-US","author":"Max Halford","creator":"Max Halford","publisher":"Max Halford","accountablePerson":"Max Halford","copyrightHolder":"Max Halford","copyrightYear":"2021","datePublished":"2021-01-14 00:00:00 \u002b0000 UTC","dateModified":"2021-01-14 00:00:00 \u002b0000 UTC","url":"https:\/\/maxhalford.github.io\/blog\/textract-table-to-pandas\/","keywords":["text-processing"]}</script><title>Converting Amazon Textract tables to pandas DataFrames ‚Ä¢ Max Halford</title><meta property="og:title" content="Converting Amazon Textract tables to pandas DataFrames ‚Ä¢ Max Halford"><meta property="og:type" content="article"><meta name=description content="I&rsquo;m currently doing a lot of document processing at work. One of my tasks is to extract tables from PDF files. I evaluated Amazon Textract&rsquo;s table extraction capability as part of this task. It&rsquo;s very well documented, as is the rest of Textract. I was slightly disappointed by the examples, but nothing serious.
I wanted to write this short blog post to share a piece of code I use to convert tables extracted through Amazon Textract to pandas."><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.css><link rel=stylesheet href=/css/github-markdown.min.css><link rel=stylesheet href=/css/highlight/github.css><link rel=stylesheet href=/css/index.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&family=Permanent+Marker&display=swap" rel=stylesheet><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0,tags:"ams"},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body><article class=post id=article><div class="row center-xs" style=text-align:left><div class="col-xs-12 col-sm-10 col-md-7 col-lg-5"><div class=header><header class=header-parts><div class="signatures site-title"><a href=/>Max Halford ü¶î</a></div><div class=header-links><a class=header-link href=/>Blog</a>
<a class=header-link href=/links/>Links</a>
<a class=header-link href=/bio/>Bio</a></div></header></div><header class=post-header><h1 class=post-title>Converting Amazon Textract tables to pandas DataFrames</h1><div class="row post-desc"><div class="col-xs-12 post-desc-items"><time class=post-date datetime="2021-01-14 00:00:00 UTC">2021-01-14</time>
<span class=posts-line-tag>text-processing</span></div></div></header><div class="post-content markdown-body"><p>I&rsquo;m currently doing a lot of document processing at work. One of my tasks is to extract tables from PDF files. I evaluated <a href="https://aws.amazon.com/textract/?nc1=h_ls">Amazon Textract</a>&rsquo;s <a href=https://docs.aws.amazon.com/textract/latest/dg/how-it-works-tables.html>table extraction</a> capability as part of this task. It&rsquo;s very well documented, as is the rest of Textract. I was slightly disappointed by <a href=https://docs.aws.amazon.com/textract/latest/dg/examples-blocks.html>the examples</a>, but nothing serious.</p><p>I wanted to write this short blog post to share a piece of code I use to convert tables extracted through Amazon Textract to <a href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html><code>pandas.DataFrame</code></a>s. I&rsquo;ll be using the following anonymised image as an example:</p><img class=centered src=/img/blog/textract-table-to-pandas/example.jpg><p>You can process PDF files with Amazon Textract, but only in <a href=https://docs.aws.amazon.com/textract/latest/dg/async.html>asynchronous mode</a>. That implies uploading a job to a queue and waiting for the job to be done. You can however process images in synchronous mode via a simple API call. Therefore, you could convert a PDF file to an image in Python with <a href=https://pypi.org/project/pdf2image/><code>pdf2image</code></a> in order to process it synchronously. In this example I&rsquo;m just using an image though.</p><p>The first step is to load the image, which can be done with <a href=https://www.wikiwand.com/en/Python_Imaging_Library>PIL</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>im</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=s1>&#39;example.jpg&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>Amazon Textract expects the image to be encoded via the <a href=https://www.wikiwand.com/en/Base64>Base64</a> encoding scheme. This is very easy to do in Python:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>io</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>buffered</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>BytesIO</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>im</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>buffered</span><span class=p>,</span> <span class=nb>format</span><span class=o>=</span><span class=s1>&#39;PNG&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>Next, we want to call the Amazon Textract API. The easiest way to proceed is to use <a href=https://boto3.amazonaws.com/v1/documentation/api/latest/index.html><code>boto3</code></a>, which is the official Python SDK for interacting with AWS. Setting up <code>boto3</code> and linking it to your AWS account is <a href=https://boto3.amazonaws.com/v1/documentation/api/latest/guide/quickstart.html>well explained</a> in the official documentation. Once this is done, calling Textract is trivial:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;textract&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>response</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>analyze_document</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>Document</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;Bytes&#39;</span><span class=p>:</span> <span class=n>buffered</span><span class=o>.</span><span class=n>getvalue</span><span class=p>()},</span>
</span></span><span class=line><span class=cl>    <span class=n>FeatureTypes</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;TABLES&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>We specify the <code>'TABLES'</code> feature to tell Textract to find the tables in the document. There&rsquo;s also a <code>'FORMS'</code> feature, but that&rsquo;s for key/value forms, where the keys and the values are typically separated by two points (<code>:</code>).</p><p>The response from Textract is made up of a list of blocks. Each block represents a piece of the document. A block is defined by a geometric bounding box. Blocks are related to each other in a parent/child paradigm. There are four types of blocks which we are interested in:</p><ul><li>A <code>WORD</code>.</li><li>A <code>SELECTION_ELEMENT</code>, which is essentially a checkbox.</li><li>A <code>CELL</code>, which is a block that contains one or more <code>WORD</code>s and/or a <code>SELECTION_ELEMENT</code>.</li><li>A <code>TABlE</code>, which is made up of <code>CELL</code>s.</li></ul><p>The response data is not nested. The children of a block are specified in said block. For instance, here&rsquo;s a <code>CELL</code> block:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=p>{</span><span class=s1>&#39;BlockType&#39;</span><span class=p>:</span> <span class=s1>&#39;CELL&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;ColumnIndex&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;ColumnSpan&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;Confidence&#39;</span><span class=p>:</span> <span class=mf>99.99826049804688</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;Geometry&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;BoundingBox&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;Height&#39;</span><span class=p>:</span> <span class=mf>0.06898262351751328</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                              <span class=s1>&#39;Left&#39;</span><span class=p>:</span> <span class=mf>0.055694881826639175</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                              <span class=s1>&#39;Top&#39;</span><span class=p>:</span> <span class=mf>0.6720325350761414</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                              <span class=s1>&#39;Width&#39;</span><span class=p>:</span> <span class=mf>0.02915901131927967</span><span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;Polygon&#39;</span><span class=p>:</span> <span class=p>[{</span><span class=s1>&#39;X&#39;</span><span class=p>:</span> <span class=mf>0.055994194000959396</span><span class=p>,</span> <span class=s1>&#39;Y&#39;</span><span class=p>:</span> <span class=mf>0.6733753085136414</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                          <span class=p>{</span><span class=s1>&#39;X&#39;</span><span class=p>:</span> <span class=mf>0.084853895008564</span><span class=p>,</span> <span class=s1>&#39;Y&#39;</span><span class=p>:</span> <span class=mf>0.6720325350761414</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                          <span class=p>{</span><span class=s1>&#39;X&#39;</span><span class=p>:</span> <span class=mf>0.08466880023479462</span><span class=p>,</span> <span class=s1>&#39;Y&#39;</span><span class=p>:</span> <span class=mf>0.7396966218948364</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                          <span class=p>{</span><span class=s1>&#39;X&#39;</span><span class=p>:</span> <span class=mf>0.055694881826639175</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                           <span class=s1>&#39;Y&#39;</span><span class=p>:</span> <span class=mf>0.7410151362419128</span><span class=p>}]},</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;Id&#39;</span><span class=p>:</span> <span class=s1>&#39;2bbfde52-e68a-4d5d-b479-2a86d8525dbb&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;Relationships&#39;</span><span class=p>:</span> <span class=p>[{</span><span class=s1>&#39;Ids&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;92aec878-0863-4acc-afd5-3eb6515adc93&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s1>&#39;199d0652-0e90-43ac-bc74-b28d2fad35c7&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s1>&#39;383fb964-2da1-4bb5-824a-5978b24d790a&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s1>&#39;8bb647da-46ed-4947-8caa-568960569d7e&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;Type&#39;</span><span class=p>:</span> <span class=s1>&#39;CHILD&#39;</span><span class=p>}],</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;RowIndex&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=s1>&#39;RowSpan&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}</span>
</span></span></code></pre></div><p>The goal is to munge this data and convert the list of blocks to a <code>pandas.DataFrame</code>. I first mapped each ID to the corresponding block. I did this for the four kind of blocks we may encounter.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>def</span> <span class=nf>map_blocks</span><span class=p>(</span><span class=n>blocks</span><span class=p>,</span> <span class=n>block_type</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>block</span><span class=p>[</span><span class=s1>&#39;Id&#39;</span><span class=p>]:</span> <span class=n>block</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>block</span> <span class=ow>in</span> <span class=n>blocks</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>block</span><span class=p>[</span><span class=s1>&#39;BlockType&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>block_type</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>blocks</span> <span class=o>=</span> <span class=n>response</span><span class=p>[</span><span class=s1>&#39;Blocks&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>tables</span> <span class=o>=</span> <span class=n>map_blocks</span><span class=p>(</span><span class=n>blocks</span><span class=p>,</span> <span class=s1>&#39;TABLE&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>cells</span> <span class=o>=</span> <span class=n>map_blocks</span><span class=p>(</span><span class=n>blocks</span><span class=p>,</span> <span class=s1>&#39;CELL&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>words</span> <span class=o>=</span> <span class=n>map_blocks</span><span class=p>(</span><span class=n>blocks</span><span class=p>,</span> <span class=s1>&#39;WORD&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>selections</span> <span class=o>=</span> <span class=n>map_blocks</span><span class=p>(</span><span class=n>blocks</span><span class=p>,</span> <span class=s1>&#39;SELECTION_ELEMENT&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>I then wrote a little function that yields the children IDs of a block.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_children_ids</span><span class=p>(</span><span class=n>block</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>rels</span> <span class=ow>in</span> <span class=n>block</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;Relationships&#39;</span><span class=p>,</span> <span class=p>[]):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>rels</span><span class=p>[</span><span class=s1>&#39;Type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;CHILD&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>yield from</span> <span class=n>rels</span><span class=p>[</span><span class=s1>&#39;Ids&#39;</span><span class=p>]</span>
</span></span></code></pre></div><p>The dataframe construction is logic is rather straightforward that we&rsquo;ve done the ID/block mapping. Obviously we&rsquo;re going to loop over each table. Then we&rsquo;re going to list the cells which belong to the table. We can then determine the number of cells and rows by looking at the <code>RowIndex</code> and <code>ColumnIndex</code> fields of each cell. Next, we loop over each cell and retrieve the cell&rsquo;s content, which can be either be words or checkboxes. We store the cell contents in a list of lists that represents the table. Once we&rsquo;re done looping over the cells, we can instantiate the <code>pandas.DataFrame</code> by assuming that the first row represents the column headers.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dataframes</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>table</span> <span class=ow>in</span> <span class=n>tables</span><span class=o>.</span><span class=n>values</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Determine all the cells that belong to this table</span>
</span></span><span class=line><span class=cl>    <span class=n>table_cells</span> <span class=o>=</span> <span class=p>[</span><span class=n>cells</span><span class=p>[</span><span class=n>cell_id</span><span class=p>]</span> <span class=k>for</span> <span class=n>cell_id</span> <span class=ow>in</span> <span class=n>get_children_ids</span><span class=p>(</span><span class=n>table</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Determine the table&#39;s number of rows and columns</span>
</span></span><span class=line><span class=cl>    <span class=n>n_rows</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>cell</span><span class=p>[</span><span class=s1>&#39;RowIndex&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>cell</span> <span class=ow>in</span> <span class=n>table_cells</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>n_cols</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>cell</span><span class=p>[</span><span class=s1>&#39;ColumnIndex&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>cell</span> <span class=ow>in</span> <span class=n>table_cells</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span> <span class=o>=</span> <span class=p>[[</span><span class=kc>None</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_cols</span><span class=p>)]</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_rows</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Fill in each cell</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>cell</span> <span class=ow>in</span> <span class=n>table_cells</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cell_contents</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>words</span><span class=p>[</span><span class=n>child_id</span><span class=p>][</span><span class=s1>&#39;Text&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>child_id</span> <span class=ow>in</span> <span class=n>words</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span> <span class=n>selections</span><span class=p>[</span><span class=n>child_id</span><span class=p>][</span><span class=s1>&#39;SelectionStatus&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>child_id</span> <span class=ow>in</span> <span class=n>get_children_ids</span><span class=p>(</span><span class=n>cell</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>=</span> <span class=n>cell</span><span class=p>[</span><span class=s1>&#39;RowIndex&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=n>j</span> <span class=o>=</span> <span class=n>cell</span><span class=p>[</span><span class=s1>&#39;ColumnIndex&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39; &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>cell_contents</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># We assume that the first row corresponds to the column names</span>
</span></span><span class=line><span class=cl>    <span class=n>dataframe</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>content</span><span class=p>[</span><span class=mi>1</span><span class=p>:],</span> <span class=n>columns</span><span class=o>=</span><span class=n>content</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>dataframes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>dataframe</span><span class=p>)</span>
</span></span></code></pre></div><p>In our case we have two tables.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>dataframes</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>
</span></span></code></pre></div><p>The first table is the one I&rsquo;m interested in extracting.</p><table><thead><tr><th style=text-align:right></th><th style=text-align:left>N¬∞ de traitem ent</th><th style=text-align:left>N¬∞ dent ou localisation</th><th style=text-align:left>Cotation CCAM,NGAP ou acte HN</th><th style=text-align:left>Nature de l&rsquo;acte</th><th style=text-align:left></th><th style=text-align:left>Mat√©riaux utilis√©s (**)</th><th style=text-align:left>Panier (****)</th><th style=text-align:left>Honoraires limite de facturation</th><th style=text-align:left>Honoraires dt prix de vente du dispositif m√©dical sur mesure</th><th style=text-align:left>Base de remboursement de l&rsquo;Assurance Maladie Obligatoire</th><th style=text-align:left>Montant rembours√© Assurance Maladie Obligatoire (***)</th><th style=text-align:left>Montant non rembours√© Assurance Maladie Obligatoire</th></tr></thead><tbody><tr><td style=text-align:right>0</td><td style=text-align:left>1</td><td style=text-align:left>46</td><td style=text-align:left>HBLD158</td><td style=text-align:left>Couronne C√©ramo-c√©ramique</td><td style=text-align:left></td><td style=text-align:left>3</td><td style=text-align:left>2</td><td style=text-align:left>550,00</td><td style=text-align:left>550,00</td><td style=text-align:left>120,00</td><td style=text-align:left>84,00</td><td style=text-align:left>466,00</td></tr><tr><td style=text-align:right>1</td><td style=text-align:left>1</td><td style=text-align:left>46</td><td style=text-align:left>HBLD724</td><td style=text-align:left>Couronne provisoire</td><td style=text-align:left></td><td style=text-align:left></td><td style=text-align:left>2</td><td style=text-align:left>60,00</td><td style=text-align:left>60,00</td><td style=text-align:left>10,00</td><td style=text-align:left>7,00</td><td style=text-align:left>53,00</td></tr><tr><td style=text-align:right>2</td><td style=text-align:left>2</td><td style=text-align:left>47</td><td style=text-align:left>HBMD460</td><td style=text-align:left>Onlay C√©ramique dentaire NF EN ISO 6872</td><td style=text-align:left></td><td style=text-align:left>3</td><td style=text-align:left>3</td><td style=text-align:left>Aucun</td><td style=text-align:left>450,00</td><td style=text-align:left>100,00</td><td style=text-align:left>70,00</td><td style=text-align:left>380,00</td></tr><tr><td style=text-align:right>3</td><td style=text-align:left></td><td style=text-align:left></td><td style=text-align:left></td><td style=text-align:left></td><td style=text-align:left></td><td style=text-align:left>TOTAL ‚Ç¨ (des</td><td style=text-align:left>actes</td><td style=text-align:left>envisag√©s)</td><td style=text-align:left>1 060,00</td><td style=text-align:left>230,00</td><td style=text-align:left>161,00</td><td style=text-align:left>899,00</td></tr></tbody></table><p>And there we go! You can now process the dataframe using whatever business logic applies to your problem. Hopefully this article might have saved you some previous minutes.</p><p>Amazon Textract is very good if you&rsquo;re processing a lot of files that have the same template. Alas, at my job, there are many templates, and Textract doesn&rsquo;t work on each of them. I thus use a different kind of logic where I extract annotations through an OCR and reconstruct rows myself with a clustering algorithm. I have yet to look into other table extraction tools such <a href=https://tabula-py.readthedocs.io/en/latest/index.html><code>tabula-py</code></a> and <a href=https://camelot-py.readthedocs.io/en/master/>Camelot</a>.</p><p>Stay safe!</p></div><script type=text/javascript>var s=document.createElement("script");s.setAttribute("src","https://utteranc.es/client.js"),s.setAttribute("repo","MaxHalford/maxhalford.github.io"),s.setAttribute("issue-term","pathname"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",null),s.setAttribute("theme","github-light"),document.body.appendChild(s)</script><div style=display:flex;flex-direction:row;justify-content:center;align-items:center;gap:20px;margin-bottom:30px><div class=do-the-thing><div class=elevator><svg class="sweet-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" enable-background="new 0 0 100 100" height="100" width="100"><path d="M70 47.5H30c-1.4.0-2.5 1.1-2.5 2.5v40c0 1.4 1.1 2.5 2.5 2.5h40c1.4.0 2.5-1.1 2.5-2.5V50C72.5 48.6 71.4 47.5 70 47.5zm-22.5 40h-5v-25h5v25zm10 0h-5v-25h5v25zm10 0h-5V60c0-1.4-1.1-2.5-2.5-2.5H40c-1.4.0-2.5 1.1-2.5 2.5v27.5h-5v-35h35v35z"/><path d="M50 42.5c1.4.0 2.5-1.1 2.5-2.5V16l5.7 5.7c.5.5 1.1.7 1.8.7s1.3-.2 1.8-.7c1-1 1-2.6.0-3.5l-10-10c-1-1-2.6-1-3.5.0l-10 10c-1 1-1 2.6.0 3.5 1 1 2.6 1 3.5.0l5.7-5.7v24c0 1.4 1.1 2.5 2.5 2.5z"/></svg>Back to the top</div></div><iframe src=https://github.com/sponsors/MaxHalford/button title="Sponsor MaxHalford" height=32 width=114 style=border:0;border-radius:6px></iframe></div><script src=https://cdnjs.cloudflare.com/ajax/libs/elevator.js/1.0.1/elevator.min.js></script>
<script>var elementButton=document.querySelector(".elevator"),elevator=new Elevator({element:elementButton,mainAudio:"/music/elevator.mp3",endAudio:"/music/ding.mp3"})</script><style>.down-arrow{font-size:120px;margin-top:90px;margin-bottom:90px;text-shadow:0 -20px #0c1f31,0 0 #c33329;color:transparent;-webkit-transform:scaleY(.8);-moz-transform:scaleY(.8);transform:scaleY(.8)}.elevator{text-align:center;cursor:pointer;width:140px;margin:auto}.elevator:hover{opacity:.7}.elevator svg{width:40px;height:40px;display:block;margin:auto;margin-bottom:5px}</style><div class=related-content><h3 style=margin-top:10px!important;margin-bottom:10px!important>Related posts</h3><ul style=margin-top:0><li><a href=/blog/unsupervised-text-classification/>Unsupervised text classification with word embeddings</a></li></ul></div></div></div></article></body></html>