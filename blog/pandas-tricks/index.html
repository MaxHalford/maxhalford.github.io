<!doctype html><html lang=en><head><script defer src=https://unpkg.com/@tinybirdco/flock.js data-host=https://api.tinybird.co data-token=p.eyJ1IjogImMwMjJhMjg1LWJmY2YtNDc0OC1hYzczLTJhMDQ1Njk3NTI0YyIsICJpZCI6ICIzNjc3NjQ3Ny04MTE2LTRmYWQtYjcwMy1iZmM3YjMwZGJjMjMifQ.A0vHm-VWbXG6uBFZiwuspN_AyfSYNrdZE3IgwgWSt4g></script><meta charset=utf-8><meta name=generator content="Hugo 0.115.0"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Max Halford"><meta property="og:url" content="https://maxhalford.github.io/blog/pandas-tricks/"><link rel=canonical href=https://maxhalford.github.io/blog/pandas-tricks/><meta property="og:title" content="A few intermediate pandas tricks"><meta property="og:description" content="I want to use this post to share some pandas snippets that I find useful. I use them from time to time, in particular when I&rsquo;m doing time series competitions on platforms such as Kaggle. Like any data scientist, I perform similar data processing steps on different datasets. Usually, I put repetitive patterns in xam, which is my personal data science toolbox. However, I think that the following snippets are too small and too specific for being added into a library."><meta property="og:type" content="article"><meta property="og:url" content="https://maxhalford.github.io/blog/pandas-tricks/"><meta property="og:image" content="https://maxhalford.github.io/img/beach.jpg"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-08-17T00:00:00+00:00"><meta property="article:modified_time" content="2020-08-17T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://maxhalford.github.io/img/beach.jpg"><meta name=twitter:title content="A few intermediate pandas tricks"><meta name=twitter:description content="I want to use this post to share some pandas snippets that I find useful. I use them from time to time, in particular when I&rsquo;m doing time series competitions on platforms such as Kaggle. Like any data scientist, I perform similar data processing steps on different datasets. Usually, I put repetitive patterns in xam, which is my personal data science toolbox. However, I think that the following snippets are too small and too specific for being added into a library."><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¦”</text></svg>"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/maxhalford.github.io\/"},"articleSection":"blog","name":"A few intermediate pandas tricks","headline":"A few intermediate pandas tricks","description":"I want to use this post to share some pandas snippets that I find useful. I use them from time to time, in particular when I\u0026rsquo;m doing time series competitions on platforms such as Kaggle. Like any data scientist, I perform similar data processing steps on different datasets. Usually, I put repetitive patterns in xam, which is my personal data science toolbox. However, I think that the following snippets are too small and too specific for being added into a library.","inLanguage":"en-US","author":"Max Halford","creator":"Max Halford","publisher":"Max Halford","accountablePerson":"Max Halford","copyrightHolder":"Max Halford","copyrightYear":"2020","datePublished":"2020-08-17 00:00:00 \u002b0000 UTC","dateModified":"2020-08-17 00:00:00 \u002b0000 UTC","url":"https:\/\/maxhalford.github.io\/blog\/pandas-tricks\/","keywords":["data-eng"]}</script><title>A few intermediate pandas tricks â€¢ Max Halford</title><meta property="og:title" content="A few intermediate pandas tricks â€¢ Max Halford"><meta property="og:type" content="article"><meta name=description content="I want to use this post to share some pandas snippets that I find useful. I use them from time to time, in particular when I&rsquo;m doing time series competitions on platforms such as Kaggle. Like any data scientist, I perform similar data processing steps on different datasets. Usually, I put repetitive patterns in xam, which is my personal data science toolbox. However, I think that the following snippets are too small and too specific for being added into a library."><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.css><link rel=stylesheet href=/css/github-markdown.min.css><link rel=stylesheet href=/css/highlight/github.css><link rel=stylesheet href=/css/index.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&family=Permanent+Marker&display=swap" rel=stylesheet><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0,tags:"ams"},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body><article class=post id=article><div class="row center-xs" style=text-align:left><div class="col-xs-12 col-sm-10 col-md-7 col-lg-5"><div class=header><header class=header-parts><div class="signatures site-title"><a href=/>Max Halford ðŸ¦”</a></div><div class=header-links><a class=header-link href=/>Blog</a>
<a class=header-link href=/links/>Links</a>
<a class=header-link href=/bio/>Bio</a></div></header></div><header class=post-header><h1 class=post-title>A few intermediate pandas tricks</h1><div class="row post-desc"><div class="col-xs-12 post-desc-items"><time class=post-date datetime="2020-08-17 00:00:00 UTC">2020-08-17</time>
<span class=posts-line-tag>data-eng</span></div></div></header><div class="post-content markdown-body"><h2 id=toc>Table of contents</h2><nav id=TableOfContents><ul><li><a href=#time-sinceuntil-event>Time since/until event</a></li><li><a href=#longest-event-streak>Longest event streak</a></li><li><a href=#target-encoding-for-time-series>Target encoding for time series</a></li></ul></nav><p>I want to use this post to share some <code>pandas</code> snippets that I find useful. I use them from time to time, in particular when I&rsquo;m doing <a href="https://www.kaggle.com/search?q=time+series+in%3Acompetitions">time series competitions</a> on platforms such as Kaggle. Like any data scientist, I perform similar data processing steps on different datasets. Usually, I put repetitive patterns in <a href=https://github.com/MaxHalford/xam><code>xam</code></a>, which is my personal data science toolbox. However, I think that the following snippets are too small and too specific for being added into a library.</p><p>Some of the following code assumes that you&rsquo;re using <a href=https://pandas.pydata.org/docs/whatsnew/v1.0.0.html>version <code>1.0</code> of <code>pandas</code></a>, which in particular added support for <a href=https://pandas.pydata.org/docs/whatsnew/v1.0.0.html#experimental-na-scalar-to-denote-missing-values>typed missing values</a>. Note that the following code is not guaranteed to be the optimal way of proceeding. If you have a quicker solution, then feel welcome to post a comment at the bottom of this post.</p><h2 id=time-sinceuntil-event>Time since/until event</h2><p>Take the following series of weather indications:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>weather</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;rain&#39;</span><span class=p>,</span> <span class=s1>&#39;sun&#39;</span><span class=p>,</span> <span class=s1>&#39;snow&#39;</span><span class=p>,</span> <span class=s1>&#39;snow&#39;</span><span class=p>,</span> <span class=s1>&#39;snow&#39;</span><span class=p>,</span> <span class=s1>&#39;sun&#39;</span><span class=p>,</span> <span class=s1>&#39;rain&#39;</span><span class=p>,</span> <span class=s1>&#39;rain&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>weather</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>weather</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=s1>&#39;category&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>weather</span>
</span></span></code></pre></div><table><thead><tr><th style=text-align:left>weather</th></tr></thead><tbody><tr><td style=text-align:left>rain</td></tr><tr><td style=text-align:left>sun</td></tr><tr><td style=text-align:left>snow</td></tr><tr><td style=text-align:left>snow</td></tr><tr><td style=text-align:left>snow</td></tr><tr><td style=text-align:left>sun</td></tr><tr><td style=text-align:left>rain</td></tr><tr><td style=text-align:left>rain</td></tr></tbody></table><p>Depending on the problem, it might be worthwhile to extract the time since an event occurred. For instance, we might want to produce a feature that indicates how long ago the <code>'rain'</code> value occurred. For the sake of simplicity, I&rsquo;m going to assume that the period between each row is constant. I will thus simply count the number of steps that occured since each value appeared. Ideally, we want to have one column for each distinct value. Here is the code I use for doing so:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>def</span> <span class=nf>steps_since</span><span class=p>(</span><span class=n>series</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>features</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=n>series</span><span class=o>.</span><span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>cat</span> <span class=ow>in</span> <span class=n>series</span><span class=o>.</span><span class=n>cat</span><span class=o>.</span><span class=n>categories</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>counts</span> <span class=o>=</span> <span class=n>series</span><span class=o>.</span><span class=n>eq</span><span class=p>(</span><span class=n>cat</span><span class=p>)</span><span class=o>.</span><span class=n>cumsum</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>since</span> <span class=o>=</span> <span class=n>counts</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>counts</span><span class=p>)</span><span class=o>.</span><span class=n>cumcount</span><span class=p>()</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=s1>&#39;Int64&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>since</span><span class=p>[</span><span class=n>counts</span><span class=o>.</span><span class=n>eq</span><span class=p>(</span><span class=mi>0</span><span class=p>)]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>NA</span>
</span></span><span class=line><span class=cl>        <span class=n>features</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;steps_since_</span><span class=si>{</span><span class=n>cat</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>since</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>features</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>steps_since</span><span class=p>(</span><span class=n>weather</span><span class=p>)</span>
</span></span></code></pre></div><table><thead><tr><th style=text-align:right>steps_since_rain</th><th style=text-align:right>steps_since_snow</th><th style=text-align:right>steps_since_sun</th></tr></thead><tbody><tr><td style=text-align:right>0</td><td style=text-align:right>NA</td><td style=text-align:right>NA</td></tr><tr><td style=text-align:right>1</td><td style=text-align:right>NA</td><td style=text-align:right>0</td></tr><tr><td style=text-align:right>2</td><td style=text-align:right>0</td><td style=text-align:right>1</td></tr><tr><td style=text-align:right>3</td><td style=text-align:right>0</td><td style=text-align:right>2</td></tr><tr><td style=text-align:right>4</td><td style=text-align:right>0</td><td style=text-align:right>3</td></tr><tr><td style=text-align:right>5</td><td style=text-align:right>1</td><td style=text-align:right>0</td></tr><tr><td style=text-align:right>0</td><td style=text-align:right>2</td><td style=text-align:right>1</td></tr><tr><td style=text-align:right>0</td><td style=text-align:right>3</td><td style=text-align:right>2</td></tr></tbody></table><p>I&rsquo;ve assumed that the provided series contains <a href=https://pandas.pydata.org/pandas-docs/stable/user_guide/categorical.html>categorical data</a>. This allows us to access the list of categories via <code>series.cat.categories</code>. You could use <code>series.unique()</code> instead. I&rsquo;ve also taken care of inserting <code>NA</code>s for values that haven&rsquo;t yet occurred. Before version <code>1.0</code>, missing values were commonly indicated with <code>np.nan</code>, but this required the series to be of type <code>float64</code>. The modern approach is to use the <code>Int64</code> type in combination of <code>pd.NA</code> to store nullable integers.</p><p>How about the following dataset?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>weather_per_country</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;country&#39;</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>Categorical</span><span class=p>([</span><span class=s1>&#39;France&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=p>[</span><span class=s1>&#39;Germany&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>4</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;weather&#39;</span><span class=p>:</span> <span class=n>weather</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>weather_per_country</span>
</span></span></code></pre></div><table><thead><tr><th style=text-align:left>country</th><th style=text-align:left>weather</th></tr></thead><tbody><tr><td style=text-align:left>France</td><td style=text-align:left>rain</td></tr><tr><td style=text-align:left>France</td><td style=text-align:left>sun</td></tr><tr><td style=text-align:left>France</td><td style=text-align:left>snow</td></tr><tr><td style=text-align:left>France</td><td style=text-align:left>snow</td></tr><tr><td style=text-align:left>Germany</td><td style=text-align:left>snow</td></tr><tr><td style=text-align:left>Germany</td><td style=text-align:left>sun</td></tr><tr><td style=text-align:left>Germany</td><td style=text-align:left>rain</td></tr><tr><td style=text-align:left>Germany</td><td style=text-align:left>sun</td></tr></tbody></table><p>In this case, we might want to extract the time since each event, within each country. We can so via a <code>groupby</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>steps_since</span><span class=p>(</span><span class=n>g</span><span class=p>[</span><span class=s1>&#39;weather&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>assign</span><span class=p>(</span><span class=n>country</span><span class=o>=</span><span class=n>country</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>country</span><span class=p>,</span> <span class=n>g</span> <span class=ow>in</span> <span class=n>weather_per_country</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;country&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><table><thead><tr><th style=text-align:right>steps_since_rain</th><th style=text-align:right>steps_since_snow</th><th style=text-align:right>steps_since_sun</th><th style=text-align:left>country</th></tr></thead><tbody><tr><td style=text-align:right>0</td><td style=text-align:right>NA</td><td style=text-align:right>NA</td><td style=text-align:left>France</td></tr><tr><td style=text-align:right>1</td><td style=text-align:right>NA</td><td style=text-align:right>0</td><td style=text-align:left>France</td></tr><tr><td style=text-align:right>2</td><td style=text-align:right>0</td><td style=text-align:right>1</td><td style=text-align:left>France</td></tr><tr><td style=text-align:right>3</td><td style=text-align:right>0</td><td style=text-align:right>2</td><td style=text-align:left>France</td></tr><tr><td style=text-align:right>NA</td><td style=text-align:right>0</td><td style=text-align:right>NA</td><td style=text-align:left>Germany</td></tr><tr><td style=text-align:right>NA</td><td style=text-align:right>1</td><td style=text-align:right>0</td><td style=text-align:left>Germany</td></tr><tr><td style=text-align:right>0</td><td style=text-align:right>2</td><td style=text-align:right>1</td><td style=text-align:left>Germany</td></tr><tr><td style=text-align:right>0</td><td style=text-align:right>3</td><td style=text-align:right>2</td><td style=text-align:left>Germany</td></tr></tbody></table><p>Finally, what about obtaining the number of steps <em>until</em> an event, rather than <em>since</em> an event? This can be done by rewriting the code <code>steps_since</code> function and inverting the series before counting:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>def</span> <span class=nf>steps_until</span><span class=p>(</span><span class=n>series</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>features</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=n>series</span><span class=o>.</span><span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>cat</span> <span class=ow>in</span> <span class=n>series</span><span class=o>.</span><span class=n>cat</span><span class=o>.</span><span class=n>categories</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>counts</span> <span class=o>=</span> <span class=n>series</span><span class=o>.</span><span class=n>eq</span><span class=p>(</span><span class=n>cat</span><span class=p>)</span><span class=o>.</span><span class=n>iloc</span><span class=p>[::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>cumsum</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>until</span> <span class=o>=</span> <span class=n>counts</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>counts</span><span class=p>)</span><span class=o>.</span><span class=n>cumcount</span><span class=p>()</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=s1>&#39;Int64&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>until</span><span class=p>[</span><span class=n>counts</span><span class=o>.</span><span class=n>eq</span><span class=p>(</span><span class=mi>0</span><span class=p>)]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>NA</span>
</span></span><span class=line><span class=cl>        <span class=n>features</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;steps_until_</span><span class=si>{</span><span class=n>cat</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>until</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>features</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>steps_until</span><span class=p>(</span><span class=n>weather</span><span class=p>)</span>
</span></span></code></pre></div><table><thead><tr><th style=text-align:right>steps_until_rain</th><th style=text-align:right>steps_until_snow</th><th style=text-align:right>steps_until_sun</th></tr></thead><tbody><tr><td style=text-align:right>0</td><td style=text-align:right>2</td><td style=text-align:right>1</td></tr><tr><td style=text-align:right>5</td><td style=text-align:right>1</td><td style=text-align:right>0</td></tr><tr><td style=text-align:right>4</td><td style=text-align:right>0</td><td style=text-align:right>3</td></tr><tr><td style=text-align:right>3</td><td style=text-align:right>0</td><td style=text-align:right>2</td></tr><tr><td style=text-align:right>2</td><td style=text-align:right>0</td><td style=text-align:right>1</td></tr><tr><td style=text-align:right>1</td><td style=text-align:right>NA</td><td style=text-align:right>0</td></tr><tr><td style=text-align:right>0</td><td style=text-align:right>NA</td><td style=text-align:right>NA</td></tr><tr><td style=text-align:right>0</td><td style=text-align:right>NA</td><td style=text-align:right>NA</td></tr></tbody></table><h2 id=longest-event-streak>Longest event streak</h2><p>Next, take the following series of temperature measurements:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>temperature</span> <span class=o>=</span> <span class=p>[</span><span class=mi>18</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>NA</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>NA</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>NA</span><span class=p>,</span> <span class=mi>21</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>NA</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>NA</span><span class=p>,</span> <span class=mi>19</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>temperature</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>temperature</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;temperature&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>temperature</span>
</span></span></code></pre></div><table><thead><tr><th style=text-align:right>temperature</th></tr></thead><tbody><tr><td style=text-align:right>18</td></tr><tr><td style=text-align:right>NA</td></tr><tr><td style=text-align:right>NA</td></tr><tr><td style=text-align:right>NA</td></tr><tr><td style=text-align:right>21</td></tr><tr><td style=text-align:right>NA</td></tr><tr><td style=text-align:right>NA</td></tr><tr><td style=text-align:right>19</td></tr></tbody></table><p>In this case, you might want to <a href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.interpolate.html>interpolate</a> the missing values before feeding the data to a machine learning model. However, in order for your interpolation to be robust, you might want to verify that the maximum number of consecutive values isn&rsquo;t too large. You can calculate the latter as so:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>missing</span> <span class=o>=</span> <span class=n>temperature</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>missing</span><span class=o>.</span><span class=n>groupby</span><span class=p>((</span><span class=o>~</span><span class=n>missing</span><span class=p>)</span><span class=o>.</span><span class=n>cumsum</span><span class=p>())</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=o>.</span><span class=n>max</span><span class=p>()</span>
</span></span></code></pre></div><pre tabindex=0><code>3
</code></pre><p>Naturally, you can adapt this code to count consecutive values of arbitrary events. Indeed, the <code>missing</code> series definition could be replaced by a different condition altogether. For instance, we can determine the longest streak of rainy days like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>rainy</span> <span class=o>=</span> <span class=n>weather</span><span class=o>.</span><span class=n>eq</span><span class=p>(</span><span class=s1>&#39;rain&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>rainy</span><span class=o>.</span><span class=n>groupby</span><span class=p>((</span><span class=o>~</span><span class=n>rainy</span><span class=p>)</span><span class=o>.</span><span class=n>cumsum</span><span class=p>())</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=o>.</span><span class=n>max</span><span class=p>()</span>
</span></span></code></pre></div><pre tabindex=0><code>2
</code></pre><h2 id=target-encoding-for-time-series>Target encoding for time series</h2><p>The one thing I do in every time series competition is <a href=http://contrib.scikit-learn.org/category_encoders/targetencoder.html>target encoding</a>. In short, the goal of target encoding is to replace a category by the average of the target values of the rows that belong to said category. Naturally, you&rsquo;re not limited to using an average. You can also use <a href=https://maxhalford.github.io/blog/target-encoding/>Bayesian target encoding</a> if some of your categories are rare.</p><p>Target encoding is very important for time series data. It has been used in almost every top model on Kaggle time series competitions, such as <a href=https://www.kaggle.com/c/ashrae-energy-prediction>ASHRAE</a>, <a href=https://www.kaggle.com/c/recruit-restaurant-visitor-forecasting>Recruit Restaurants</a>, and <a href=https://www.kaggle.com/c/web-traffic-time-series-forecasting>Wikipedia Web Traffic</a>. When you do target encoding on temporal data, you need to be wary of not leaking current and future information into the aggregate of each row. Basically, you need to shift the target values within each group backwards. Indeed, for any given moment, we want our aggregate to pertain to past data only. As an example, consider the following toy dataset:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>readings</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>,</span> <span class=s1>&#39;Saturday&#39;</span><span class=p>,</span> <span class=mi>101</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>,</span> <span class=s1>&#39;Sunday&#39;</span><span class=p>,</span> <span class=mi>88</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>,</span> <span class=s1>&#39;Saturday&#39;</span><span class=p>,</span> <span class=mi>103</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>,</span> <span class=s1>&#39;Sunday&#39;</span><span class=p>,</span> <span class=mi>82</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>,</span> <span class=s1>&#39;Saturday&#39;</span><span class=p>,</span> <span class=mi>100</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s1>&#39;B&#39;</span><span class=p>,</span> <span class=s1>&#39;Saturday&#39;</span><span class=p>,</span> <span class=mi>27</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s1>&#39;B&#39;</span><span class=p>,</span> <span class=s1>&#39;Sunday&#39;</span><span class=p>,</span> <span class=mi>13</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s1>&#39;B&#39;</span><span class=p>,</span> <span class=s1>&#39;Saturday&#39;</span><span class=p>,</span> <span class=mi>21</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s1>&#39;B&#39;</span><span class=p>,</span> <span class=s1>&#39;Sunday&#39;</span><span class=p>,</span> <span class=mi>17</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s1>&#39;B&#39;</span><span class=p>,</span> <span class=s1>&#39;Saturday&#39;</span><span class=p>,</span> <span class=mi>25</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;building&#39;</span><span class=p>,</span> <span class=s1>&#39;day&#39;</span><span class=p>,</span> <span class=s1>&#39;reading&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>readings</span>
</span></span></code></pre></div><table><thead><tr><th style=text-align:left>building</th><th style=text-align:left>day</th><th style=text-align:right>reading</th></tr></thead><tbody><tr><td style=text-align:left>A</td><td style=text-align:left>Saturday</td><td style=text-align:right>101</td></tr><tr><td style=text-align:left>A</td><td style=text-align:left>Sunday</td><td style=text-align:right>88</td></tr><tr><td style=text-align:left>A</td><td style=text-align:left>Saturday</td><td style=text-align:right>103</td></tr><tr><td style=text-align:left>A</td><td style=text-align:left>Sunday</td><td style=text-align:right>82</td></tr><tr><td style=text-align:left>A</td><td style=text-align:left>Saturday</td><td style=text-align:right>100</td></tr><tr><td style=text-align:left>B</td><td style=text-align:left>Saturday</td><td style=text-align:right>27</td></tr><tr><td style=text-align:left>B</td><td style=text-align:left>Sunday</td><td style=text-align:right>13</td></tr><tr><td style=text-align:left>B</td><td style=text-align:left>Saturday</td><td style=text-align:right>21</td></tr><tr><td style=text-align:left>B</td><td style=text-align:left>Sunday</td><td style=text-align:right>17</td></tr><tr><td style=text-align:left>B</td><td style=text-align:left>Saturday</td><td style=text-align:right>25</td></tr></tbody></table><p>Let&rsquo;s say we want to calculate some target encodings for different column combinations. I like to define each target encoding as a tuple <code>(on, lag, by, how)</code> where:</p><ul><li><code>on</code> is the column on which to perform the aggregate.</li><li><code>lag</code> is the size of the window.</li><li><code>by</code> determines on which column to do the grouping.</li><li><code>how</code> indicates the statistics to compute.</li></ul><p>I then store all the tuples I want to compute in a list:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>AGGS</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=s1>&#39;reading&#39;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;building&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;mean&#39;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=s1>&#39;reading&#39;</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;building&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;mean&#39;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=s1>&#39;reading&#39;</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;day&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;mean&#39;</span><span class=p>,</span> <span class=s1>&#39;max&#39;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=s1>&#39;reading&#39;</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;building&#39;</span><span class=p>,</span> <span class=s1>&#39;day&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;mean&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>I then proceed as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>features</span> <span class=o>=</span> <span class=n>readings</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>on</span><span class=p>,</span> <span class=n>lag</span><span class=p>,</span> <span class=n>by</span><span class=p>,</span> <span class=n>hows</span> <span class=ow>in</span> <span class=n>AGGS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>agg</span> <span class=o>=</span> <span class=n>readings</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>by</span><span class=p>)[</span><span class=n>on</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=o>=</span><span class=n>lag</span><span class=p>,</span> <span class=n>min_periods</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>agg</span><span class=p>(</span><span class=n>hows</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>agg</span> <span class=o>=</span> <span class=n>agg</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>how</span><span class=p>:</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>how</span><span class=si>}</span><span class=s1>_of_last_</span><span class=si>{</span><span class=n>lag</span><span class=si>}</span><span class=s1>_</span><span class=si>{</span><span class=n>on</span><span class=si>}</span><span class=s1>_by_&#39;</span> <span class=o>+</span> <span class=s1>&#39;_and_&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>by</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>how</span> <span class=ow>in</span> <span class=n>hows</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>features</span> <span class=o>=</span> <span class=n>features</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>agg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>features</span>
</span></span></code></pre></div><table><thead><tr><th style=text-align:left>building</th><th style=text-align:left>day</th><th style=text-align:right>reading</th><th style=text-align:right>mean_of_last_3_reading_by_building</th><th style=text-align:right>mean_of_last_3_reading_by_day</th><th style=text-align:right>max_of_last_3_reading_by_day</th><th style=text-align:right>mean_of_last_3_reading_by_building_and_day</th></tr></thead><tbody><tr><td style=text-align:left>A</td><td style=text-align:left>Saturday</td><td style=text-align:right>101</td><td style=text-align:right>nan</td><td style=text-align:right>nan</td><td style=text-align:right>nan</td><td style=text-align:right>nan</td></tr><tr><td style=text-align:left>A</td><td style=text-align:left>Sunday</td><td style=text-align:right>88</td><td style=text-align:right>101</td><td style=text-align:right>nan</td><td style=text-align:right>nan</td><td style=text-align:right>nan</td></tr><tr><td style=text-align:left>A</td><td style=text-align:left>Saturday</td><td style=text-align:right>103</td><td style=text-align:right>94.5</td><td style=text-align:right>101</td><td style=text-align:right>101</td><td style=text-align:right>101</td></tr><tr><td style=text-align:left>A</td><td style=text-align:left>Sunday</td><td style=text-align:right>82</td><td style=text-align:right>97.3333</td><td style=text-align:right>88</td><td style=text-align:right>88</td><td style=text-align:right>88</td></tr><tr><td style=text-align:left>A</td><td style=text-align:left>Saturday</td><td style=text-align:right>100</td><td style=text-align:right>91</td><td style=text-align:right>102</td><td style=text-align:right>103</td><td style=text-align:right>102</td></tr><tr><td style=text-align:left>B</td><td style=text-align:left>Saturday</td><td style=text-align:right>27</td><td style=text-align:right>nan</td><td style=text-align:right>101.333</td><td style=text-align:right>103</td><td style=text-align:right>nan</td></tr><tr><td style=text-align:left>B</td><td style=text-align:left>Sunday</td><td style=text-align:right>13</td><td style=text-align:right>27</td><td style=text-align:right>85</td><td style=text-align:right>88</td><td style=text-align:right>nan</td></tr><tr><td style=text-align:left>B</td><td style=text-align:left>Saturday</td><td style=text-align:right>21</td><td style=text-align:right>20</td><td style=text-align:right>76.6667</td><td style=text-align:right>103</td><td style=text-align:right>27</td></tr><tr><td style=text-align:left>B</td><td style=text-align:left>Sunday</td><td style=text-align:right>17</td><td style=text-align:right>20.3333</td><td style=text-align:right>61</td><td style=text-align:right>88</td><td style=text-align:right>13</td></tr><tr><td style=text-align:left>B</td><td style=text-align:left>Saturday</td><td style=text-align:right>25</td><td style=text-align:right>17</td><td style=text-align:right>49.3333</td><td style=text-align:right>100</td><td style=text-align:right>24</td></tr></tbody></table><p>Note that I have set <code>min_periods</code> to 1 so that statistics are still computed when there are less than <code>lag</code> values in a given window. As you can see, the <code>nan</code>s are present when there are no past values to aggregate on.</p><p>When I do a Kaggle competition, I run the above code on a small subset of the data and manually check that it&rsquo;s doing what I want it to do. This is akin to <a href=https://www.wikiwand.com/en/Pointing_and_calling>pointing and calling</a>, which I highly recommend doing in any data science endeavour whatsoever.</p><p>You might have noticed that I used <code>apply</code> to shift the values backwards before aggregating. Since version <code>1.0</code>, it&rsquo;s also possible to define a custom window that does the shifting for us. This may be done by subclassing <code>pd.api.indexers.BaseIndexer</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ShiftedWindow</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>indexers</span><span class=o>.</span><span class=n>BaseIndexer</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>window_size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>window_size</span> <span class=o>=</span> <span class=n>window_size</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_window_bounds</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>num_values</span><span class=p>,</span> <span class=n>min_periods</span><span class=p>,</span> <span class=n>center</span><span class=p>,</span> <span class=n>closed</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>starts</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>window_size</span><span class=p>,</span> <span class=n>num_values</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>window_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ends</span> <span class=o>=</span> <span class=n>starts</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>window_size</span>
</span></span><span class=line><span class=cl>        <span class=n>starts</span><span class=p>[:</span><span class=bp>self</span><span class=o>.</span><span class=n>window_size</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>starts</span><span class=p>,</span> <span class=n>ends</span>
</span></span></code></pre></div><p>This allows us to rewrite the above snippet as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>features</span> <span class=o>=</span> <span class=n>readings</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>on</span><span class=p>,</span> <span class=n>lag</span><span class=p>,</span> <span class=n>by</span><span class=p>,</span> <span class=n>hows</span> <span class=ow>in</span> <span class=n>AGGS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>agg</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>readings</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>by</span><span class=p>)[</span><span class=n>on</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>ShiftedWindow</span><span class=p>(</span><span class=n>lag</span><span class=p>),</span> <span class=n>min_periods</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>agg</span><span class=p>(</span><span class=n>hows</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>agg</span> <span class=o>=</span> <span class=n>agg</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>how</span><span class=p>:</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>how</span><span class=si>}</span><span class=s1>_of_last_</span><span class=si>{</span><span class=n>lag</span><span class=si>}</span><span class=s1>_</span><span class=si>{</span><span class=n>on</span><span class=si>}</span><span class=s1>_by_&#39;</span> <span class=o>+</span> <span class=s1>&#39;_and_&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>by</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>how</span> <span class=ow>in</span> <span class=n>hows</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>features</span> <span class=o>=</span> <span class=n>features</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>agg</span><span class=p>)</span>
</span></span></code></pre></div><p>However, <a href=https://github.com/pandas-dev/pandas/issues/35755#issuecomment-674584559>it turns out</a> that custom windows within a <code>groupby</code> will only work once version <code>1.1.1</code> is released. As of writing this blog post, the above code will not produce the expected output, even though it won&rsquo;t raise any exception. But if you&rsquo;re reading from the near future, then it will work!</p><p>That&rsquo;s all for now! I purposefully didn&rsquo;t go into the detail of each line of code. I rather expect people to copy/paste the above snippets to (hopefully) play around with them by themselves. Feel free to drop a comment if you have any question whatsoever.</p></div><script type=text/javascript>var s=document.createElement("script");s.setAttribute("src","https://utteranc.es/client.js"),s.setAttribute("repo","MaxHalford/maxhalford.github.io"),s.setAttribute("issue-term","pathname"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",null),s.setAttribute("theme","github-light"),document.body.appendChild(s)</script><div style=display:flex;flex-direction:row;justify-content:center;align-items:center;gap:20px;margin-bottom:30px><div class=do-the-thing><div class=elevator><svg class="sweet-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" enable-background="new 0 0 100 100" height="100" width="100"><path d="M70 47.5H30c-1.4.0-2.5 1.1-2.5 2.5v40c0 1.4 1.1 2.5 2.5 2.5h40c1.4.0 2.5-1.1 2.5-2.5V50C72.5 48.6 71.4 47.5 70 47.5zm-22.5 40h-5v-25h5v25zm10 0h-5v-25h5v25zm10 0h-5V60c0-1.4-1.1-2.5-2.5-2.5H40c-1.4.0-2.5 1.1-2.5 2.5v27.5h-5v-35h35v35z"/><path d="M50 42.5c1.4.0 2.5-1.1 2.5-2.5V16l5.7 5.7c.5.5 1.1.7 1.8.7s1.3-.2 1.8-.7c1-1 1-2.6.0-3.5l-10-10c-1-1-2.6-1-3.5.0l-10 10c-1 1-1 2.6.0 3.5 1 1 2.6 1 3.5.0l5.7-5.7v24c0 1.4 1.1 2.5 2.5 2.5z"/></svg>Back to the top</div></div><iframe src=https://github.com/sponsors/MaxHalford/button title="Sponsor MaxHalford" height=32 width=114 style=border:0;border-radius:6px></iframe></div><script src=https://cdnjs.cloudflare.com/ajax/libs/elevator.js/1.0.1/elevator.min.js></script>
<script>var elementButton=document.querySelector(".elevator"),elevator=new Elevator({element:elementButton,mainAudio:"/music/elevator.mp3",endAudio:"/music/ding.mp3"})</script><style>.down-arrow{font-size:120px;margin-top:90px;margin-bottom:90px;text-shadow:0 -20px #0c1f31,0 0 #c33329;color:transparent;-webkit-transform:scaleY(.8);-moz-transform:scaleY(.8);transform:scaleY(.8)}.elevator{text-align:center;cursor:pointer;width:140px;margin:auto}.elevator:hover{opacity:.7}.elevator svg{width:40px;height:40px;display:block;margin:auto;margin-bottom:5px}</style><div class=related-content><h3 style=margin-top:10px!important;margin-bottom:10px!important>Related posts</h3><ul style=margin-top:0><li><a href=/blog/transitive-duplicates/>Finding fuzzy duplicates with pandas</a></li><li><a href=/blog/skyline-queries/>Skyline queries in Python</a></li><li><a href=/blog/machine-learning-production/>A smooth approach to putting machine learning into production</a></li></ul></div></div></div></article></body></html>