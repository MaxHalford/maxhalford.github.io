<!doctype html><html lang=en><head><script defer src=https://unpkg.com/@tinybirdco/flock.js data-host=https://api.tinybird.co data-token=p.eyJ1IjogImMwMjJhMjg1LWJmY2YtNDc0OC1hYzczLTJhMDQ1Njk3NTI0YyIsICJpZCI6ICIzNjc3NjQ3Ny04MTE2LTRmYWQtYjcwMy1iZmM3YjMwZGJjMjMifQ.A0vHm-VWbXG6uBFZiwuspN_AyfSYNrdZE3IgwgWSt4g></script><meta charset=utf-8><meta name=generator content="Hugo 0.110.0"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Max Halford"><meta property="og:url" content="https://maxhalford.github.io/blog/sql-subquery-enumeration/"><link rel=canonical href=https://maxhalford.github.io/blog/sql-subquery-enumeration/><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¦”</text></svg>"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/maxhalford.github.io\/"},"articleSection":"blog","name":"SQL subquery enumeration","headline":"SQL subquery enumeration","description":"I recently stumbled on a rather fun problem during my PhD. I wanted to generate all possible subqueries from a given SQL query. In this case an example is easily worth a 1000 thousand words. Take the following SQL query:\nSELECT * FROM customers AS c, purchases AS p, shops AS s WHERE p.customer_id = c.id AND p.shop_id = s.id AND c.nationality = \u0026#39;Swedish\u0026#39; AND c.hair = \u0026#39;Blond\u0026#39; AND s.city = \u0026#39;Stockholm\u0026#39; Here all the possible subqueries that can be generated from the above query.","inLanguage":"en-US","author":"Max Halford","creator":"Max Halford","publisher":"Max Halford","accountablePerson":"Max Halford","copyrightHolder":"Max Halford","copyrightYear":"2019","datePublished":"2019-05-06 00:00:00 \u002b0000 UTC","dateModified":"2019-05-06 00:00:00 \u002b0000 UTC","url":"https:\/\/maxhalford.github.io\/blog\/sql-subquery-enumeration\/","keywords":["data-eng"]}</script><title>SQL subquery enumeration â€¢ Max Halford</title><meta property="og:title" content="SQL subquery enumeration â€¢ Max Halford"><meta property="og:type" content="article"><meta name=description content="I recently stumbled on a rather fun problem during my PhD. I wanted to generate all possible subqueries from a given SQL query. In this case an example is easily worth a 1000 thousand words. Take the following SQL query:
SELECT * FROM customers AS c, purchases AS p, shops AS s WHERE p.customer_id = c.id AND p.shop_id = s.id AND c.nationality = 'Swedish' AND c.hair = 'Blond' AND s.city = 'Stockholm' Here all the possible subqueries that can be generated from the above query."><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.css><link rel=stylesheet href=/css/github-markdown.min.css><link rel=stylesheet href=/css/highlight/github.css><link rel=stylesheet href=/css/index.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&family=Permanent+Marker&display=swap" rel=stylesheet><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0,tags:"ams"},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body><article class=post id=article><div class="row center-xs" style=text-align:left><div class="col-xs-12 col-sm-10 col-md-7 col-lg-5"><div class=header><header class=header-parts><div class="signatures site-title"><a href=/>Max Halford ðŸ¦”</a></div><div class=header-links><a class=header-link href=/>Blog</a>
<a class=header-link href=/links/>Links</a>
<a class=header-link href=/bio/>Bio</a></div></header></div><header class=post-header><h1 class=post-title>SQL subquery enumeration</h1><div class="row post-desc"><div class="col-xs-12 post-desc-items"><time class=post-date datetime="2019-05-06 00:00:00 UTC">2019-05-06</time>
<span class=posts-line-tag>data-eng</span></div></div></header><div class="post-content markdown-body"><p>I recently stumbled on a rather fun problem during my PhD. I wanted to generate all possible subqueries from a given SQL query. In this case an example is easily worth a 1000 thousand words. Take the following SQL query:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>customers</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>c</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>purchases</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>shops</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>p</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=k>AND</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>p</span><span class=p>.</span><span class=n>shop_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>c</span><span class=p>.</span><span class=n>nationality</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Swedish&#39;</span><span class=w> </span><span class=k>AND</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>c</span><span class=p>.</span><span class=n>hair</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Blond&#39;</span><span class=w> </span><span class=k>AND</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>s</span><span class=p>.</span><span class=n>city</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Stockholm&#39;</span><span class=w>
</span></span></span></code></pre></div><p>Here all the possible subqueries that can be generated from the above query.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- 1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>nationality</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Swedish&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 2
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>hair</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Blond&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 3
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>nationality</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Swedish&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>hair</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Blond&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 4
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>c</span><span class=p>,</span><span class=w> </span><span class=n>purchases</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>p</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>nationality</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Swedish&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 5
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>c</span><span class=p>,</span><span class=w> </span><span class=n>purchases</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>p</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>hair</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Blond&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 6
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>c</span><span class=p>,</span><span class=w> </span><span class=n>purchases</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>p</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>nationality</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Swedish&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>hair</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Blond&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 7
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>c</span><span class=p>,</span><span class=w> </span><span class=n>purchases</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>shops</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>nationality</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Swedish&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>shop_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 8
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>c</span><span class=p>,</span><span class=w> </span><span class=n>purchases</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>shops</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>hair</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Blond&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>shop_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 9
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>c</span><span class=p>,</span><span class=w> </span><span class=n>purchases</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>shops</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>nationality</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Swedish&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>hair</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Blond&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>shop_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 10
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>c</span><span class=p>,</span><span class=w> </span><span class=n>purchases</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>shops</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>nationality</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Swedish&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>city</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Stockholm&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>shop_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 11
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>c</span><span class=p>,</span><span class=w> </span><span class=n>purchases</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>shops</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>hair</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Blond&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>city</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Stockholm&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>shop_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 12
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>c</span><span class=p>,</span><span class=w> </span><span class=n>purchases</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>shops</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>nationality</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Swedish&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>hair</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Blond&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>city</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Stockholm&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>shop_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 13
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>c</span><span class=p>,</span><span class=w> </span><span class=n>purchases</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>shops</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>city</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Stockholm&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>shop_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 14
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>purchases</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>shops</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>city</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Stockholm&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>shop_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 15
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>shops</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AND</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>city</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Stockholm&#39;</span><span class=w>
</span></span></span></code></pre></div><p>You might notice that I&rsquo;ve omitted subqueries that don&rsquo;t include a <code>WHERE</code> statement. Indeed I&rsquo;m only interested in queries that filter on some attribute. Regardless, the number of possible subqueries is HUGE in comparison with the simplicity of the query (at least, in my opinion). I&rsquo;m lazy so I didn&rsquo;t take the time to find a nice formula that could tell me exactly how many subqueries to expect. However I wrote a Python script that enumerates all subqueries and saves to a JSON file. It took me some time to figure out so I thought it would be worth sharing.</p><p>I&rsquo;ll go through the steps of my code and then give you the link to the research project I&rsquo;m using it for on GitHub. The code is rather short and it doesn&rsquo;t require any dependencies. However, the code is a bit of a mouthful and isn&rsquo;t easy to understand without a little effort. Anyway, here goes.</p><p>I first wrote a function to parse an SQL query. This function, <code>parse_query</code>, returns a 3 <code>dict</code>s that contain the different part of the query.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>collections</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>remove_whitespaces</span><span class=p>(</span><span class=n>string</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;remove_whitespaces(&#39; cake  &#39;) =&gt; &#39;cake&#39;&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>string</span><span class=o>.</span><span class=n>lstrip</span><span class=p>()</span><span class=o>.</span><span class=n>rstrip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>replace_between</span><span class=p>(</span><span class=n>query</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;replace_between(&#39;BETWEEN 1 AND 3&#39;) =&gt; &#39;&gt;= 1 AND &lt;= 3&#39;&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=s1>&#39;BETWEEN&#39;</span> <span class=ow>in</span> <span class=n>query</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>idx</span> <span class=o>=</span> <span class=n>query</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s1>&#39;BETWEEN&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>right_val</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s2>&#34;AND ([&#39;a-zA-Z0-9]+)?&#34;</span><span class=p>,</span> <span class=n>query</span><span class=p>[</span><span class=n>idx</span><span class=p>:])</span><span class=o>.</span><span class=n>group</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>att</span> <span class=o>=</span> <span class=n>remove_whitespaces</span><span class=p>(</span><span class=n>query</span><span class=p>[:</span><span class=n>idx</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;AND&#39;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>query</span> <span class=o>=</span> <span class=n>query</span><span class=p>[:</span><span class=n>idx</span><span class=p>]</span> <span class=o>+</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;AND .+?\s&#39;</span><span class=p>,</span> <span class=sa>f</span><span class=s1>&#39;AND </span><span class=si>{</span><span class=n>att</span><span class=si>}</span><span class=s1> &lt;= </span><span class=si>{</span><span class=n>right_val</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>query</span><span class=p>[</span><span class=n>idx</span><span class=p>:],</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>query</span> <span class=o>=</span> <span class=n>query</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;BETWEEN&#39;</span><span class=p>,</span> <span class=s1>&#39;&gt;=&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>query</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>parse_query</span><span class=p>(</span><span class=n>query</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>query</span> <span class=o>=</span> <span class=n>query</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39; &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>from_part</span> <span class=o>=</span> <span class=n>query</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;FROM&#39;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;WHERE&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>where_part</span> <span class=o>=</span> <span class=n>query</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;WHERE&#39;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>where_part</span> <span class=o>=</span> <span class=n>replace_between</span><span class=p>(</span><span class=n>where_part</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>froms</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nb>reversed</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=n>remove_whitespaces</span><span class=p>,</span> <span class=n>name</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;AS&#39;</span><span class=p>))))</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>from_part</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>joins</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=n>wheres</span> <span class=o>=</span> <span class=n>collections</span><span class=o>.</span><span class=n>defaultdict</span><span class=p>(</span><span class=nb>list</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Parse the WHERE statement</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>where</span> <span class=ow>in</span> <span class=nb>list</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=n>remove_whitespaces</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;AND\s*(?![^()]*\))&#39;</span><span class=p>,</span> <span class=n>where_part</span><span class=p>))):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=s1>&#39;OR&#39;</span> <span class=ow>in</span> <span class=n>where</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>rel</span> <span class=o>=</span> <span class=n>where</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>            <span class=n>wheres</span><span class=p>[</span><span class=n>rel</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>where</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>op</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;(</span><span class=si>{</span><span class=n>op</span><span class=si>}</span><span class=s1>)&#39;</span> <span class=k>for</span> <span class=n>op</span> <span class=ow>in</span> <span class=n>OPERATORS</span><span class=p>),</span> <span class=n>where</span><span class=p>)</span><span class=o>.</span><span class=n>group</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>left</span><span class=p>,</span> <span class=n>right</span> <span class=o>=</span> <span class=n>where</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>op</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>left</span> <span class=o>=</span> <span class=n>remove_whitespaces</span><span class=p>(</span><span class=n>left</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>right</span> <span class=o>=</span> <span class=n>remove_whitespaces</span><span class=p>(</span><span class=n>right</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>op</span> <span class=o>=</span> <span class=n>remove_whitespaces</span><span class=p>(</span><span class=n>op</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>op</span> <span class=o>==</span> <span class=s1>&#39;=&#39;</span> <span class=ow>and</span> <span class=s1>&#39;.&#39;</span> <span class=ow>in</span> <span class=n>right</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>l_rel</span> <span class=o>=</span> <span class=n>left</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>r_rel</span> <span class=o>=</span> <span class=n>right</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>joins</span><span class=p>[</span><span class=nb>tuple</span><span class=p>(</span><span class=nb>sorted</span><span class=p>([</span><span class=n>l_rel</span><span class=p>,</span> <span class=n>r_rel</span><span class=p>]))]</span> <span class=o>=</span> <span class=n>where</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>rel</span> <span class=o>=</span> <span class=n>left</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>wheres</span><span class=p>[</span><span class=n>rel</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>where</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>froms</span><span class=p>,</span> <span class=n>wheres</span><span class=p>,</span> <span class=n>joins</span>
</span></span></code></pre></div><p>I know, it&rsquo;s not very pretty. But you can at least understand the outputs. <code>froms</code> is a <code>dict</code> where the keys are the relation aliases and the values are the relation names.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;c&#39;</span><span class=p>:</span> <span class=s1>&#39;customers&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;p&#39;</span><span class=p>:</span> <span class=s1>&#39;purchases&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;s&#39;</span><span class=p>:</span> <span class=s1>&#39;shops&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>As for <code>wheres</code>, it lists the <code>WHERE</code> clauses of each relation.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;c&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;c.nationality = &#39;Swedish&#39;&#34;</span><span class=p>,</span> <span class=s2>&#34;c.hair = &#39;Blond&#39;&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;s&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;s.city = &#39;Stockholm&#39;&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Finally, <code>joins</code> maps pairs of relations to their associated join clause.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=s1>&#39;c&#39;</span><span class=p>,</span> <span class=s1>&#39;p&#39;</span><span class=p>):</span> <span class=s1>&#39;p.customer_id = c.id&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=s1>&#39;p&#39;</span><span class=p>,</span> <span class=s1>&#39;s&#39;</span><span class=p>):</span> <span class=s1>&#39;p.shop_id = s.id&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The <code>parse_query</code> function is the weakest part of my script. It relies on the fact that the provided query has a certain structure that I won&rsquo;t dwell on. Basically each relation must have an alias (e.g. <code>shops AS s</code>) and the <code>WHERE</code> conditions should all be separated by <code>AND</code>s (not <code>OR</code>s). I tailored this to work for the TPC-DS benchmark queries. If you wanted to reuse my script for other types of queries, then I believe that you would mostly have to tinker with <code>parse_query</code>.</p><p>The second main function I wrote is called <code>yield_subqueries</code>. It&rsquo;s a generator that will return each subquery one by one.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>powerset</span><span class=p>(</span><span class=n>iterable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;powerset([1,2,3]) =&gt; (1,) (2,) (3,) (1, 2) (1, 3) (2, 3) (1, 2, 3)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>iterable</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>itertools</span><span class=o>.</span><span class=n>chain</span><span class=o>.</span><span class=n>from_iterable</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>itertools</span><span class=o>.</span><span class=n>combinations</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>yield_subqueries</span><span class=p>(</span><span class=n>query</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>froms</span><span class=p>,</span> <span class=n>wheres</span><span class=p>,</span> <span class=n>joins</span> <span class=o>=</span> <span class=n>parse_query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>relations</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>sorted</span><span class=p>(</span><span class=n>froms</span><span class=o>.</span><span class=n>keys</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>adjacencies</span> <span class=o>=</span> <span class=p>[[</span><span class=mi>0</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>relations</span><span class=p>))]</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>relations</span><span class=p>))]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>pair</span> <span class=ow>in</span> <span class=n>joins</span><span class=o>.</span><span class=n>keys</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span><span class=p>,</span> <span class=n>j</span> <span class=o>=</span> <span class=n>relations</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>pair</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=n>relations</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>pair</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>adjacencies</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>adjacencies</span><span class=p>[</span><span class=n>j</span><span class=p>][</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>combos</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>enum</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>combo</span><span class=p>,</span> <span class=n>seen</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>candidates</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span><span class=p>,</span> <span class=n>ok</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>adjacencies</span><span class=p>[</span><span class=n>i</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>j</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>seen</span> <span class=ow>and</span> <span class=n>ok</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>candidates</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>pick</span> <span class=ow>in</span> <span class=n>powerset</span><span class=p>(</span><span class=n>candidates</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>yield</span> <span class=n>combo</span> <span class=o>+</span> <span class=p>[</span><span class=n>relations</span><span class=p>[</span><span class=n>p</span><span class=p>]</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>pick</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>pick</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>new_combo</span> <span class=ow>in</span> <span class=n>enum</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>combo</span> <span class=o>+</span> <span class=p>[</span><span class=n>relations</span><span class=p>[</span><span class=n>p</span><span class=p>]</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>pick</span><span class=p>],</span> <span class=p>{</span><span class=o>*</span><span class=n>seen</span><span class=p>,</span> <span class=o>*</span><span class=n>candidates</span><span class=p>}):</span>
</span></span><span class=line><span class=cl>                    <span class=k>yield</span> <span class=n>new_combo</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>rel</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>relations</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>combos</span><span class=o>.</span><span class=n>add</span><span class=p>((</span><span class=n>rel</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>combo</span> <span class=ow>in</span> <span class=n>enum</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=p>[</span><span class=n>rel</span><span class=p>],</span> <span class=p>{</span><span class=n>i</span><span class=p>}):</span>
</span></span><span class=line><span class=cl>            <span class=n>combos</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=nb>tuple</span><span class=p>(</span><span class=nb>sorted</span><span class=p>(</span><span class=n>combo</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>combo</span> <span class=ow>in</span> <span class=n>combos</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>relevant_joins</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>filter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=kc>None</span><span class=o>.</span><span class=fm>__ne__</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=n>joins</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>tuple</span><span class=p>(</span><span class=nb>sorted</span><span class=p>(</span><span class=n>pair</span><span class=p>)))</span> <span class=k>for</span> <span class=n>pair</span> <span class=ow>in</span> <span class=n>itertools</span><span class=o>.</span><span class=n>combinations</span><span class=p>(</span><span class=n>combo</span><span class=p>,</span> <span class=mi>2</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>        <span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>relevant_wheres</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>itertools</span><span class=o>.</span><span class=n>chain</span><span class=p>(</span><span class=o>*</span><span class=p>[</span><span class=n>wheres</span><span class=p>[</span><span class=n>r</span><span class=p>]</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>combo</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>from_stmt</span> <span class=o>=</span> <span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>froms</span><span class=p>[</span><span class=n>rel</span><span class=p>]</span><span class=si>}</span><span class=s1> AS </span><span class=si>{</span><span class=n>rel</span><span class=si>}</span><span class=s1>&#39;</span> <span class=k>for</span> <span class=n>rel</span> <span class=ow>in</span> <span class=n>combo</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>join_stmt</span> <span class=o>=</span> <span class=s1>&#39; AND &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>relevant_joins</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>sql</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;SELECT * FROM </span><span class=si>{</span><span class=n>from_stmt</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>join_stmt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>sql</span> <span class=o>+=</span> <span class=s1>&#39; AND &#39;</span> <span class=o>+</span> <span class=n>join_stmt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>where_combo</span> <span class=ow>in</span> <span class=n>powerset</span><span class=p>(</span><span class=n>relevant_wheres</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>subquery</span> <span class=o>=</span> <span class=p>(</span><span class=n>sql</span> <span class=o>+</span> <span class=s1>&#39; AND &#39;</span> <span class=o>+</span> <span class=s1>&#39; AND &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>where_combo</span><span class=p>))</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;AND&#39;</span><span class=p>,</span> <span class=s1>&#39;WHERE&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>subquery</span> <span class=o>=</span> <span class=n>subquery</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=s1>&#39;\s+&#39;</span><span class=p>,</span> <span class=s1>&#39; &#39;</span><span class=p>,</span> <span class=n>subquery</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>yield</span> <span class=n>subquery</span>
</span></span></code></pre></div><p>Again, it&rsquo;s hard to understand but it&rsquo;s worked really well for me and is quite fast. The idea is to build an adjacency matrix which tells us which relations each relation is connected to in the query. In our case this would be:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>],</span>  <span class=c1># customers</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span>  <span class=c1># purchases</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span>   <span class=c1># shops</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>The idea is to then loop over each row and &ldquo;walk&rdquo; the adjacency matrix until having enumerated all possible join combinations. For each join combination we&rsquo;re also going to enumerate all the possible <code>WHERE</code> statements. These are called <code>relevant_joins</code> and <code>relevant_wheres</code>. <code>combos</code> is a set that contains all the possible join combinations. I know, it&rsquo;s a bit of a mouthful.</p><p>Inside the <code>main()</code> of my <code>script</code> I simply looped over the TPC-DS benchmark queries and saved all the subqueries I could enumerate.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>glob</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=s1>&#39;join-order-benchmark/*.sql&#39;</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>query_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>path</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;.&#34;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>query_name</span> <span class=ow>in</span> <span class=p>(</span><span class=s1>&#39;fkindexes&#39;</span><span class=p>,</span> <span class=s1>&#39;schema&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Load and tidy the query</span>
</span></span><span class=line><span class=cl>        <span class=n>query</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>rstrip</span><span class=p>()</span><span class=o>.</span><span class=n>rstrip</span><span class=p>(</span><span class=s1>&#39;;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Enumerate the subqueries and save them</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>subquery</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>yield_subqueries</span><span class=p>(</span><span class=n>query</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>subquery</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s1>&#39;mother_query&#39;</span><span class=p>:</span> <span class=n>query_name</span><span class=p>,</span> <span class=s1>&#39;sql&#39;</span><span class=p>:</span> <span class=n>subquery</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Enumerated </span><span class=si>{</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=si>}</span><span class=s1> subqueries for query </span><span class=si>{</span><span class=n>query_name</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;results.json&#39;</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>results</span><span class=p>,</span> <span class=n>f</span><span class=p>)</span>
</span></span></code></pre></div><p>The TPC-DS benchmark contains 113 queries. My script produces a total of 5,122,790 queries in under 4 minutes. Here&rsquo;s the breakdown per query:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>Query 10a: <span class=m>477</span>
</span></span><span class=line><span class=cl>Query 10b: <span class=m>225</span>
</span></span><span class=line><span class=cl>Query 10c: <span class=m>140</span>
</span></span><span class=line><span class=cl>Query 11a: <span class=m>1842</span>
</span></span><span class=line><span class=cl>Query 11b: <span class=m>1842</span>
</span></span><span class=line><span class=cl>Query 11c: <span class=m>1471</span>
</span></span><span class=line><span class=cl>Query 11d: <span class=m>869</span>
</span></span><span class=line><span class=cl>Query 12a: <span class=m>1730</span>
</span></span><span class=line><span class=cl>Query 12b: <span class=m>922</span>
</span></span><span class=line><span class=cl>Query 12c: <span class=m>1730</span>
</span></span><span class=line><span class=cl>Query 13a: <span class=m>261</span>
</span></span><span class=line><span class=cl>Query 13b: <span class=m>981</span>
</span></span><span class=line><span class=cl>Query 13c: <span class=m>981</span>
</span></span><span class=line><span class=cl>Query 13d: <span class=m>261</span>
</span></span><span class=line><span class=cl>Query 14a: <span class=m>760</span>
</span></span><span class=line><span class=cl>Query 14b: <span class=m>1424</span>
</span></span><span class=line><span class=cl>Query 14c: <span class=m>1032</span>
</span></span><span class=line><span class=cl>Query 15a: <span class=m>4724</span>
</span></span><span class=line><span class=cl>Query 15b: <span class=m>12946</span>
</span></span><span class=line><span class=cl>Query 15c: <span class=m>2504</span>
</span></span><span class=line><span class=cl>Query 15d: <span class=m>596</span>
</span></span><span class=line><span class=cl>Query 16a: <span class=m>258</span>
</span></span><span class=line><span class=cl>Query 16b: <span class=m>54</span>
</span></span><span class=line><span class=cl>Query 16c: <span class=m>122</span>
</span></span><span class=line><span class=cl>Query 16d: <span class=m>258</span>
</span></span><span class=line><span class=cl>Query 17a: <span class=m>63</span>
</span></span><span class=line><span class=cl>Query 17b: <span class=m>38</span>
</span></span><span class=line><span class=cl>Query 17c: <span class=m>38</span>
</span></span><span class=line><span class=cl>Query 17d: <span class=m>38</span>
</span></span><span class=line><span class=cl>Query 17e: <span class=m>38</span>
</span></span><span class=line><span class=cl>Query 17f: <span class=m>38</span>
</span></span><span class=line><span class=cl>Query 18a: <span class=m>241</span>
</span></span><span class=line><span class=cl>Query 18b: <span class=m>3678</span>
</span></span><span class=line><span class=cl>Query 18c: <span class=m>279</span>
</span></span><span class=line><span class=cl>Query 19a: <span class=m>64218</span>
</span></span><span class=line><span class=cl>Query 19b: <span class=m>115806</span>
</span></span><span class=line><span class=cl>Query 19c: <span class=m>12945</span>
</span></span><span class=line><span class=cl>Query 19d: <span class=m>2393</span>
</span></span><span class=line><span class=cl>Query 1a: <span class=m>88</span>
</span></span><span class=line><span class=cl>Query 1b: <span class=m>124</span>
</span></span><span class=line><span class=cl>Query 1c: <span class=m>68</span>
</span></span><span class=line><span class=cl>Query 1d: <span class=m>68</span>
</span></span><span class=line><span class=cl>Query 20a: <span class=m>1063</span>
</span></span><span class=line><span class=cl>Query 20b: <span class=m>1504</span>
</span></span><span class=line><span class=cl>Query 20c: <span class=m>1063</span>
</span></span><span class=line><span class=cl>Query 21a: <span class=m>5598</span>
</span></span><span class=line><span class=cl>Query 21b: <span class=m>5598</span>
</span></span><span class=line><span class=cl>Query 21c: <span class=m>5598</span>
</span></span><span class=line><span class=cl>Query 22a: <span class=m>10337</span>
</span></span><span class=line><span class=cl>Query 22b: <span class=m>10337</span>
</span></span><span class=line><span class=cl>Query 22c: <span class=m>10337</span>
</span></span><span class=line><span class=cl>Query 22d: <span class=m>2993</span>
</span></span><span class=line><span class=cl>Query 23a: <span class=m>5586</span>
</span></span><span class=line><span class=cl>Query 23b: <span class=m>3289</span>
</span></span><span class=line><span class=cl>Query 23c: <span class=m>5586</span>
</span></span><span class=line><span class=cl>Query 24a: <span class=m>33458</span>
</span></span><span class=line><span class=cl>Query 24b: <span class=m>69108</span>
</span></span><span class=line><span class=cl>Query 25a: <span class=m>852</span>
</span></span><span class=line><span class=cl>Query 25b: <span class=m>2340</span>
</span></span><span class=line><span class=cl>Query 25c: <span class=m>852</span>
</span></span><span class=line><span class=cl>Query 26a: <span class=m>4400</span>
</span></span><span class=line><span class=cl>Query 26b: <span class=m>4400</span>
</span></span><span class=line><span class=cl>Query 26c: <span class=m>2608</span>
</span></span><span class=line><span class=cl>Query 27a: <span class=m>28616</span>
</span></span><span class=line><span class=cl>Query 27b: <span class=m>16904</span>
</span></span><span class=line><span class=cl>Query 27c: <span class=m>28616</span>
</span></span><span class=line><span class=cl>Query 28a: <span class=m>41839</span>
</span></span><span class=line><span class=cl>Query 28b: <span class=m>41839</span>
</span></span><span class=line><span class=cl>Query 28c: <span class=m>41839</span>
</span></span><span class=line><span class=cl>Query 29a: <span class=m>2245875</span>
</span></span><span class=line><span class=cl>Query 29b: <span class=m>1302387</span>
</span></span><span class=line><span class=cl>Query 29c: <span class=m>832050</span>
</span></span><span class=line><span class=cl>Query 2a: <span class=m>16</span>
</span></span><span class=line><span class=cl>Query 2b: <span class=m>16</span>
</span></span><span class=line><span class=cl>Query 2c: <span class=m>16</span>
</span></span><span class=line><span class=cl>Query 2d: <span class=m>16</span>
</span></span><span class=line><span class=cl>Query 30a: <span class=m>7302</span>
</span></span><span class=line><span class=cl>Query 30b: <span class=m>12550</span>
</span></span><span class=line><span class=cl>Query 30c: <span class=m>4678</span>
</span></span><span class=line><span class=cl>Query 31a: <span class=m>2421</span>
</span></span><span class=line><span class=cl>Query 31b: <span class=m>11141</span>
</span></span><span class=line><span class=cl>Query 31c: <span class=m>1908</span>
</span></span><span class=line><span class=cl>Query 32a: <span class=m>7</span>
</span></span><span class=line><span class=cl>Query 32b: <span class=m>7</span>
</span></span><span class=line><span class=cl>Query 33a: <span class=m>12339</span>
</span></span><span class=line><span class=cl>Query 33b: <span class=m>6609</span>
</span></span><span class=line><span class=cl>Query 33c: <span class=m>12339</span>
</span></span><span class=line><span class=cl>Query 3a: <span class=m>25</span>
</span></span><span class=line><span class=cl>Query 3b: <span class=m>25</span>
</span></span><span class=line><span class=cl>Query 3c: <span class=m>25</span>
</span></span><span class=line><span class=cl>Query 4a: <span class=m>68</span>
</span></span><span class=line><span class=cl>Query 4b: <span class=m>68</span>
</span></span><span class=line><span class=cl>Query 4c: <span class=m>68</span>
</span></span><span class=line><span class=cl>Query 5a: <span class=m>178</span>
</span></span><span class=line><span class=cl>Query 5b: <span class=m>358</span>
</span></span><span class=line><span class=cl>Query 5c: <span class=m>178</span>
</span></span><span class=line><span class=cl>Query 6a: <span class=m>32</span>
</span></span><span class=line><span class=cl>Query 6b: <span class=m>32</span>
</span></span><span class=line><span class=cl>Query 6c: <span class=m>32</span>
</span></span><span class=line><span class=cl>Query 6d: <span class=m>32</span>
</span></span><span class=line><span class=cl>Query 6e: <span class=m>32</span>
</span></span><span class=line><span class=cl>Query 6f: <span class=m>19</span>
</span></span><span class=line><span class=cl>Query 7a: <span class=m>3901</span>
</span></span><span class=line><span class=cl>Query 7b: <span class=m>2137</span>
</span></span><span class=line><span class=cl>Query 7c: <span class=m>6547</span>
</span></span><span class=line><span class=cl>Query 8a: <span class=m>1540</span>
</span></span><span class=line><span class=cl>Query 8b: <span class=m>13679</span>
</span></span><span class=line><span class=cl>Query 8c: <span class=m>52</span>
</span></span><span class=line><span class=cl>Query 8d: <span class=m>52</span>
</span></span><span class=line><span class=cl>Query 9a: <span class=m>7771</span>
</span></span><span class=line><span class=cl>Query 9b: <span class=m>7771</span>
</span></span><span class=line><span class=cl>Query 9c: <span class=m>874</span>
</span></span><span class=line><span class=cl>Query 9d: <span class=m>486</span>
</span></span></code></pre></div><p>I&rsquo;m sure it&rsquo;s possible to do this faster and with more obvious code, but this is as could I judged necessary with respect to the rest of my PhD work. The full script is available in <a href=https://github.com/MaxHalford/online-selectivity-correction>this GitHub repository</a> in the <code>scripts</code> directory.</p><p>I hope someday this helps someone!</p></div><script type=text/javascript>var s=document.createElement("script");s.setAttribute("src","https://utteranc.es/client.js"),s.setAttribute("repo","MaxHalford/maxhalford.github.io"),s.setAttribute("issue-term","pathname"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",null),s.setAttribute("theme","github-light"),document.body.appendChild(s)</script><div style=display:flex;flex-direction:row;justify-content:center;align-items:center;gap:20px;margin-bottom:30px><div class=do-the-thing><div class=elevator><svg class="sweet-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" enable-background="new 0 0 100 100" height="100" width="100"><path d="M70 47.5H30c-1.4.0-2.5 1.1-2.5 2.5v40c0 1.4 1.1 2.5 2.5 2.5h40c1.4.0 2.5-1.1 2.5-2.5V50C72.5 48.6 71.4 47.5 70 47.5zm-22.5 40h-5v-25h5v25zm10 0h-5v-25h5v25zm10 0h-5V60c0-1.4-1.1-2.5-2.5-2.5H40c-1.4.0-2.5 1.1-2.5 2.5v27.5h-5v-35h35v35z"/><path d="M50 42.5c1.4.0 2.5-1.1 2.5-2.5V16l5.7 5.7c.5.5 1.1.7 1.8.7s1.3-.2 1.8-.7c1-1 1-2.6.0-3.5l-10-10c-1-1-2.6-1-3.5.0l-10 10c-1 1-1 2.6.0 3.5 1 1 2.6 1 3.5.0l5.7-5.7v24c0 1.4 1.1 2.5 2.5 2.5z"/></svg>Back to the top</div></div><iframe src=https://github.com/sponsors/MaxHalford/button title="Sponsor MaxHalford" height=32 width=114 style=border:0;border-radius:6px></iframe></div><script src=https://cdnjs.cloudflare.com/ajax/libs/elevator.js/1.0.1/elevator.min.js></script>
<script>var elementButton=document.querySelector(".elevator"),elevator=new Elevator({element:elementButton,mainAudio:"/music/elevator.mp3",endAudio:"/music/ding.mp3"})</script><style>.down-arrow{font-size:120px;margin-top:90px;margin-bottom:90px;text-shadow:0 -20px #0c1f31,0 0 #c33329;color:transparent;-webkit-transform:scaleY(.8);-moz-transform:scaleY(.8);transform:scaleY(.8)}.elevator{text-align:center;cursor:pointer;width:140px;margin:auto}.elevator:hover{opacity:.7}.elevator svg{width:40px;height:40px;display:block;margin:auto;margin-bottom:5px}</style></div></div></article><script></script></body></html>