<!doctype html><html lang=en>
<head>
<script async defer data-website-id=6023252a-3a97-470f-b4ee-5082d242bb9a src=https://umami.pourtan.eu/umami.js></script>
<meta charset=utf-8>
<meta name=generator content="Hugo 0.88.1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Max Halford">
<meta property="og:url" content="https://maxhalford.github.io/blog/pandas-tricks/">
<link rel=canonical href=https://maxhalford.github.io/blog/pandas-tricks/>
<link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¦”</text></svg>">
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/maxhalford.github.io\/"},"articleSection":"blog","name":"A few intermediate pandas tricks","headline":"A few intermediate pandas tricks","description":"I want to use this post to share some pandas snippets that I find useful. I use them from time to time, in particular when I\u0026rsquo;m doing time series competitions on platforms such as Kaggle. Like any data scientist, I perform similar data processing steps on different datasets. Usually, I put repetitive patterns in xam, which is my personal data science toolbox. However, I think that the following snippets are too small and too specific for being added into a library.","inLanguage":"en-US","author":"Max Halford","creator":"Max Halford","publisher":"Max Halford","accountablePerson":"Max Halford","copyrightHolder":"Max Halford","copyrightYear":"2020","datePublished":"2020-08-17 00:00:00 \u002b0000 UTC","dateModified":"2020-08-17 00:00:00 \u002b0000 UTC","url":"https:\/\/maxhalford.github.io\/blog\/pandas-tricks\/","keywords":[]}</script>
<title>A few intermediate pandas tricks - Max Halford</title>
<meta property="og:title" content="A few intermediate pandas tricks - Max Halford">
<meta property="og:type" content="article">
<meta name=description content="I want to use this post to share some pandas snippets that I find useful. I use them from time to time, in particular when I&rsquo;m doing time series competitions on platforms such as Kaggle. Like any data scientist, I perform similar data processing steps on different datasets. Usually, I put repetitive patterns in xam, which is my personal data science toolbox. However, I think that the following snippets are too small and too specific for being added into a library.">
<link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.css>
<link rel=stylesheet href=/css/github-markdown.min.css>
<link rel=stylesheet href=/css/highlight/github.css>
<link rel=stylesheet href=/css/index.css>
<link rel=preconnect href=https://fonts.gstatic.com>
<link href="https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&family=Permanent+Marker&display=swap" rel=stylesheet>
<script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']],processEscapes:!0,processEnvironments:!0,tags:'ams'},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}},window.addEventListener('load',a=>{document.querySelectorAll('mjx-container').forEach(function(a){a.parentElement.classList+='has-jax'})})</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script>
</head>
<body>
<article class=post id=article>
<div class="row center-xs" style=text-align:left>
<div class="col-xs-12 col-sm-10 col-md-7 col-lg-5">
<div class=post-header>
<header>
<div class="signatures site-title">
<a href=/>Max Halford</a>
</div>
</header>
<div class="row end-xs">
<div>
<a class=header-link href=/>Blog</a>
<a class=header-link href=/links/>Links</a>
<a class=header-link href=/bio/>Bio</a>
</div>
</div>
<div class=header-line></div>
</div>
<header class=post-header>
<h1 class=post-title>A few intermediate pandas tricks</h1>
<div class="row post-desc">
<div class=col-xs-12>
<time class=post-date datetime="2020-08-17 00:00:00 UTC">
2020-08-17 Â· 7 minute read
</time>
</div>
</div>
</header>
<div class="post-content markdown-body">
<h2 id=toc>Table of contents</h2>
<nav id=TableOfContents>
<ul>
<li><a href=#time-sinceuntil-event>Time since/until event</a></li>
<li><a href=#longest-event-streak>Longest event streak</a></li>
<li><a href=#target-encoding-for-time-series>Target encoding for time series</a></li>
</ul>
</nav>
<p>I want to use this post to share some <code>pandas</code> snippets that I find useful. I use them from time to time, in particular when I&rsquo;m doing <a href="https://www.kaggle.com/search?q=time+series+in%3Acompetitions">time series competitions</a> on platforms such as Kaggle. Like any data scientist, I perform similar data processing steps on different datasets. Usually, I put repetitive patterns in <a href=https://github.com/MaxHalford/xam><code>xam</code></a>, which is my personal data science toolbox. However, I think that the following snippets are too small and too specific for being added into a library.</p>
<p>Some of the following code assumes that you&rsquo;re using <a href=https://pandas.pydata.org/docs/whatsnew/v1.0.0.html>version <code>1.0</code> of <code>pandas</code></a>, which in particular added support for <a href=https://pandas.pydata.org/docs/whatsnew/v1.0.0.html#experimental-na-scalar-to-denote-missing-values>typed missing values</a>. Note that the following code is not guaranteed to be the optimal way of proceeding. If you have a quicker solution, then feel welcome to post a comment at the bottom of this post.</p>
<h2 id=time-sinceuntil-event>Time since/until event</h2>
<p>Take the following series of weather indications:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>

<span class=n>weather</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;rain&#39;</span><span class=p>,</span> <span class=s1>&#39;sun&#39;</span><span class=p>,</span> <span class=s1>&#39;snow&#39;</span><span class=p>,</span> <span class=s1>&#39;snow&#39;</span><span class=p>,</span> <span class=s1>&#39;snow&#39;</span><span class=p>,</span> <span class=s1>&#39;sun&#39;</span><span class=p>,</span> <span class=s1>&#39;rain&#39;</span><span class=p>,</span> <span class=s1>&#39;rain&#39;</span><span class=p>]</span>
<span class=n>weather</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>weather</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=s1>&#39;category&#39;</span><span class=p>)</span>
<span class=n>weather</span>
</code></pre></div><table>
<thead>
<tr>
<th style=text-align:left>weather</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>rain</td>
</tr>
<tr>
<td style=text-align:left>sun</td>
</tr>
<tr>
<td style=text-align:left>snow</td>
</tr>
<tr>
<td style=text-align:left>snow</td>
</tr>
<tr>
<td style=text-align:left>snow</td>
</tr>
<tr>
<td style=text-align:left>sun</td>
</tr>
<tr>
<td style=text-align:left>rain</td>
</tr>
<tr>
<td style=text-align:left>rain</td>
</tr>
</tbody>
</table>
<p>Depending on the problem, it might be worthwhile to extract the time since an event occurred. For instance, we might want to produce a feature that indicates how long ago the <code>'rain'</code> value occurred. For the sake of simplicity, I&rsquo;m going to assume that the period between each row is constant. I will thus simply count the number of steps that occured since each value appeared. Ideally, we want to have one column for each distinct value. Here is the code I use for doing so:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=k>def</span> <span class=nf>steps_since</span><span class=p>(</span><span class=n>series</span><span class=p>):</span>

    <span class=n>features</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=n>series</span><span class=o>.</span><span class=n>index</span><span class=p>)</span>

    <span class=k>for</span> <span class=n>cat</span> <span class=ow>in</span> <span class=n>series</span><span class=o>.</span><span class=n>cat</span><span class=o>.</span><span class=n>categories</span><span class=p>:</span>
        <span class=n>counts</span> <span class=o>=</span> <span class=n>series</span><span class=o>.</span><span class=n>eq</span><span class=p>(</span><span class=n>cat</span><span class=p>)</span><span class=o>.</span><span class=n>cumsum</span><span class=p>()</span>
        <span class=n>since</span> <span class=o>=</span> <span class=n>counts</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>counts</span><span class=p>)</span><span class=o>.</span><span class=n>cumcount</span><span class=p>()</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=s1>&#39;Int64&#39;</span><span class=p>)</span>
        <span class=n>since</span><span class=p>[</span><span class=n>counts</span><span class=o>.</span><span class=n>eq</span><span class=p>(</span><span class=mi>0</span><span class=p>)]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>NA</span>
        <span class=n>features</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;steps_since_</span><span class=si>{</span><span class=n>cat</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>since</span>

    <span class=k>return</span> <span class=n>features</span>

<span class=n>steps_since</span><span class=p>(</span><span class=n>weather</span><span class=p>)</span>
</code></pre></div><table>
<thead>
<tr>
<th style=text-align:right>steps_since_rain</th>
<th style=text-align:right>steps_since_snow</th>
<th style=text-align:right>steps_since_sun</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:right>0</td>
<td style=text-align:right>NA</td>
<td style=text-align:right>NA</td>
</tr>
<tr>
<td style=text-align:right>1</td>
<td style=text-align:right>NA</td>
<td style=text-align:right>0</td>
</tr>
<tr>
<td style=text-align:right>2</td>
<td style=text-align:right>0</td>
<td style=text-align:right>1</td>
</tr>
<tr>
<td style=text-align:right>3</td>
<td style=text-align:right>0</td>
<td style=text-align:right>2</td>
</tr>
<tr>
<td style=text-align:right>4</td>
<td style=text-align:right>0</td>
<td style=text-align:right>3</td>
</tr>
<tr>
<td style=text-align:right>5</td>
<td style=text-align:right>1</td>
<td style=text-align:right>0</td>
</tr>
<tr>
<td style=text-align:right>0</td>
<td style=text-align:right>2</td>
<td style=text-align:right>1</td>
</tr>
<tr>
<td style=text-align:right>0</td>
<td style=text-align:right>3</td>
<td style=text-align:right>2</td>
</tr>
</tbody>
</table>
<p>I&rsquo;ve assumed that the provided series contains <a href=https://pandas.pydata.org/pandas-docs/stable/user_guide/categorical.html>categorical data</a>. This allows us to access the list of categories via <code>series.cat.categories</code>. You could use <code>series.unique()</code> instead. I&rsquo;ve also taken care of inserting <code>NA</code>s for values that haven&rsquo;t yet occurred. Before version <code>1.0</code>, missing values were commonly indicated with <code>np.nan</code>, but this required the series to be of type <code>float64</code>. The modern approach is to use the <code>Int64</code> type in combination of <code>pd.NA</code> to store nullable integers.</p>
<p>How about the following dataset?</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=n>weather_per_country</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
    <span class=s1>&#39;country&#39;</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>Categorical</span><span class=p>([</span><span class=s1>&#39;France&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=p>[</span><span class=s1>&#39;Germany&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>4</span><span class=p>),</span>
    <span class=s1>&#39;weather&#39;</span><span class=p>:</span> <span class=n>weather</span>
<span class=p>})</span>
<span class=n>weather_per_country</span>
</code></pre></div><table>
<thead>
<tr>
<th style=text-align:left>country</th>
<th style=text-align:left>weather</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>France</td>
<td style=text-align:left>rain</td>
</tr>
<tr>
<td style=text-align:left>France</td>
<td style=text-align:left>sun</td>
</tr>
<tr>
<td style=text-align:left>France</td>
<td style=text-align:left>snow</td>
</tr>
<tr>
<td style=text-align:left>France</td>
<td style=text-align:left>snow</td>
</tr>
<tr>
<td style=text-align:left>Germany</td>
<td style=text-align:left>snow</td>
</tr>
<tr>
<td style=text-align:left>Germany</td>
<td style=text-align:left>sun</td>
</tr>
<tr>
<td style=text-align:left>Germany</td>
<td style=text-align:left>rain</td>
</tr>
<tr>
<td style=text-align:left>Germany</td>
<td style=text-align:left>sun</td>
</tr>
</tbody>
</table>
<p>In this case, we might want to extract the time since each event, within each country. We can so via a <code>groupby</code>:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
    <span class=n>steps_since</span><span class=p>(</span><span class=n>g</span><span class=p>[</span><span class=s1>&#39;weather&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>assign</span><span class=p>(</span><span class=n>country</span><span class=o>=</span><span class=n>country</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>country</span><span class=p>,</span> <span class=n>g</span> <span class=ow>in</span> <span class=n>weather_per_country</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;country&#39;</span><span class=p>)</span>
<span class=p>)</span>
</code></pre></div><table>
<thead>
<tr>
<th style=text-align:right>steps_since_rain</th>
<th style=text-align:right>steps_since_snow</th>
<th style=text-align:right>steps_since_sun</th>
<th style=text-align:left>country</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:right>0</td>
<td style=text-align:right>NA</td>
<td style=text-align:right>NA</td>
<td style=text-align:left>France</td>
</tr>
<tr>
<td style=text-align:right>1</td>
<td style=text-align:right>NA</td>
<td style=text-align:right>0</td>
<td style=text-align:left>France</td>
</tr>
<tr>
<td style=text-align:right>2</td>
<td style=text-align:right>0</td>
<td style=text-align:right>1</td>
<td style=text-align:left>France</td>
</tr>
<tr>
<td style=text-align:right>3</td>
<td style=text-align:right>0</td>
<td style=text-align:right>2</td>
<td style=text-align:left>France</td>
</tr>
<tr>
<td style=text-align:right>NA</td>
<td style=text-align:right>0</td>
<td style=text-align:right>NA</td>
<td style=text-align:left>Germany</td>
</tr>
<tr>
<td style=text-align:right>NA</td>
<td style=text-align:right>1</td>
<td style=text-align:right>0</td>
<td style=text-align:left>Germany</td>
</tr>
<tr>
<td style=text-align:right>0</td>
<td style=text-align:right>2</td>
<td style=text-align:right>1</td>
<td style=text-align:left>Germany</td>
</tr>
<tr>
<td style=text-align:right>0</td>
<td style=text-align:right>3</td>
<td style=text-align:right>2</td>
<td style=text-align:left>Germany</td>
</tr>
</tbody>
</table>
<p>Finally, what about obtaining the number of steps <em>until</em> an event, rather than <em>since</em> an event? This can be done by rewriting the code <code>steps_since</code> function and inverting the series before counting:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=k>def</span> <span class=nf>steps_until</span><span class=p>(</span><span class=n>series</span><span class=p>):</span>

    <span class=n>features</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>index</span><span class=o>=</span><span class=n>series</span><span class=o>.</span><span class=n>index</span><span class=p>)</span>

    <span class=k>for</span> <span class=n>cat</span> <span class=ow>in</span> <span class=n>series</span><span class=o>.</span><span class=n>cat</span><span class=o>.</span><span class=n>categories</span><span class=p>:</span>
        <span class=n>counts</span> <span class=o>=</span> <span class=n>series</span><span class=o>.</span><span class=n>eq</span><span class=p>(</span><span class=n>cat</span><span class=p>)</span><span class=o>.</span><span class=n>iloc</span><span class=p>[::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>cumsum</span><span class=p>()</span>
        <span class=n>until</span> <span class=o>=</span> <span class=n>counts</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>counts</span><span class=p>)</span><span class=o>.</span><span class=n>cumcount</span><span class=p>()</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=s1>&#39;Int64&#39;</span><span class=p>)</span>
        <span class=n>until</span><span class=p>[</span><span class=n>counts</span><span class=o>.</span><span class=n>eq</span><span class=p>(</span><span class=mi>0</span><span class=p>)]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>NA</span>
        <span class=n>features</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;steps_until_</span><span class=si>{</span><span class=n>cat</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>until</span>

    <span class=k>return</span> <span class=n>features</span>

<span class=n>steps_until</span><span class=p>(</span><span class=n>weather</span><span class=p>)</span>
</code></pre></div><table>
<thead>
<tr>
<th style=text-align:right>steps_until_rain</th>
<th style=text-align:right>steps_until_snow</th>
<th style=text-align:right>steps_until_sun</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:right>0</td>
<td style=text-align:right>2</td>
<td style=text-align:right>1</td>
</tr>
<tr>
<td style=text-align:right>5</td>
<td style=text-align:right>1</td>
<td style=text-align:right>0</td>
</tr>
<tr>
<td style=text-align:right>4</td>
<td style=text-align:right>0</td>
<td style=text-align:right>3</td>
</tr>
<tr>
<td style=text-align:right>3</td>
<td style=text-align:right>0</td>
<td style=text-align:right>2</td>
</tr>
<tr>
<td style=text-align:right>2</td>
<td style=text-align:right>0</td>
<td style=text-align:right>1</td>
</tr>
<tr>
<td style=text-align:right>1</td>
<td style=text-align:right>NA</td>
<td style=text-align:right>0</td>
</tr>
<tr>
<td style=text-align:right>0</td>
<td style=text-align:right>NA</td>
<td style=text-align:right>NA</td>
</tr>
<tr>
<td style=text-align:right>0</td>
<td style=text-align:right>NA</td>
<td style=text-align:right>NA</td>
</tr>
</tbody>
</table>
<h2 id=longest-event-streak>Longest event streak</h2>
<p>Next, take the following series of temperature measurements:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=n>temperature</span> <span class=o>=</span> <span class=p>[</span><span class=mi>18</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>NA</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>NA</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>NA</span><span class=p>,</span> <span class=mi>21</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>NA</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>NA</span><span class=p>,</span> <span class=mi>19</span><span class=p>]</span>
<span class=n>temperature</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>temperature</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;temperature&#39;</span><span class=p>)</span>
<span class=n>temperature</span>
</code></pre></div><table>
<thead>
<tr>
<th style=text-align:right>temperature</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:right>18</td>
</tr>
<tr>
<td style=text-align:right>NA</td>
</tr>
<tr>
<td style=text-align:right>NA</td>
</tr>
<tr>
<td style=text-align:right>NA</td>
</tr>
<tr>
<td style=text-align:right>21</td>
</tr>
<tr>
<td style=text-align:right>NA</td>
</tr>
<tr>
<td style=text-align:right>NA</td>
</tr>
<tr>
<td style=text-align:right>19</td>
</tr>
</tbody>
</table>
<p>In this case, you might want to <a href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.interpolate.html>interpolate</a> the missing values before feeding the data to a machine learning model. However, in order for your interpolation to be robust, you might want to verify that the maximum number of consecutive values isn&rsquo;t too large. You can calculate the latter as so:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=n>missing</span> <span class=o>=</span> <span class=n>temperature</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span>
<span class=n>missing</span><span class=o>.</span><span class=n>groupby</span><span class=p>((</span><span class=o>~</span><span class=n>missing</span><span class=p>)</span><span class=o>.</span><span class=n>cumsum</span><span class=p>())</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=o>.</span><span class=n>max</span><span class=p>()</span>
</code></pre></div><pre tabindex=0><code>3
</code></pre><p>Naturally, you can adapt this code to count consecutive values of arbitrary events. Indeed, the <code>missing</code> series definition could be replaced by a different condition altogether. For instance, we can determine the longest streak of rainy days like this:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=n>rainy</span> <span class=o>=</span> <span class=n>weather</span><span class=o>.</span><span class=n>eq</span><span class=p>(</span><span class=s1>&#39;rain&#39;</span><span class=p>)</span>
<span class=n>rainy</span><span class=o>.</span><span class=n>groupby</span><span class=p>((</span><span class=o>~</span><span class=n>rainy</span><span class=p>)</span><span class=o>.</span><span class=n>cumsum</span><span class=p>())</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=o>.</span><span class=n>max</span><span class=p>()</span>
</code></pre></div><pre tabindex=0><code>2
</code></pre><h2 id=target-encoding-for-time-series>Target encoding for time series</h2>
<p>The one thing I do in every time series competition is <a href=http://contrib.scikit-learn.org/category_encoders/targetencoder.html>target encoding</a>. In short, the goal of target encoding is to replace a category by the average of the target values of the rows that belong to said category. Naturally, you&rsquo;re not limited to using an average. You can also use <a href=https://maxhalford.github.io/blog/target-encoding/>Bayesian target encoding</a> if some of your categories are rare.</p>
<p>Target encoding is very important for time series data. It has been used in almost every top model on Kaggle time series competitions, such as <a href=https://www.kaggle.com/c/ashrae-energy-prediction>ASHRAE</a>, <a href=https://www.kaggle.com/c/recruit-restaurant-visitor-forecasting>Recruit Restaurants</a>, and <a href=https://www.kaggle.com/c/web-traffic-time-series-forecasting>Wikipedia Web Traffic</a>. When you do target encoding on temporal data, you need to be wary of not leaking current and future information into the aggregate of each row. Basically, you need to shift the target values within each group backwards. Indeed, for any given moment, we want our aggregate to pertain to past data only. As an example, consider the following toy dataset:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=n>readings</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span>
    <span class=p>[</span>
        <span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>,</span> <span class=s1>&#39;Saturday&#39;</span><span class=p>,</span> <span class=mi>101</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>,</span> <span class=s1>&#39;Sunday&#39;</span><span class=p>,</span> <span class=mi>88</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>,</span> <span class=s1>&#39;Saturday&#39;</span><span class=p>,</span> <span class=mi>103</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>,</span> <span class=s1>&#39;Sunday&#39;</span><span class=p>,</span> <span class=mi>82</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>,</span> <span class=s1>&#39;Saturday&#39;</span><span class=p>,</span> <span class=mi>100</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;B&#39;</span><span class=p>,</span> <span class=s1>&#39;Saturday&#39;</span><span class=p>,</span> <span class=mi>27</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;B&#39;</span><span class=p>,</span> <span class=s1>&#39;Sunday&#39;</span><span class=p>,</span> <span class=mi>13</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;B&#39;</span><span class=p>,</span> <span class=s1>&#39;Saturday&#39;</span><span class=p>,</span> <span class=mi>21</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;B&#39;</span><span class=p>,</span> <span class=s1>&#39;Sunday&#39;</span><span class=p>,</span> <span class=mi>17</span><span class=p>),</span>
        <span class=p>(</span><span class=s1>&#39;B&#39;</span><span class=p>,</span> <span class=s1>&#39;Saturday&#39;</span><span class=p>,</span> <span class=mi>25</span><span class=p>)</span>
    <span class=p>],</span>
    <span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;building&#39;</span><span class=p>,</span> <span class=s1>&#39;day&#39;</span><span class=p>,</span> <span class=s1>&#39;reading&#39;</span><span class=p>]</span>
<span class=p>)</span>
<span class=n>readings</span>
</code></pre></div><table>
<thead>
<tr>
<th style=text-align:left>building</th>
<th style=text-align:left>day</th>
<th style=text-align:right>reading</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>A</td>
<td style=text-align:left>Saturday</td>
<td style=text-align:right>101</td>
</tr>
<tr>
<td style=text-align:left>A</td>
<td style=text-align:left>Sunday</td>
<td style=text-align:right>88</td>
</tr>
<tr>
<td style=text-align:left>A</td>
<td style=text-align:left>Saturday</td>
<td style=text-align:right>103</td>
</tr>
<tr>
<td style=text-align:left>A</td>
<td style=text-align:left>Sunday</td>
<td style=text-align:right>82</td>
</tr>
<tr>
<td style=text-align:left>A</td>
<td style=text-align:left>Saturday</td>
<td style=text-align:right>100</td>
</tr>
<tr>
<td style=text-align:left>B</td>
<td style=text-align:left>Saturday</td>
<td style=text-align:right>27</td>
</tr>
<tr>
<td style=text-align:left>B</td>
<td style=text-align:left>Sunday</td>
<td style=text-align:right>13</td>
</tr>
<tr>
<td style=text-align:left>B</td>
<td style=text-align:left>Saturday</td>
<td style=text-align:right>21</td>
</tr>
<tr>
<td style=text-align:left>B</td>
<td style=text-align:left>Sunday</td>
<td style=text-align:right>17</td>
</tr>
<tr>
<td style=text-align:left>B</td>
<td style=text-align:left>Saturday</td>
<td style=text-align:right>25</td>
</tr>
</tbody>
</table>
<p>Let&rsquo;s say we want to calculate some target encodings for different column combinations. I like to define each target encoding as a tuple <code>(on, lag, by, how)</code> where:</p>
<ul>
<li><code>on</code> is the column on which to perform the aggregate.</li>
<li><code>lag</code> is the size of the window.</li>
<li><code>by</code> determines on which column to do the grouping.</li>
<li><code>how</code> indicates the statistics to compute.</li>
</ul>
<p>I then store all the tuples I want to compute in a list:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>AGGS</span> <span class=o>=</span> <span class=p>[</span>
    <span class=p>(</span><span class=s1>&#39;reading&#39;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;building&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;mean&#39;</span><span class=p>]),</span>
    <span class=p>(</span><span class=s1>&#39;reading&#39;</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;building&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;mean&#39;</span><span class=p>]),</span>
    <span class=p>(</span><span class=s1>&#39;reading&#39;</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;day&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;mean&#39;</span><span class=p>,</span> <span class=s1>&#39;max&#39;</span><span class=p>]),</span>
    <span class=p>(</span><span class=s1>&#39;reading&#39;</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;building&#39;</span><span class=p>,</span> <span class=s1>&#39;day&#39;</span><span class=p>],</span> <span class=p>[</span><span class=s1>&#39;mean&#39;</span><span class=p>])</span>
<span class=p>]</span>
</code></pre></div><p>I then proceed as follows:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=n>features</span> <span class=o>=</span> <span class=n>readings</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

<span class=k>for</span> <span class=n>on</span><span class=p>,</span> <span class=n>lag</span><span class=p>,</span> <span class=n>by</span><span class=p>,</span> <span class=n>hows</span> <span class=ow>in</span> <span class=n>AGGS</span><span class=p>:</span>

    <span class=n>agg</span> <span class=o>=</span> <span class=n>readings</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>by</span><span class=p>)[</span><span class=n>on</span><span class=p>]</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=p>(</span>
        <span class=n>x</span>
        <span class=o>.</span><span class=n>shift</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
        <span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=o>=</span><span class=n>lag</span><span class=p>,</span> <span class=n>min_periods</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
        <span class=o>.</span><span class=n>agg</span><span class=p>(</span><span class=n>hows</span><span class=p>)</span>
    <span class=p>))</span>
    <span class=n>agg</span> <span class=o>=</span> <span class=n>agg</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span>
        <span class=n>how</span><span class=p>:</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>how</span><span class=si>}</span><span class=s1>_of_last_</span><span class=si>{</span><span class=n>lag</span><span class=si>}</span><span class=s1>_</span><span class=si>{</span><span class=n>on</span><span class=si>}</span><span class=s1>_by_&#39;</span> <span class=o>+</span> <span class=s1>&#39;_and_&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>by</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>how</span> <span class=ow>in</span> <span class=n>hows</span>
    <span class=p>})</span>

    <span class=n>features</span> <span class=o>=</span> <span class=n>features</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>agg</span><span class=p>)</span>

<span class=n>features</span>
</code></pre></div><table>
<thead>
<tr>
<th style=text-align:left>building</th>
<th style=text-align:left>day</th>
<th style=text-align:right>reading</th>
<th style=text-align:right>mean_of_last_3_reading_by_building</th>
<th style=text-align:right>mean_of_last_3_reading_by_day</th>
<th style=text-align:right>max_of_last_3_reading_by_day</th>
<th style=text-align:right>mean_of_last_3_reading_by_building_and_day</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>A</td>
<td style=text-align:left>Saturday</td>
<td style=text-align:right>101</td>
<td style=text-align:right>nan</td>
<td style=text-align:right>nan</td>
<td style=text-align:right>nan</td>
<td style=text-align:right>nan</td>
</tr>
<tr>
<td style=text-align:left>A</td>
<td style=text-align:left>Sunday</td>
<td style=text-align:right>88</td>
<td style=text-align:right>101</td>
<td style=text-align:right>nan</td>
<td style=text-align:right>nan</td>
<td style=text-align:right>nan</td>
</tr>
<tr>
<td style=text-align:left>A</td>
<td style=text-align:left>Saturday</td>
<td style=text-align:right>103</td>
<td style=text-align:right>94.5</td>
<td style=text-align:right>101</td>
<td style=text-align:right>101</td>
<td style=text-align:right>101</td>
</tr>
<tr>
<td style=text-align:left>A</td>
<td style=text-align:left>Sunday</td>
<td style=text-align:right>82</td>
<td style=text-align:right>97.3333</td>
<td style=text-align:right>88</td>
<td style=text-align:right>88</td>
<td style=text-align:right>88</td>
</tr>
<tr>
<td style=text-align:left>A</td>
<td style=text-align:left>Saturday</td>
<td style=text-align:right>100</td>
<td style=text-align:right>91</td>
<td style=text-align:right>102</td>
<td style=text-align:right>103</td>
<td style=text-align:right>102</td>
</tr>
<tr>
<td style=text-align:left>B</td>
<td style=text-align:left>Saturday</td>
<td style=text-align:right>27</td>
<td style=text-align:right>nan</td>
<td style=text-align:right>101.333</td>
<td style=text-align:right>103</td>
<td style=text-align:right>nan</td>
</tr>
<tr>
<td style=text-align:left>B</td>
<td style=text-align:left>Sunday</td>
<td style=text-align:right>13</td>
<td style=text-align:right>27</td>
<td style=text-align:right>85</td>
<td style=text-align:right>88</td>
<td style=text-align:right>nan</td>
</tr>
<tr>
<td style=text-align:left>B</td>
<td style=text-align:left>Saturday</td>
<td style=text-align:right>21</td>
<td style=text-align:right>20</td>
<td style=text-align:right>76.6667</td>
<td style=text-align:right>103</td>
<td style=text-align:right>27</td>
</tr>
<tr>
<td style=text-align:left>B</td>
<td style=text-align:left>Sunday</td>
<td style=text-align:right>17</td>
<td style=text-align:right>20.3333</td>
<td style=text-align:right>61</td>
<td style=text-align:right>88</td>
<td style=text-align:right>13</td>
</tr>
<tr>
<td style=text-align:left>B</td>
<td style=text-align:left>Saturday</td>
<td style=text-align:right>25</td>
<td style=text-align:right>17</td>
<td style=text-align:right>49.3333</td>
<td style=text-align:right>100</td>
<td style=text-align:right>24</td>
</tr>
</tbody>
</table>
<p>Note that I have set <code>min_periods</code> to 1 so that statistics are still computed when there are less than <code>lag</code> values in a given window. As you can see, the <code>nan</code>s are present when there are no past values to aggregate on.</p>
<p>When I do a Kaggle competition, I run the above code on a small subset of the data and manually check that it&rsquo;s doing what I want it to do. This is akin to <a href=https://www.wikiwand.com/en/Pointing_and_calling>pointing and calling</a>, which I highly recommend doing in any data science endeavour whatsoever.</p>
<p>You might have noticed that I used <code>apply</code> to shift the values backwards before aggregating. Since version <code>1.0</code>, it&rsquo;s also possible to define a custom window that does the shifting for us. This may be done by subclassing <code>pd.api.indexers.BaseIndexer</code>:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>

<span class=k>class</span> <span class=nc>ShiftedWindow</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>indexers</span><span class=o>.</span><span class=n>BaseIndexer</span><span class=p>):</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>window_size</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>window_size</span> <span class=o>=</span> <span class=n>window_size</span>

    <span class=k>def</span> <span class=nf>get_window_bounds</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>num_values</span><span class=p>,</span> <span class=n>min_periods</span><span class=p>,</span> <span class=n>center</span><span class=p>,</span> <span class=n>closed</span><span class=p>):</span>

        <span class=n>starts</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>window_size</span><span class=p>,</span> <span class=n>num_values</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>window_size</span><span class=p>)</span>
        <span class=n>ends</span> <span class=o>=</span> <span class=n>starts</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>window_size</span>
        <span class=n>starts</span><span class=p>[:</span><span class=bp>self</span><span class=o>.</span><span class=n>window_size</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>

        <span class=k>return</span> <span class=n>starts</span><span class=p>,</span> <span class=n>ends</span>
</code></pre></div><p>This allows us to rewrite the above snippet as follows:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=n>features</span> <span class=o>=</span> <span class=n>readings</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>

<span class=k>for</span> <span class=n>on</span><span class=p>,</span> <span class=n>lag</span><span class=p>,</span> <span class=n>by</span><span class=p>,</span> <span class=n>hows</span> <span class=ow>in</span> <span class=n>AGGS</span><span class=p>:</span>

    <span class=n>agg</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>readings</span>
        <span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>by</span><span class=p>)[</span><span class=n>on</span><span class=p>]</span>
        <span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>ShiftedWindow</span><span class=p>(</span><span class=n>lag</span><span class=p>),</span> <span class=n>min_periods</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
        <span class=o>.</span><span class=n>agg</span><span class=p>(</span><span class=n>hows</span><span class=p>)</span>
    <span class=p>)</span>
    <span class=n>agg</span> <span class=o>=</span> <span class=n>agg</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span>
        <span class=n>how</span><span class=p>:</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>how</span><span class=si>}</span><span class=s1>_of_last_</span><span class=si>{</span><span class=n>lag</span><span class=si>}</span><span class=s1>_</span><span class=si>{</span><span class=n>on</span><span class=si>}</span><span class=s1>_by_&#39;</span> <span class=o>+</span> <span class=s1>&#39;_and_&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>by</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>how</span> <span class=ow>in</span> <span class=n>hows</span>
    <span class=p>})</span>

    <span class=n>features</span> <span class=o>=</span> <span class=n>features</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>agg</span><span class=p>)</span>
</code></pre></div><p>However, <a href=https://github.com/pandas-dev/pandas/issues/35755#issuecomment-674584559>it turns out</a> that custom windows within a <code>groupby</code> will only work once version <code>1.1.1</code> is released. As of writing this blog post, the above code will not produce the expected output, even though it won&rsquo;t raise any exception. But if you&rsquo;re reading from the near future, then it will work!</p>
<p>That&rsquo;s all for now! I purposefully didn&rsquo;t go into the detail of each line of code. I rather expect people to copy/paste the above snippets to (hopefully) play around with them by themselves. Feel free to drop a comment if you have any question whatsoever.</p>
</div>
<script type=text/javascript>var s=document.createElement('script');s.setAttribute('src','https://utteranc.es/client.js'),s.setAttribute('repo','MaxHalford/maxhalford.github.io'),s.setAttribute('issue-term','pathname'),s.setAttribute('crossorigin','anonymous'),s.setAttribute('async',null),s.setAttribute('theme','github-light'),document.body.appendChild(s)</script>
<div class=footer>
<div class=do-the-thing>
<div class=elevator><svg class="sweet-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" enable-background="new 0 0 100 100" height="100" width="100"><path d="M70 47.5H30c-1.4.0-2.5 1.1-2.5 2.5v40c0 1.4 1.1 2.5 2.5 2.5h40c1.4.0 2.5-1.1 2.5-2.5V50C72.5 48.6 71.4 47.5 70 47.5zm-22.5 40h-5v-25h5v25zm10 0h-5v-25h5v25zm10 0h-5V60c0-1.4-1.1-2.5-2.5-2.5H40c-1.4.0-2.5 1.1-2.5 2.5v27.5h-5v-35h35v35z"/><path d="M50 42.5c1.4.0 2.5-1.1 2.5-2.5V16l5.7 5.7c.5.5 1.1.7 1.8.7s1.3-.2 1.8-.7c1-1 1-2.6.0-3.5l-10-10c-1-1-2.6-1-3.5.0l-10 10c-1 1-1 2.6.0 3.5 1 1 2.6 1 3.5.0l5.7-5.7v24c0 1.4 1.1 2.5 2.5 2.5z"/></svg>
Back to the top
</div>
</div>
</div>
<script src=https://cdnjs.cloudflare.com/ajax/libs/elevator.js/1.0.0/elevator.min.js></script>
<script>var elementButton=document.querySelector('.elevator'),elevator=new Elevator({element:elementButton,mainAudio:'/music/elevator.mp3',endAudio:'/music/ding.mp3'})</script>
<style>.down-arrow{font-size:120px;margin-top:90px;margin-bottom:90px;text-shadow:0 -20px #0c1f31,0 0 #c33329;color:transparent;-webkit-transform:scaleY(.8);-moz-transform:scaleY(.8);transform:scaleY(.8)}.elevator{text-align:center;cursor:pointer;width:140px;margin:auto}.elevator:hover{opacity:.7}.elevator svg{width:40px;height:40px;display:block;margin:auto;margin-bottom:5px}</style>
<div class=site-footer>
<div class=site-footer-item>
<a href=https://github.com/MaxHalford><span class=inline-svg><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path fill="currentcolor" d="M8 0C3.58.0.0 3.582.0 8c0 3.535 2.292 6.533 5.47 7.59.4.075.547-.172.547-.385.0-.19-.007-.693-.01-1.36-2.226.483-2.695-1.073-2.695-1.073-.364-.924-.89-1.17-.89-1.17-.725-.496.056-.486.056-.486.803.056 1.225.824 1.225.824.714 1.223 1.873.87 2.33.665.072-.517.278-.87.507-1.07-1.777-.2-3.644-.888-3.644-3.953.0-.873.31-1.587.823-2.147-.09-.202-.36-1.015.07-2.117.0.0.67-.215 2.2.82.64-.178 1.32-.266 2-.27.68.004 1.36.092 2 .27 1.52-1.035 2.19-.82 2.19-.82.43 1.102.16 1.915.08 2.117.51.56.82 1.274.82 2.147.0 3.073-1.87 3.75-3.65 3.947.28.24.54.73.54 1.48.0 1.07-.01 1.93-.01 2.19.0.21.14.46.55.38C13.71 14.53 16 11.53 16 8c0-4.418-3.582-8-8-8"/></svg>
</span>
</a>
</div>
<div class=site-footer-item>
<a href=https://linkedin.com/in/maxhalford><span class=inline-svg><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path fill="currentcolor" d="M13.632 13.635h-2.37V9.922c0-.886-.018-2.025-1.234-2.025-1.235.0-1.424.964-1.424 1.96v3.778h-2.37V6H8.51v1.04h.03c.318-.6 1.092-1.233 2.247-1.233 2.4.0 2.845 1.58 2.845 3.637v4.188zM3.558 4.955c-.762.0-1.376-.617-1.376-1.377.0-.758.614-1.375 1.376-1.375.76.0 1.376.617 1.376 1.375.0.76-.617 1.377-1.376 1.377zm1.188 8.68H2.37V6h2.376v7.635zM14.816.0H1.18C.528.0.0.516.0 1.153v13.694C0 15.484.528 16 1.18 16h13.635c.652.0 1.185-.516 1.185-1.153V1.153C16 .516 15.467.0 14.815.0z" fill-rule="nonzero"/></svg>
</span>
</a>
</div>
<div class=site-footer-item>
<a href=https://twitter.com/halford_max><span class=inline-svg><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path fill="currentcolor" d="M16 3.038c-.59.26-1.22.437-1.885.517.677-.407 1.198-1.05 1.443-1.816-.634.37-1.337.64-2.085.79-.598-.64-1.45-1.04-2.396-1.04-1.812.0-3.282 1.47-3.282 3.28.0.26.03.51.085.75-2.728-.13-5.147-1.44-6.766-3.42C.83 2.58.67 3.14.67 3.75c0 1.14.58 2.143 1.46 2.732-.538-.017-1.045-.165-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.22-.276.074-.566.114-.865.114-.21.0-.41-.02-.61-.058.42 1.304 1.63 2.253 3.07 2.28-1.12.88-2.54 1.404-4.07 1.404-.26.0-.52-.015-.78-.045 1.46.93 3.18 1.474 5.04 1.474 6.04.0 9.34-5 9.34-9.33.0-.14.0-.28-.01-.42.64-.46 1.2-1.04 1.64-1.7z" fill-rule="nonzero"/></svg>
</span>
</a>
</div>
<div class=site-footer-item>
<a href=https://kaggle.com/maxhalford><span class=inline-svg><svg role="img" viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg"><title>Kaggle icon</title><path fill="currentcolor" d="M18.825 23.859c-.022.092-.117.141-.281.141h-3.139c-.187.0-.351-.082-.492-.248l-5.178-6.589-1.448 1.374v5.111c0 .235-.117.352-.351.352H5.505c-.236.0-.354-.117-.354-.352V.353c0-.233.118-.353.354-.353h2.431c.234.0.351.12.351.353v14.343l6.203-6.272c.165-.165.33-.246.495-.246h3.239c.144.0.236.06.285.18.046.149.034.255-.036.315l-6.555 6.344 6.836 8.507c.095.104.117.208.07.358"/></svg>
</span>
</a>
</div>
<div class=site-footer-item>
<a href="https://scholar.google.com/citations?user=erRNNi0AAAAJ&hl=en"><span class=inline-svg><svg viewBox="0 0 1755 1755" xmlns="http://www.w3.org/2000/svg"><path fill="currentcolor" transform="translate(0 1610) scale(1 -1)" d="M896.76 1130.189c-27.618 30.838-59.618 46.19-95.802 46.19-40.952.0-72.382-14.738-94.288-44.15-21.906-29.322-32.864-64.848-32.864-106.584.0-35.548 5.998-71.738 18-108.64 11.958-36.886 31.524-69.814 58.954-98.838 27.334-29.096 59.144-43.616 95.284-43.616 40.288.0 71.76 13.502 94.332 40.492 22.476 26.954 33.756 60.98 33.756 101.962.0 34.904-5.954 71.454-17.906 109.664-11.894 38.262-31.752 72.784-59.466 103.52zm762.098 382.384c-64.358 64.424-141.86 96.57-232.572 96.57H329.144c-90.712.0-168.14-32.146-232.572-96.57-64.424-64.286-96.57-141.86-96.57-232.572V182.859c0-90.712 32.146-168.288 96.57-232.712 64.432-64.146 142-96.432 232.572-96.432h1097.142c90.712.0 168.214 32.286 232.572 96.57 64.432 64.432 96.644 141.86 96.644 232.572v1097.142c0 90.712-32.22 168.288-96.644 232.572zM1297.81 1154.159V762.033c0-18.154-14.856-33.016-33.016-33.016h-12.156c-18.162.0-33.016 14.856-33.016 33.016v392.126c0 16.12-2.34 29.578 20.188 32.41v52.172l-173.43-142.24c2.004-3.716 3.906-6.092 5.712-9.208 15.242-26.976 23.004-60.526 23.004-101.53.0-31.43-5.238-59.662-15.858-84.598-10.57-24.928-23.428-45.29-38.43-60.972-15.002-15.74-30.048-30.128-45.092-43.074-15.046-12.976-27.904-26.506-38.436-40.55-10.614-14-15.894-28.474-15.894-43.476.0-15.024 6.854-30.288 20.524-45.67 13.62-15.426 30.376-30.376 50.19-45.144 19.85-14.666 39.658-30.946 59.472-48.662 19.858-17.694 36.52-40.456 50.14-68.096 13.722-27.744 20.568-58.288 20.568-91.86.0-44.288-11.294-84.282-33.806-119.882-22.58-35.446-51.998-63.73-88.144-84.472-36.242-20.882-75-36.6-116.334-47.214-41.42-10.518-82.52-15.806-123.568-15.806-25.908.0-52.048 1.996-78.336 6.1-26.382 4.096-52.81 11.33-79.426 21.526-26.668 10.262-50.286 22.864-70.758 37.998-20.524 14.98-37.046 34.312-49.716 57.856-12.668 23.552-18.958 50.022-18.958 79.426.0 34.882 9.714 67.24 29.192 97.404 19.478 29.944 45.282 54.952 77.378 74.76 55.998 34.838 143.858 56.364 263.432 64.498-27.334 34.172-41.048 66.334-41.048 96.432.0 17.122 4.476 35.474 13.334 55.288-14.284-1.996-28.994-3.124-44.002-3.124-64.234.0-118.476 20.882-162.524 62.932-44.046 41.976-66.048 94.522-66.048 158.048.0 6.642.19 12.492.672 18.974H292.574l393.618 342.17h651.856l-60.24-47.024v-82.996c22.368-2.874 20.004-16.318 20.004-32.394zM900.382 544.929c-7.52 1.36-18.088 2.122-31.708 2.122-29.382.0-58.288-2.596-86.666-7.782-28.38-5.046-56.378-13.568-83.998-25.592-27.722-11.952-50.096-29.528-67.146-52.766-17.144-23.208-25.666-50.542-25.666-81.994.0-29.974 7.52-56.714 22.572-80.004 15.002-23.142 34.808-41.26 59.428-54.236 24.62-12.998 50.432-22.814 77.378-29.264 26.998-6.408 54.476-9.736 82.476-9.736 55.376.0 103.05 12.47 143.046 37.406 39.906 24.928 59.904 63.422 59.904 115.382.0 10.928-1.522 21.686-4.528 32.19-3.138 10.62-6.24 19.712-9.282 27.26-3.05 7.41-8.858 16.332-17.43 26.616-8.522 10.314-15.046 17.934-19.434 23.004-4.476 5.238-12.852 12.712-25.19 22.594-12.236 9.926-20.048 16.114-23.522 18.402-3.43 2.406-12.332 8.908-26.668 19.456-14.328 10.634-22.184 16.274-23.566 16.94z"/></svg>
</span>
</a>
</div>
<div class=site-footer-item>
<a href=/files/resume_max_halford.pdf><span class=inline-svg><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 392.533 392.533" style="enable-background:new 0 0 392.533 392.533"><g><g><path fill="currentcolor" d="M292.396 324.849H99.879c-6.012.0-10.925 4.848-10.925 10.925.0 6.012 4.849 10.925 10.925 10.925h192.582c6.012.0 10.925-4.849 10.925-10.925C303.321 329.697 298.473 324.849 292.396 324.849z"/></g></g><g><g><path fill="currentcolor" d="M292.396 277.01H99.879c-6.012.0-10.925 4.848-10.925 10.925.0 6.012 4.849 10.925 10.925 10.925h192.582c6.012.0 10.925-4.849 10.925-10.925C303.321 281.859 298.473 277.01 292.396 277.01z"/></g></g><g><g><path fill="currentcolor" d="M196.137 45.834c-25.859.0-46.998 21.075-46.998 46.998.0 25.859 21.139 46.933 46.998 46.933s46.998-21.075 46.998-46.998-21.139-46.933-46.998-46.933zm0 72.017c-13.77.0-25.083-11.313-25.083-25.083s11.248-25.083 25.083-25.083 25.083 11.313 25.083 25.083c0 13.769-11.313 25.083-25.083 25.083z"/></g></g><g><g><path fill="currentcolor" d="M258.521 163.362c-39.887-15.515-84.752-15.515-124.638.0-13.059 5.107-21.786 18.101-21.786 32.388v44.347c-.065 6.012 4.849 10.925 10.861 10.925h146.424c6.012.0 10.925-4.848 10.925-10.925V195.75C280.307 181.463 271.58 168.469 258.521 163.362zm0 65.874H133.883v-33.422c0-5.301 3.168-10.214 7.887-12.024 34.844-13.511 74.02-13.511 108.865.0 4.719 1.875 7.887 6.659 7.887 12.024v33.422z"/></g></g><g><g><path fill="currentcolor" d="M313.083.0H131.491c-8.404.0-16.291 3.232-22.238 9.18L57.018 61.414c-5.947 5.948-9.18 13.834-9.18 22.238v277.333c0 17.39 14.158 31.547 31.547 31.547h233.762c17.39.0 31.547-14.158 31.547-31.547V31.547C344.501 14.158 330.343.0 313.083.0zM112.032 37.236v27.022H85.01l27.022-27.022zm210.683 79.58h-40.598c-6.012.0-10.925 4.849-10.925 10.925.0 6.012 4.848 10.925 10.925 10.925h40.598v19.394h-14.869c-6.012.0-10.925 4.848-10.925 10.925.0 6.012 4.849 10.925 10.925 10.925h14.869v181.139c0 5.366-4.331 9.697-9.632 9.697H79.192c-5.301.0-9.632-4.331-9.632-9.632V86.044h53.398c6.012.0 10.925-4.848 10.925-10.925V21.721h179.2c5.301.0 9.632 4.331 9.632 9.632v85.463z"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg>
</span>
</a>
</div>
<div class=site-footer-item>
<a href=https://play.spotify.com/user/1166811350><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 168 168"><path fill="currentcolor" d="m83.996.277C37.747.277.253 37.77.253 84.019c0 46.251 37.494 83.741 83.743 83.741 46.254.0 83.744-37.49 83.744-83.741.0-46.246-37.49-83.738-83.745-83.738l.001-.004zm38.404 120.78c-1.5 2.46-4.72 3.24-7.18 1.73-19.662-12.01-44.414-14.73-73.564-8.07-2.809.64-5.609-1.12-6.249-3.93-.643-2.81 1.11-5.61 3.926-6.25 31.9-7.291 59.263-4.15 81.337 9.34 2.46 1.51 3.24 4.72 1.73 7.18zm10.25-22.805c-1.89 3.075-5.91 4.045-8.98 2.155-22.51-13.839-56.823-17.846-83.448-9.764-3.453 1.043-7.1-.903-8.148-4.35-1.04-3.453.907-7.093 4.354-8.143 30.413-9.228 68.222-4.758 94.072 11.127 3.07 1.89 4.04 5.91 2.15 8.976v-.001zm.88-23.744c-26.99-16.031-71.52-17.505-97.289-9.684-4.138 1.255-8.514-1.081-9.768-5.219-1.254-4.14 1.08-8.513 5.221-9.771 29.581-8.98 78.756-7.245 109.83 11.202 3.73 2.209 4.95 7.016 2.74 10.733-2.2 3.722-7.02 4.949-10.73 2.739z"/></svg>
</span>
</a>
</div>
<div class=site-footer-item>
<a href=mailto:maxhalford25@gmail.com><span class=inline-svg><svg viewBox="0 0 15 20" xmlns="http://www.w3.org/2000/svg"><title>mail</title><path fill="currentcolor" d="M0 4v8c0 .55.45 1 1 1h12c.55.0 1-.45 1-1V4c0-.55-.45-1-1-1H1c-.55.0-1 .45-1 1zm13 0L7 9 1 4h12zM1 5.5l4 3-4 3v-6zM2 12l3.5-3L7 10.5 8.5 9l3.5 3H2zm11-.5-4-3 4-3v6z" fill="#000" fill-rule="evenodd"/></svg>
</span>
</a>
</div>
<div class=site-footer-item>
<a href=/index.xml><span class=inline-svg><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path fill="currentcolor" d="M12.8 16C12.8 8.978 7.022 3.2.0 3.2V0c8.777.0 16 7.223 16 16h-3.2zM2.194 11.61c1.21.0 2.195.985 2.195 2.196.0 1.21-.99 2.194-2.2 2.194C.98 16 0 15.017.0 13.806c0-1.21.983-2.195 2.194-2.195zM10.606 16h-3.11c0-4.113-3.383-7.497-7.496-7.497v-3.11c5.818.0 10.606 4.79 10.606 10.607z"/></svg>
</span>
</a>
</div>
</div>
<div style=margin-bottom:80px;display:flex;justify-content:center>
<iframe src=https://github.com/sponsors/MaxHalford/button title="Sponsor MaxHalford" height=35 width=116 style=border:0></iframe>
</div>
</div>
</div>
</article>
<script></script>
</body>
</html>