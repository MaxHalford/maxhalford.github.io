<!doctype html><html lang=en><head><script defer src=https://unpkg.com/@tinybirdco/flock.js data-host=https://api.tinybird.co data-token=p.eyJ1IjogImMwMjJhMjg1LWJmY2YtNDc0OC1hYzczLTJhMDQ1Njk3NTI0YyIsICJpZCI6ICIzNjc3NjQ3Ny04MTE2LTRmYWQtYjcwMy1iZmM3YjMwZGJjMjMifQ.A0vHm-VWbXG6uBFZiwuspN_AyfSYNrdZE3IgwgWSt4g></script><meta charset=utf-8><meta name=generator content="Hugo 0.112.7"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Max Halford"><meta property="og:url" content="https://maxhalford.github.io/blog/sql-cross-correlations/"><link rel=canonical href=https://maxhalford.github.io/blog/sql-cross-correlations/><meta property="og:title" content="Computing cross-correlations in SQL"><meta property="og:description" content="Introduction I&rsquo;m currently working on a problem at work where I have to measure the impact of a growth initiative on a performance metric. Hypothetically, this might to answer the following kind of question:
I&rsquo;ve spent X amount of money, what is the impact on the number of visitors on my website?
Of course, there are many measures that can be taken to answer such a question. I decided to measure the correlation between the initiative and the metric, with the latter being shifted forward in time."><meta property="og:type" content="article"><meta property="og:url" content="https://maxhalford.github.io/blog/sql-cross-correlations/"><meta property="og:image" content="https://maxhalford.github.io/img/beach.jpg"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-11-17T00:00:00+00:00"><meta property="article:modified_time" content="2020-11-17T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://maxhalford.github.io/img/beach.jpg"><meta name=twitter:title content="Computing cross-correlations in SQL"><meta name=twitter:description content="Introduction I&rsquo;m currently working on a problem at work where I have to measure the impact of a growth initiative on a performance metric. Hypothetically, this might to answer the following kind of question:
I&rsquo;ve spent X amount of money, what is the impact on the number of visitors on my website?
Of course, there are many measures that can be taken to answer such a question. I decided to measure the correlation between the initiative and the metric, with the latter being shifted forward in time."><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ¦”</text></svg>"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/maxhalford.github.io\/"},"articleSection":"blog","name":"Computing cross-correlations in SQL","headline":"Computing cross-correlations in SQL","description":"Introduction I\u0026rsquo;m currently working on a problem at work where I have to measure the impact of a growth initiative on a performance metric. Hypothetically, this might to answer the following kind of question:\nI\u0026rsquo;ve spent X amount of money, what is the impact on the number of visitors on my website?\nOf course, there are many measures that can be taken to answer such a question. I decided to measure the correlation between the initiative and the metric, with the latter being shifted forward in time.","inLanguage":"en-US","author":"Max Halford","creator":"Max Halford","publisher":"Max Halford","accountablePerson":"Max Halford","copyrightHolder":"Max Halford","copyrightYear":"2020","datePublished":"2020-11-17 00:00:00 \u002b0000 UTC","dateModified":"2020-11-17 00:00:00 \u002b0000 UTC","url":"https:\/\/maxhalford.github.io\/blog\/sql-cross-correlations\/","keywords":["sql"]}</script><title>Computing cross-correlations in SQL â€¢ Max Halford</title><meta property="og:title" content="Computing cross-correlations in SQL â€¢ Max Halford"><meta property="og:type" content="article"><meta name=description content="Introduction I&rsquo;m currently working on a problem at work where I have to measure the impact of a growth initiative on a performance metric. Hypothetically, this might to answer the following kind of question:
I&rsquo;ve spent X amount of money, what is the impact on the number of visitors on my website?
Of course, there are many measures that can be taken to answer such a question. I decided to measure the correlation between the initiative and the metric, with the latter being shifted forward in time."><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.css><link rel=stylesheet href=/css/github-markdown.min.css><link rel=stylesheet href=/css/highlight/github.css><link rel=stylesheet href=/css/index.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&family=Permanent+Marker&display=swap" rel=stylesheet><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0,tags:"ams"},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body><article class=post id=article><div class="row center-xs" style=text-align:left><div class="col-xs-12 col-sm-10 col-md-7 col-lg-5"><div class=header><header class=header-parts><div class="signatures site-title"><a href=/>Max Halford ãƒ„</a></div><div class=header-links><a class=header-link href=/>Blog</a>
<a class=header-link href=/links/>Links</a>
<a class=header-link href=/bio/>Bio</a></div></header></div><header class=post-header><h1 class=post-title>Computing cross-correlations in SQL</h1><div class="row post-desc"><div class="col-xs-12 post-desc-items"><time class=post-date datetime="2020-11-17 00:00:00 UTC">2020-11-17</time>
<span class=posts-line-tag>sql</span></div></div></header><div class="post-content markdown-body"><h2 id=introduction>Introduction</h2><p>I&rsquo;m currently working on a problem at work where I have to measure the impact of a <span style=color:#6a5acd>growth initiative</span> on a <span style=color:#3cb371>performance metric</span>. Hypothetically, this might to answer the following kind of question:</p><blockquote><p>I&rsquo;ve spent <span style=color:#6a5acd>X amount of money</span>, what is the impact on the <span style=color:#3cb371>number of visitors on my website</span>?</p></blockquote><p>Of course, there are many measures that can be taken to answer such a question. I decided to measure the correlation between the <span style=color:#6a5acd>initiative</span> and the <span style=color:#3cb371>metric</span>, with the latter being shifted forward in time. This measure is called the <a href=https://www.wikiwand.com/en/Cross-correlation>cross-correlation</a>. It&rsquo;s different from <a href=https://www.wikiwand.com/en/Autocorrelation>serial correlation</a>, which is the correlation of a series with a shifted version of itself.</p><p>Computing the cross-correlation between two series of numbers $X$ and $Y$ is simple. Assuming that we want to measure the impact of $X$ on $Y$, we just have to shift $Y$ forward and compute the correlation between $X$ and the shifted version of $Y$. Of course, one has to decide by how much to shift $Y$. Ideally, we would like to measure the impact of $X$ on multiple shifted versions of $Y$. Indeed, we might want to know how increasing $X$ affects $Y$ in one week, two weeks, three weeks, etc.</p><h2 id=cross-correlation-for-two-variables>Cross-correlation for two variables</h2><p>I&rsquo;m going to be using PostgreSQL 12.3. I&rsquo;m be using a fair amount of <a href=https://www.postgresql.org/docs/9.1/queries-with.html>common table expressions</a> in order to clarify the steps to take. First, let&rsquo;s pick some dummy data:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>WITH</span><span class=w> </span><span class=n>dummy</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>VALUES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-01&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-02&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-03&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>50</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-04&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mi>1000</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-05&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>dummy</span><span class=w> </span><span class=p>(</span><span class=nb>date</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>As mentioned, we would like our code to work for an arbitrary number of steps forward. Therefore, let&rsquo;s define a range of delta values by which will be used to shift <code>Y</code> forward:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>,</span><span class=w> </span><span class=n>delta</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>generate_series</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>)</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>Now let&rsquo;s add the deltas to the <code>date</code> field in order to define the future dates:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>,</span><span class=w> </span><span class=n>dates</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>date</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>present</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>date</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>delta</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=s1>&#39;1 day&#39;</span><span class=p>::</span><span class=nb>interval</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>future</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>dummy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>CROSS</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>dates</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>8</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>present</span><span class=w>     </span><span class=n>delta</span><span class=w>   </span><span class=n>future</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span><span class=w>  </span><span class=mi>1</span><span class=w>       </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>02</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>02</span><span class=w>  </span><span class=mi>1</span><span class=w>       </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>03</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>03</span><span class=w>  </span><span class=mi>1</span><span class=w>       </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>04</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>04</span><span class=w>  </span><span class=mi>1</span><span class=w>       </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>05</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>05</span><span class=w>  </span><span class=mi>1</span><span class=w>       </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>06</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span><span class=w>  </span><span class=mi>2</span><span class=w>       </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>03</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>02</span><span class=w>  </span><span class=mi>2</span><span class=w>       </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>04</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>03</span><span class=w>  </span><span class=mi>2</span><span class=w>       </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>05</span><span class=w>
</span></span></span></code></pre></div><p>We can now join the dates with the values from the initial table:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>,</span><span class=w> </span><span class=n>pairwise</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dates</span><span class=p>.</span><span class=n>present</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dates</span><span class=p>.</span><span class=n>future</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dates</span><span class=p>.</span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>present</span><span class=p>.</span><span class=n>x</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>present_x</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>future</span><span class=p>.</span><span class=n>y</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>future_y</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dates</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dummy</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>present</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dummy</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>future</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=n>dates</span><span class=p>.</span><span class=n>present</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>present</span><span class=p>.</span><span class=nb>date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>AND</span><span class=w> </span><span class=n>dates</span><span class=p>.</span><span class=n>future</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>future</span><span class=p>.</span><span class=nb>date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>pairwise</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>present</span><span class=p>,</span><span class=w> </span><span class=n>delta</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>present</span><span class=w>     </span><span class=n>future</span><span class=w>      </span><span class=n>delta</span><span class=w>   </span><span class=n>present_x</span><span class=w>   </span><span class=n>future_y</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span><span class=w>  </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>02</span><span class=w>  </span><span class=mi>1</span><span class=w>       </span><span class=mi>1</span><span class=w>           </span><span class=mi>20</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span><span class=w>  </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>03</span><span class=w>  </span><span class=mi>2</span><span class=w>       </span><span class=mi>1</span><span class=w>           </span><span class=mi>50</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span><span class=w>  </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>04</span><span class=w>  </span><span class=mi>3</span><span class=w>       </span><span class=mi>1</span><span class=w>           </span><span class=o>-</span><span class=mi>1000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>02</span><span class=w>  </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>03</span><span class=w>  </span><span class=mi>1</span><span class=w>       </span><span class=mi>2</span><span class=w>           </span><span class=mi>50</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>02</span><span class=w>  </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>04</span><span class=w>  </span><span class=mi>2</span><span class=w>       </span><span class=mi>2</span><span class=w>           </span><span class=o>-</span><span class=mi>1000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>02</span><span class=w>  </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>05</span><span class=w>  </span><span class=mi>3</span><span class=w>       </span><span class=mi>2</span><span class=w>           </span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>03</span><span class=w>  </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>04</span><span class=w>  </span><span class=mi>1</span><span class=w>       </span><span class=mi>3</span><span class=w>           </span><span class=o>-</span><span class=mi>1000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>03</span><span class=w>  </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>05</span><span class=w>  </span><span class=mi>2</span><span class=w>       </span><span class=mi>3</span><span class=w>           </span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>04</span><span class=w>  </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>05</span><span class=w>  </span><span class=mi>1</span><span class=w>       </span><span class=mi>0</span><span class=w>           </span><span class=mi>0</span><span class=w>
</span></span></span></code></pre></div><p>Finally, we just have to compute the correlation within each group. The groups are defined by the <code>delta</code> field. In other words, we will compute the correlation for all values that match $(X_t, Y_{t+1})$, $(X_t, Y_{t+2})$, and $(X_t, Y_{t+3})$.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>,</span><span class=w> </span><span class=n>cross_corrs</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CORR</span><span class=p>(</span><span class=n>present_x</span><span class=p>,</span><span class=w> </span><span class=n>future_y</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>pearson</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>pairwise</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>cross_corrs</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>delta</span><span class=w>   </span><span class=n>pearson</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=w>       </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>7487619679833206</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2</span><span class=w>       </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>042207495591251455</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3</span><span class=w>       </span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></div><p>That&rsquo;s it, we&rsquo;re done. You can click on the toggle below if you want to copy/paste the full example.</p><details><summary>Click to see the full example</summary><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>WITH</span><span class=w> </span><span class=n>dummy</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>VALUES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-01&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-02&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-03&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>50</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-04&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mi>1000</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-05&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>dummy</span><span class=w> </span><span class=p>(</span><span class=nb>date</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>delta</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>generate_series</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>)</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>dates</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>date</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>present</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>date</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>delta</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=s1>&#39;1 day&#39;</span><span class=p>::</span><span class=nb>interval</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>future</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>dummy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>CROSS</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>pairwise</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dates</span><span class=p>.</span><span class=n>present</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dates</span><span class=p>.</span><span class=n>future</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dates</span><span class=p>.</span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>present</span><span class=p>.</span><span class=n>x</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>present_x</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>future</span><span class=p>.</span><span class=n>y</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>future_y</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dates</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dummy</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>present</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dummy</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>future</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=n>dates</span><span class=p>.</span><span class=n>present</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>present</span><span class=p>.</span><span class=nb>date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>AND</span><span class=w> </span><span class=n>dates</span><span class=p>.</span><span class=n>future</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>future</span><span class=p>.</span><span class=nb>date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>cross_corrs</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CORR</span><span class=p>(</span><span class=n>present_x</span><span class=p>,</span><span class=w> </span><span class=n>future_y</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>pearson</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>pairwise</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>cross_corrs</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div></details><h2 id=different-kinds-of-correlations>Different kinds of correlations</h2><p>Up until now, I&rsquo;ve been making the common assumption that &ldquo;correlation&rdquo; refers to the <a href=https://www.wikiwand.com/en/Pearson_correlation_coefficient>Pearson correlation</a>. There are other kinds of correlations, such as <a href=https://www.wikiwand.com/en/Spearman%27s_rank_correlation_coefficient>Spearman&rsquo;s rank correlation</a>. The latter is not available in PostgreSQL 12.3, but it is easy to calculate, as it is just the Pearson correlation of the ranks of the values of $X$ and $Y$. In SQL, this translates to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>RANK</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>x</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>x_rank</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>RANK</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>y</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>y_rank</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>dummy</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>0</span><span class=p>.</span><span class=mi>9</span><span class=w>
</span></span></span></code></pre></div><p>Ideally, we would like to calculate both kinds of correlations (Pearson and Spearman) for each delta value. This is quite straightforward to do, albeit slightly verbose.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>WITH</span><span class=w> </span><span class=n>dummy</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>VALUES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-01&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-02&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>20</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-03&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>50</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-04&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mi>1000</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-05&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>dummy</span><span class=w> </span><span class=p>(</span><span class=nb>date</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>delta</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>generate_series</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>)</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>dates</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>date</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>present</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>date</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>delta</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=s1>&#39;1 day&#39;</span><span class=p>::</span><span class=nb>interval</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>future</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>dummy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>CROSS</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>pairwise</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dates</span><span class=p>.</span><span class=n>present</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dates</span><span class=p>.</span><span class=n>future</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dates</span><span class=p>.</span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>present</span><span class=p>.</span><span class=n>x</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>present_x</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>future</span><span class=p>.</span><span class=n>y</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>future_y</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dates</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dummy</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>present</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dummy</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>future</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=n>dates</span><span class=p>.</span><span class=n>present</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>present</span><span class=p>.</span><span class=nb>date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>AND</span><span class=w> </span><span class=n>dates</span><span class=p>.</span><span class=n>future</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>future</span><span class=p>.</span><span class=nb>date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>cross_corrs</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CORR</span><span class=p>(</span><span class=n>present_x</span><span class=p>,</span><span class=w> </span><span class=n>future_y</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>pearson</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>pairwise</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>pairwise_ranks</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    	</span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>RANK</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>present_x</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>present_x_rank</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>RANK</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>future_y</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>future_y_rank</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>pairwise</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>cross_rank_corrs</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CORR</span><span class=p>(</span><span class=n>present_x_rank</span><span class=p>,</span><span class=w> </span><span class=n>future_y_rank</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>spearman</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>pairwise_ranks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>corrs</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cc</span><span class=p>.</span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cc</span><span class=p>.</span><span class=n>pearson</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>crc</span><span class=p>.</span><span class=n>spearman</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>cross_corrs</span><span class=w> </span><span class=n>cc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>cross_rank_corrs</span><span class=w> </span><span class=n>crc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>ON</span><span class=w> </span><span class=n>cc</span><span class=p>.</span><span class=n>delta</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>crc</span><span class=p>.</span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>corrs</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>delta</span><span class=w>   </span><span class=n>pearson</span><span class=w>                 </span><span class=n>spearman</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=w>       </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>7487619679833206</span><span class=w>     </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2</span><span class=w>       </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>042207495591251455</span><span class=w>   </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3</span><span class=w>       </span><span class=mi>1</span><span class=w>                       </span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></div><h2 id=multiple-xs-and-ys>Multiple $X$s and $Y$s</h2><p>We now have a framework to compute different kinds of cross-correlations between two variables over multiple time steps. Let&rsquo;s push the envelope and make it so that can compute the cross-correlations for multiple variables. To be precise, we would like to compute cross-correlations between <span style=color:#6a5acd>a group of initiatives ($X$s)</span> and <span style=color:#3cb371>a group of metrics ($Y$s)</span>.</p><p>First of all, let&rsquo;s create some more dummy data. We&rsquo;ll also split the $X$s from the $Y$s. We&rsquo;re also going to <a href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.melt.html>melt</a> (or &ldquo;unpivot&rdquo; as some like to say) both groups. The reason why we do this is that it will simplify the subsequent code.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>WITH</span><span class=w> </span><span class=n>dummy</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>VALUES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-01&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=mi>15</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-02&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=mi>20</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-03&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>50</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mi>44</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-04&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mi>1000</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>(</span><span class=s1>&#39;2020-01-05&#39;</span><span class=p>::</span><span class=nb>DATE</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>14</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>dummy</span><span class=w> </span><span class=p>(</span><span class=nb>date</span><span class=p>,</span><span class=w> </span><span class=n>x1</span><span class=p>,</span><span class=w> </span><span class=n>x2</span><span class=p>,</span><span class=w> </span><span class=n>y1</span><span class=p>,</span><span class=w> </span><span class=n>y2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>xs</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>UNNEST</span><span class=p>(</span><span class=nb>ARRAY</span><span class=p>[</span><span class=s1>&#39;x1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;x2&#39;</span><span class=p>])</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>var</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>UNNEST</span><span class=p>(</span><span class=nb>ARRAY</span><span class=p>[</span><span class=n>x1</span><span class=p>,</span><span class=w> </span><span class=n>x2</span><span class=p>])</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>val</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>dummy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>ys</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>UNNEST</span><span class=p>(</span><span class=nb>ARRAY</span><span class=p>[</span><span class=s1>&#39;y1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;y2&#39;</span><span class=p>])</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>var</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>UNNEST</span><span class=p>(</span><span class=nb>ARRAY</span><span class=p>[</span><span class=n>y1</span><span class=p>,</span><span class=w> </span><span class=n>y2</span><span class=p>])</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>val</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>dummy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>xs</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=nb>date</span><span class=p>,</span><span class=w> </span><span class=n>var</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nb>date</span><span class=w>        </span><span class=n>var</span><span class=w>   </span><span class=n>val</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span><span class=w>  </span><span class=n>x1</span><span class=w>    </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span><span class=w>  </span><span class=n>x2</span><span class=w>    </span><span class=mi>4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>02</span><span class=w>  </span><span class=n>x1</span><span class=w>    </span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>02</span><span class=w>  </span><span class=n>x2</span><span class=w>    </span><span class=mi>8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>03</span><span class=w>  </span><span class=n>x1</span><span class=w>    </span><span class=mi>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>03</span><span class=w>  </span><span class=n>x2</span><span class=w>    </span><span class=o>-</span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>04</span><span class=w>  </span><span class=n>x1</span><span class=w>    </span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>04</span><span class=w>  </span><span class=n>x2</span><span class=w>    </span><span class=mi>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>05</span><span class=w>  </span><span class=n>x1</span><span class=w>    </span><span class=o>-</span><span class=mi>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>05</span><span class=w>  </span><span class=n>x2</span><span class=w>    </span><span class=mi>10</span><span class=w>
</span></span></span></code></pre></div><p>Note that this way of representing data agrees with the <a href=https://vita.had.co.nz/papers/tidy-data.pdf>Tidy Data</a> principles advocated by <a href=http://hadley.nz/>Hadley Wickam</a>. Essentially, flattening/melting a table eases the manipulation of said table.</p><p>Next, we&rsquo;re going to be generating future dates in the exact same way as we did previously.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>,</span><span class=w> </span><span class=n>delta</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>generate_series</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>)</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>dates</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>date</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>present</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>date</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>delta</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=s1>&#39;1 day&#39;</span><span class=p>::</span><span class=nb>interval</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>future</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>dummy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>CROSS</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>We do however need to change the definition of the <code>pairwise</code> CTE. It&rsquo;s quite straightforward as long as you&rsquo;re concentrating a minimum. Here goes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>,</span><span class=w> </span><span class=n>pairwise</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dates</span><span class=p>.</span><span class=n>present</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dates</span><span class=p>.</span><span class=n>future</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dates</span><span class=p>.</span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>xs</span><span class=p>.</span><span class=n>var</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>x_var</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>xs</span><span class=p>.</span><span class=n>val</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>x_val</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ys</span><span class=p>.</span><span class=n>var</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>y_var</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ys</span><span class=p>.</span><span class=n>val</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>y_val</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>dates</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>xs</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ys</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=n>dates</span><span class=p>.</span><span class=n>present</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>xs</span><span class=p>.</span><span class=nb>date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>AND</span><span class=w> </span><span class=n>dates</span><span class=p>.</span><span class=n>future</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ys</span><span class=p>.</span><span class=nb>date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>present</span><span class=p>,</span><span class=w> </span><span class=n>delta</span><span class=p>,</span><span class=w> </span><span class=n>x_var</span><span class=p>,</span><span class=w> </span><span class=n>y_var</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>pairwise</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>5</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>present</span><span class=w>     </span><span class=n>future</span><span class=w>       </span><span class=n>delta</span><span class=w>  </span><span class=n>x_var</span><span class=w> </span><span class=n>x_val</span><span class=w> </span><span class=n>y_var</span><span class=w>   </span><span class=n>y_val</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span><span class=w>  </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>02</span><span class=w>   </span><span class=mi>1</span><span class=w>      </span><span class=n>x1</span><span class=w>    </span><span class=mi>1</span><span class=w>     </span><span class=n>y1</span><span class=w>      </span><span class=mi>20</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span><span class=w>  </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>02</span><span class=w>   </span><span class=mi>1</span><span class=w>      </span><span class=n>x1</span><span class=w>    </span><span class=mi>1</span><span class=w>     </span><span class=n>y2</span><span class=w>      </span><span class=mi>12</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span><span class=w>  </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>02</span><span class=w>   </span><span class=mi>1</span><span class=w>      </span><span class=n>x2</span><span class=w>    </span><span class=mi>4</span><span class=w>     </span><span class=n>y1</span><span class=w>      </span><span class=mi>20</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span><span class=w>  </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>02</span><span class=w>   </span><span class=mi>1</span><span class=w>      </span><span class=n>x2</span><span class=w>    </span><span class=mi>4</span><span class=w>     </span><span class=n>y2</span><span class=w>      </span><span class=mi>12</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span><span class=w>  </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>03</span><span class=w>   </span><span class=mi>2</span><span class=w>      </span><span class=n>x1</span><span class=w>    </span><span class=mi>1</span><span class=w>     </span><span class=n>y1</span><span class=w>      </span><span class=mi>50</span><span class=w>
</span></span></span></code></pre></div><p>We can now compute all the correlations we want by grouping over <code>(delta, x_var, y_var)</code>. Again, this is still relatively simple as long as you proceed step by step:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>,</span><span class=w> </span><span class=n>cross_corrs</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>x_var</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y_var</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>y</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s1>&#39;pearson&#39;</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>kind</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CORR</span><span class=p>(</span><span class=n>x_val</span><span class=p>,</span><span class=w> </span><span class=n>y_val</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>correlation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>pairwise</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=p>,</span><span class=w> </span><span class=n>x_var</span><span class=p>,</span><span class=w> </span><span class=n>y_var</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>pairwise_ranks</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    	</span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    	</span><span class=n>x_var</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    	</span><span class=n>y_var</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>y</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>RANK</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=p>,</span><span class=w> </span><span class=n>x_var</span><span class=p>,</span><span class=w> </span><span class=n>y_var</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>x_val</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>x_rank</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>RANK</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=p>,</span><span class=w> </span><span class=n>x_var</span><span class=p>,</span><span class=w> </span><span class=n>y_var</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>y_val</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>y_rank</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>pairwise</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>cross_rank_corrs</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>x</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s1>&#39;spearman&#39;</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>kind</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CORR</span><span class=p>(</span><span class=n>x_rank</span><span class=p>,</span><span class=w> </span><span class=n>y_rank</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>correlation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>pairwise_ranks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>,</span><span class=w> </span><span class=n>corrs</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>cross_corrs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>UNION</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>cross_rank_corrs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>delta</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>,</span><span class=w> </span><span class=n>kind</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>corrs</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>delta</span><span class=w>   </span><span class=n>x</span><span class=w>   </span><span class=n>y</span><span class=w>        </span><span class=n>kind</span><span class=w>       </span><span class=n>correlation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=w>       </span><span class=n>x1</span><span class=w>  </span><span class=n>y1</span><span class=w>       </span><span class=n>pearson</span><span class=w>     </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>7487619679833206</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=w>       </span><span class=n>x1</span><span class=w>  </span><span class=n>y1</span><span class=w>       </span><span class=n>spearman</span><span class=w>    </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=w>       </span><span class=n>x1</span><span class=w>  </span><span class=n>y2</span><span class=w>       </span><span class=n>pearson</span><span class=w>     </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>2823436901242271</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=w>       </span><span class=n>x1</span><span class=w>  </span><span class=n>y2</span><span class=w>       </span><span class=n>spearman</span><span class=w>    </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>7181848464596079</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=w>       </span><span class=n>x2</span><span class=w>  </span><span class=n>y1</span><span class=w>       </span><span class=n>pearson</span><span class=w>     </span><span class=mi>0</span><span class=p>,</span><span class=mi>8708519999050144</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=w>       </span><span class=n>x2</span><span class=w>  </span><span class=n>y1</span><span class=w>       </span><span class=n>spearman</span><span class=w>    </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=w>       </span><span class=n>x2</span><span class=w>  </span><span class=n>y2</span><span class=w>       </span><span class=n>pearson</span><span class=w>     </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>7618694949404378</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=w>       </span><span class=n>x2</span><span class=w>  </span><span class=n>y2</span><span class=w>       </span><span class=n>spearman</span><span class=w>    </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>5129891760425771</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2</span><span class=w>       </span><span class=n>x1</span><span class=w>  </span><span class=n>y1</span><span class=w>       </span><span class=n>pearson</span><span class=w>     </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>042207495591251455</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2</span><span class=w>       </span><span class=n>x1</span><span class=w>  </span><span class=n>y1</span><span class=w>       </span><span class=n>spearman</span><span class=w>    </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2</span><span class=w>       </span><span class=n>x1</span><span class=w>  </span><span class=n>y2</span><span class=w>       </span><span class=n>pearson</span><span class=w>     </span><span class=mi>0</span><span class=p>,</span><span class=mi>8808122718846411</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2</span><span class=w>       </span><span class=n>x1</span><span class=w>  </span><span class=n>y2</span><span class=w>       </span><span class=n>spearman</span><span class=w>    </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2</span><span class=w>       </span><span class=n>x2</span><span class=w>  </span><span class=n>y1</span><span class=w>       </span><span class=n>pearson</span><span class=w>     </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>777082191335969</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2</span><span class=w>       </span><span class=n>x2</span><span class=w>  </span><span class=n>y1</span><span class=w>       </span><span class=n>spearman</span><span class=w>    </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2</span><span class=w>       </span><span class=n>x2</span><span class=w>  </span><span class=n>y2</span><span class=w>       </span><span class=n>pearson</span><span class=w>     </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>144827299193112</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>2</span><span class=w>       </span><span class=n>x2</span><span class=w>  </span><span class=n>y2</span><span class=w>       </span><span class=n>spearman</span><span class=w>    </span><span class=o>-</span><span class=mi>0</span><span class=p>,</span><span class=mi>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3</span><span class=w>       </span><span class=n>x1</span><span class=w>  </span><span class=n>y1</span><span class=w>       </span><span class=n>pearson</span><span class=w>     </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3</span><span class=w>       </span><span class=n>x1</span><span class=w>  </span><span class=n>y1</span><span class=w>       </span><span class=n>spearman</span><span class=w>    </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3</span><span class=w>       </span><span class=n>x1</span><span class=w>  </span><span class=n>y2</span><span class=w>       </span><span class=n>pearson</span><span class=w>     </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3</span><span class=w>       </span><span class=n>x1</span><span class=w>  </span><span class=n>y2</span><span class=w>       </span><span class=n>spearman</span><span class=w>    </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3</span><span class=w>       </span><span class=n>x2</span><span class=w>  </span><span class=n>y1</span><span class=w>       </span><span class=n>pearson</span><span class=w>     </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3</span><span class=w>       </span><span class=n>x2</span><span class=w>  </span><span class=n>y1</span><span class=w>       </span><span class=n>spearman</span><span class=w>    </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3</span><span class=w>       </span><span class=n>x2</span><span class=w>  </span><span class=n>y2</span><span class=w>       </span><span class=n>pearson</span><span class=w>     </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3</span><span class=w>       </span><span class=n>x2</span><span class=w>  </span><span class=n>y2</span><span class=w>       </span><span class=n>spearman</span><span class=w>    </span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></div><p>That&rsquo;s all folks!</p></div><script type=text/javascript>var s=document.createElement("script");s.setAttribute("src","https://utteranc.es/client.js"),s.setAttribute("repo","MaxHalford/maxhalford.github.io"),s.setAttribute("issue-term","pathname"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",null),s.setAttribute("theme","github-light"),document.body.appendChild(s)</script><div style=display:flex;flex-direction:row;justify-content:center;align-items:center;gap:20px;margin-bottom:30px><div class=do-the-thing><div class=elevator><svg class="sweet-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" enable-background="new 0 0 100 100" height="100" width="100"><path d="M70 47.5H30c-1.4.0-2.5 1.1-2.5 2.5v40c0 1.4 1.1 2.5 2.5 2.5h40c1.4.0 2.5-1.1 2.5-2.5V50C72.5 48.6 71.4 47.5 70 47.5zm-22.5 40h-5v-25h5v25zm10 0h-5v-25h5v25zm10 0h-5V60c0-1.4-1.1-2.5-2.5-2.5H40c-1.4.0-2.5 1.1-2.5 2.5v27.5h-5v-35h35v35z"/><path d="M50 42.5c1.4.0 2.5-1.1 2.5-2.5V16l5.7 5.7c.5.5 1.1.7 1.8.7s1.3-.2 1.8-.7c1-1 1-2.6.0-3.5l-10-10c-1-1-2.6-1-3.5.0l-10 10c-1 1-1 2.6.0 3.5 1 1 2.6 1 3.5.0l5.7-5.7v24c0 1.4 1.1 2.5 2.5 2.5z"/></svg>Back to the top</div></div><iframe src=https://github.com/sponsors/MaxHalford/button title="Sponsor MaxHalford" height=32 width=114 style=border:0;border-radius:6px></iframe></div><script src=https://cdnjs.cloudflare.com/ajax/libs/elevator.js/1.0.1/elevator.min.js></script>
<script>var elementButton=document.querySelector(".elevator"),elevator=new Elevator({element:elementButton,mainAudio:"/music/elevator.mp3",endAudio:"/music/ding.mp3"})</script><style>.down-arrow{font-size:120px;margin-top:90px;margin-bottom:90px;text-shadow:0 -20px #0c1f31,0 0 #c33329;color:transparent;-webkit-transform:scaleY(.8);-moz-transform:scaleY(.8);transform:scaleY(.8)}.elevator{text-align:center;cursor:pointer;width:140px;margin:auto}.elevator:hover{opacity:.7}.elevator svg{width:40px;height:40px;display:block;margin:auto;margin-bottom:5px}</style><div class=related-content><h3 style=margin-top:10px!important;margin-bottom:10px!important>Related posts</h3><ul style=margin-top:0><li><a href=/blog/sql-subquery-enumeration/>SQL subquery enumeration</a></li></ul></div></div></div></article><script></script></body></html>